<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"Gemini":240},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="基于 MySQL8.0.12 进行操作，环境：phpstudy_pro &amp; Windows11  网络安全等级保护基本要求 - 第三级安全要求 - 安全计算环境 核查 加固">
<meta property="og:type" content="article">
<meta property="og:title" content="基线核查与加固 - MySQL">
<meta property="og:url" content="http://example.com/2023/10/29/harden-mysql/index.html">
<meta property="og:site_name" content="勾三股四弦五小六">
<meta property="og:description" content="基于 MySQL8.0.12 进行操作，环境：phpstudy_pro &amp; Windows11  网络安全等级保护基本要求 - 第三级安全要求 - 安全计算环境 核查 加固">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212213316407.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212213649720.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212220000175.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212211606097.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212211840616.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212220652885.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212222219404.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212223356808.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212225225553.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212203451814.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212204608383.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213000354563.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213000524679.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212234533536.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213000732709.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213162949400.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212235526618.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212235744110.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213094849716.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213095710756.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213100143478.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213100323167.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213101248151.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213101419440.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213101612486.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213000354563.png">
<meta property="og:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221213000524679.png">
<meta property="og:image" content="http://example.com/harden-mysql/image-20240411134901748.png">
<meta property="article:published_time" content="2023-10-29T01:57:11.000Z">
<meta property="article:modified_time" content="2024-04-11T05:49:06.210Z">
<meta property="article:author" content="G3G4X5X6">
<meta property="article:tag" content="基线核查与加固">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="网络安全等级保护基本要求">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/harden-mysql/knowledge-baseimage-20221212213316407.png">


<link rel="canonical" href="http://example.com/2023/10/29/harden-mysql/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/10/29/harden-mysql/","path":"2023/10/29/harden-mysql/","title":"基线核查与加固 - MySQL"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>基线核查与加固 - MySQL | 勾三股四弦五小六</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-7VJ6G6FE1D","only_pageview":true,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="勾三股四弦五小六" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">勾三股四弦五小六</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">身在黑暗，心向光明</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">21</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">12</span></a></li><li class="menu-item menu-item-关注"><a href="/follow/" rel="section"><i class="fa fa-list fa-fw"></i>关注</a></li><li class="menu-item menu-item-sitemap"><a href="/atom.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-4-%E5%AE%89%E5%85%A8%E8%AE%A1%E7%AE%97%E7%8E%AF%E5%A2%83"><span class="nav-text">8.1.4 安全计算环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-4-1-%E8%BA%AB%E4%BB%BD%E9%89%B4%E5%88%AB"><span class="nav-text">8.1.4.1 身份鉴别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E5%AF%86%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="nav-text">核查密码复杂度</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F"><span class="nav-text">加固方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85-validate-password-%E6%8F%92%E4%BB%B6"><span class="nav-text">1）安装 validate_password 插件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2%EF%BC%89%E5%AF%86%E7%A0%81%E5%BC%BA%E5%BA%A6%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A"><span class="nav-text">2）密码强度相关参数解释</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3%EF%BC%89%E5%AF%86%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BA%A6%E7%AD%96%E7%95%A5%E5%85%B7%E4%BD%93%E8%AE%BE%E7%BD%AE"><span class="nav-text">3）密码复杂度策略具体设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E5%AF%86%E7%A0%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">核查密码生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-1"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-1"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E9%99%90%E5%88%B6%E9%9D%9E%E6%B3%95%E7%99%BB%E5%BD%95%E6%AC%A1%E6%95%B0"><span class="nav-text">核查是否限制非法登录次数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-2"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-2"><span class="nav-text">加固方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85-Connection-Control-%E6%8F%92%E4%BB%B6"><span class="nav-text">1）安装 Connection-Control 插件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2%EF%BC%89%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A"><span class="nav-text">2）参数解释</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3%EF%BC%89%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="nav-text">3）具体配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E8%B6%85%E6%97%B6%E5%8A%9F%E8%83%BD"><span class="nav-text">核查超时功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-3"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-3"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1"><span class="nav-text">核查是否开启远程加密通信</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-4"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-4"><span class="nav-text">加固方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-4-2-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-text">8.1.4.2 访问控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AF%B9%E7%99%BB%E5%BD%95%E7%9A%84%E7%94%A8%E6%88%B7%E5%88%86%E9%85%8D%E8%B4%A6%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90"><span class="nav-text">核查是否对登录的用户分配账户和权限</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-5"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-5"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E9%87%8D%E5%91%BD%E5%90%8D%E8%B4%A6%E5%8F%B7"><span class="nav-text">核查是否重命名账号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-6"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-6"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8F%A3%E4%BB%A4"><span class="nav-text">核查是否修改默认口令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-7"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-7"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%A4%9A%E4%BD%99%E7%9A%84%E3%80%81%E8%BF%87%E6%9C%9F%E7%9A%84%E8%B4%A6%E5%8F%B7"><span class="nav-text">核查是否存在多余的、过期的账号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-8"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-8"><span class="nav-text">加固方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-4-3-%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1"><span class="nav-text">8.1.4.3 安全审计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E5%90%AF%E7%94%A8%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-text">核查是否启用日志记录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-9"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-9"><span class="nav-text">加固方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-%E5%BC%80%E5%90%AF%E5%B8%B8%E8%A7%84%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1%E5%8A%9F%E8%83%BD"><span class="nav-text">1) 开启常规日志审计功能</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-%E5%BC%80%E5%90%AF%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1%E5%8A%9F%E8%83%BD"><span class="nav-text">2) 开启错误日志审计功能</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-%E7%A1%AE%E4%BF%9D%E6%97%A5%E5%BF%97%E5%AD%98%E6%94%BE%E5%9C%A8%E9%9D%9E%E7%B3%BB%E7%BB%9F%E5%8C%BA%E5%9F%9F"><span class="nav-text">3) 确保日志存放在非系统区域</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-%E5%85%B3%E9%97%AD%E5%8E%9F%E5%A7%8B%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD"><span class="nav-text">4) 关闭原始日志功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%97%A5%E5%BF%97%E4%BF%9D%E5%AD%98%E6%97%B6%E9%97%B4"><span class="nav-text">核查日志保存时间</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-10"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-10"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E4%BF%A1%E6%81%AF"><span class="nav-text">核查日志文件权限信息</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%8E%A7%E5%88%B6%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">1) 控制二进制日志文件的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%8E%A7%E5%88%B6%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95%E3%80%81%E5%9F%BA%E5%87%86%E7%9B%AE%E5%BD%95%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-text">2) 控制数据目录、基准目录的访问权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%8E%A7%E5%88%B6%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">3) 控制错误日志文件的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%8E%A7%E5%88%B6%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">4) 控制慢查询日志文件的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E6%8E%A7%E5%88%B6%E9%80%9A%E7%94%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">5) 控制通用日志文件的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-%E6%8E%A7%E5%88%B6%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">6) 控制审计日志文件的权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Naming-Conventions-for-Audit-Log-Files"><span class="nav-text">Naming Conventions for Audit Log Files</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-4-4-%E5%85%A5%E4%BE%B5%E9%98%B2%E8%8C%83"><span class="nav-text">8.1.4.4 入侵防范</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%A5%E5%8F%8A%E7%A9%BA%E8%B4%A6%E5%8F%B7"><span class="nav-text">核查测试数据库以及空账号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-11"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-11"><span class="nav-text">加固方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%98%AF%E5%90%A6%E9%99%90%E5%88%B6%E6%BA%90IP%E8%AE%BF%E9%97%AE"><span class="nav-text">核查是否限制源IP访问</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E6%9F%A5%E6%96%B9%E5%BC%8F-12"><span class="nav-text">核查方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F-12"><span class="nav-text">加固方式</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%A0%87%E5%87%86"><span class="nav-text">安全标准</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E6%96%87%E6%A1%A3"><span class="nav-text">产品文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0"><span class="nav-text">博客文章</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-text">持久化全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="nav-text">执行脚本</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">G3G4X5X6</p>
  <div class="site-description" itemprop="description">学而时习之</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/G3G4X5X6" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;G3G4X5X6" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:g3g4x5x6@foxmail.com" title="E-Mail → mailto:g3g4x5x6@foxmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/29/harden-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="G3G4X5X6">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="勾三股四弦五小六">
      <meta itemprop="description" content="学而时习之">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="基线核查与加固 - MySQL | 勾三股四弦五小六">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          基线核查与加固 - MySQL
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-29 09:57:11" itemprop="dateCreated datePublished" datetime="2023-10-29T09:57:11+08:00">2023-10-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-11 13:49:06" itemprop="dateModified" datetime="2024-04-11T13:49:06+08:00">2024-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%BA%BF%E6%A0%B8%E6%9F%A5%E4%B8%8E%E5%8A%A0%E5%9B%BA/" itemprop="url" rel="index"><span itemprop="name">基线核查与加固</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>基于 <code>MySQL8.0.12</code> 进行操作，环境：<code>phpstudy_pro</code> &amp; <code>Windows11</code></p>
<ol>
<li>网络安全等级保护基本要求 - <code>第三级安全要求</code> - <code>安全计算环境</code></li>
<li>核查</li>
<li>加固</li>
</ol>
</blockquote>
<span id="more"></span>

<h2 id="8-1-4-安全计算环境"><a href="#8-1-4-安全计算环境" class="headerlink" title="8.1.4 安全计算环境"></a>8.1.4 安全计算环境</h2><h3 id="8-1-4-1-身份鉴别"><a href="#8-1-4-1-身份鉴别" class="headerlink" title="8.1.4.1 身份鉴别"></a>8.1.4.1 身份鉴别</h3><p>本项要求包括：</p>
<p>a) 应对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有复杂度要求并定期更换；</p>
<ul>
<li>核查密码复杂度</li>
<li>核查密码生命周期</li>
</ul>
<p>b) 应具有登录失败处理功能，应配置并启用结束会话、限制非法登录次数和当登录连接超时自动退出等相关措施；</p>
<ul>
<li>核查是否限制非法登录次数</li>
<li>核查登录连接超时配置</li>
</ul>
<p>c) 当进行远程管理时，应采取必要措施防止鉴别信息在网络传输过程中被窃听；</p>
<ul>
<li>核查是否开启远程加密通信</li>
</ul>
<p>d) 应采用口令、密码技术、生物技术等两种或两种以上组合的鉴别技术对用户进行身份鉴别，且其中一种鉴别技术至少应使用密码技术来实现。</p>
<ul>
<li>不适用</li>
</ul>
<h4 id="核查密码复杂度"><a href="#核查密码复杂度" class="headerlink" title="核查密码复杂度"></a>核查密码复杂度</h4><p>MySQL 系统自带有 validate_password 插件，此插件可以验证密码强度，未达到规定强度的密码则不允许被设置。MySQL 5.7 及 8.0 版本默认情况下貌似都不启用该插件，这也使得我们可以随意设置密码，比如设置为 123、123456等。如果我们想从根源上规范密码强度，可以启用该插件，下面一起来看下如何通过此插件来设置密码复杂度策略。</p>
<h5 id="核查方式"><a href="#核查方式" class="headerlink" title="核查方式"></a>核查方式</h5><p>安装前检查 为空则说明未安装此插件：<code>show variables like &#39;validate%&#39;; </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;; </span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212213316407.png" alt="image-20221212213316407"></p>
<h5 id="加固方式"><a href="#加固方式" class="headerlink" title="加固方式"></a>加固方式</h5><h6 id="1）安装-validate-password-插件"><a href="#1）安装-validate-password-插件" class="headerlink" title="1）安装 validate_password 插件"></a>1）安装 validate_password 插件</h6><p><code>INSTALL PLUGIN validate_password SONAME &#39;validate_password.so&#39;;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 通过 INSTALL PLUGIN 命令可安装此插件</span><br><span class="line"># 每个平台的文件名后缀都不同 对于 Unix 和类 Unix 系统，为.so，对于 Windows 为.dll</span><br><span class="line">mysql&gt; INSTALL PLUGIN validate_password SONAME &#x27;validate_password.so&#x27;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.28 sec)</span><br><span class="line"></span><br><span class="line"># 查看 validate_password 相关参数</span><br><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;;</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password_check_user_name    | ON     |</span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 8      |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212213649720.png" alt="image-20221212213649720"></p>
<h6 id="2）密码强度相关参数解释"><a href="#2）密码强度相关参数解释" class="headerlink" title="2）密码强度相关参数解释"></a>2）密码强度相关参数解释</h6><p>安装 validate_password 插件后，多了一些密码强度相关参数，这些参数从字面意思上也很容易看懂，下面简单解释下几个重点参数。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> validate<span class="emphasis">_password_</span>policy</span><br><span class="line"><span class="bullet">	-</span> 代表的密码策略，默认是MEDIUM 可配置的值有以下：</span><br><span class="line"><span class="code">        0 or LOW 仅需需符合密码长度（由参数validate_password_length指定）</span></span><br><span class="line"><span class="code">        1 or MEDIUM 满足LOW策略，同时还需满足至少有1个数字，小写字母，大写字母和特殊字符</span></span><br><span class="line"><span class="code">        2 or STRONG 满足MEDIUM策略，同时密码不能存在字典文件（dictionary file）中</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">2.</span> validate<span class="emphasis">_password_</span>dictionary<span class="emphasis">_file</span></span><br><span class="line"><span class="emphasis">	- 用于配置密码的字典文件，当validate_</span>password<span class="emphasis">_policy设置为STRONG时可以配置密码字典文件，字典文件中存在的密码不得使用。</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">3. validate_</span>password<span class="emphasis">_length</span></span><br><span class="line"><span class="emphasis">	- 用来设置密码的最小长度，默认值是8</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">4. validate_</span>password<span class="emphasis">_mixed_</span>case<span class="emphasis">_count</span></span><br><span class="line"><span class="emphasis">	- 当validate_</span>password<span class="emphasis">_policy设置为MEDIUM或者STRONG时，密码中至少同时拥有的小写和大写字母的数量</span></span><br><span class="line"><span class="emphasis">	- 默认是1最小是0；默认是至少拥有一个小写和一个大写字母。</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">5. validate_</span>password<span class="emphasis">_number_</span>count</span><br><span class="line"><span class="bullet">	-</span> 当validate<span class="emphasis">_password_</span>policy设置为MEDIUM或者STRONG时，密码中至少拥有的数字的个数，默认1最小是0</span><br><span class="line"></span><br><span class="line"><span class="bullet">6.</span> validate<span class="emphasis">_password_</span>special<span class="emphasis">_char_</span>count</span><br><span class="line"><span class="bullet">	-</span> 当validate<span class="emphasis">_password_</span>policy设置为MEDIUM或者STRONG时，密码中至少拥有的特殊字符的个数，默认1最小是0</span><br></pre></td></tr></table></figure>

<h6 id="3）密码复杂度策略具体设置"><a href="#3）密码复杂度策略具体设置" class="headerlink" title="3）密码复杂度策略具体设置"></a>3）密码复杂度策略具体设置</h6><p><code>set global validate_password_length = 16;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 设置密码长度至少10位</span><br><span class="line">mysql&gt; set global validate_password_length = 16;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;;                                                                                   </span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password_check_user_name    | ON     |</span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 16     |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>!!! note “若想永久生效，建议将以下参数写入配置文件”</p>
<pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">plugin-load = validate_password.dll</span><br><span class="line">validate_password_length = 16</span><br><span class="line">validate_password_policy = 1</span><br><span class="line">validate-password = FORCE_PLUS_PERMANENT</span><br></pre></td></tr></table></figure>
</code></pre>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212220000175.png" alt="image-20221212220000175"></p>
<h4 id="核查密码生命周期"><a href="#核查密码生命周期" class="headerlink" title="核查密码生命周期"></a>核查密码生命周期</h4><h5 id="核查方式-1"><a href="#核查方式-1" class="headerlink" title="核查方式"></a>核查方式</h5><p>查看密码有效期：<code>SHOW VARIABLES LIKE &#39;default_password_lifetime&#39;; </code></p>
<blockquote>
<p><code>default_password_lifetime</code> 设置为 <code>0</code> ，即表示密码永不过期。</p>
</blockquote>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212211606097.png" alt="image-20221212211606097"></p>
<h5 id="加固方式-1"><a href="#加固方式-1" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><p>一次性设置全局过期策略：<code>SET GLOBAL default_password_lifetime = 90;</code></p>
</li>
<li><p>或者直接写入配置文件并重启以永久生效</p>
  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入配置文件使得重启生效</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">default_password_lifetime</span> = <span class="number">90</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>设置全局过期策略后，需要把配置写入配置文件 <code>mysql.cn</code>中并重启才能永久生效，否则 <code>MySQL</code> 重启后恢复默认值。</p>
</blockquote>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212211840616.png" alt="image-20221212211840616"></p>
<h4 id="核查是否限制非法登录次数"><a href="#核查是否限制非法登录次数" class="headerlink" title="核查是否限制非法登录次数"></a>核查是否限制非法登录次数</h4><p>MySQL&gt;&#x3D; 5.7.17 以后提供了 Connection-Control 插件，用来控制客户端在登录操作连续失败一定次数后的响应的延迟。</p>
<h5 id="核查方式-2"><a href="#核查方式-2" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>show variables like &#39;%connection_control%&#39;;</code><ul>
<li>为空，则未启用插件，需要安装再进行加固。</li>
</ul>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212220652885.png" alt="image-20221212220652885"></p>
<h5 id="加固方式-2"><a href="#加固方式-2" class="headerlink" title="加固方式"></a>加固方式</h5><h6 id="1）安装-Connection-Control-插件"><a href="#1）安装-Connection-Control-插件" class="headerlink" title="1）安装 Connection-Control 插件"></a>1）安装 Connection-Control 插件</h6><ul>
<li>CONNECTION_CONTROL：用来控制登录失败的次数及延迟响应时间。</li>
<li>CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS：该表将登录失败的操作记录至IS库中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 每个平台的文件名后缀都不同 对于 Unix 和类 Unix 系统，为.so，对于 Windows 为.dll</span><br><span class="line">install plugin CONNECTION_CONTROL soname &#x27;connection_control.so&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#x27;connection_control.so&#x27;;</span><br><span class="line">	# 开启的选项</span><br><span class="line">	# connection_control_failed_connections_threshold	3</span><br><span class="line">	# connection_control_max_connection_delay	2147483647</span><br><span class="line">	# connection_control_min_connection_delay	1000</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h6 id="2）参数解释"><a href="#2）参数解释" class="headerlink" title="2）参数解释"></a>2）参数解释</h6><ul>
<li><p>connection_control_failed_connections_threshold</p>
<ul>
<li>失败尝试的次数，默认为3，表示当连接失败3次后启用连接控制，0表示不开启。</li>
</ul>
</li>
<li><p>connection_control_max_connection_delay</p>
<ul>
<li>响应延迟的最大时间，默认约25天</li>
</ul>
</li>
<li><p>connection_control_min_connection_delay</p>
<ul>
<li>响应延迟的最小时间，默认1000微秒，1秒</li>
</ul>
</li>
</ul>
<h6 id="3）具体配置"><a href="#3）具体配置" class="headerlink" title="3）具体配置"></a>3）具体配置</h6><p>方式一：修改配置文件 <code>my.cnf</code> or <code>my.ini</code>（永久生效）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment"># 添加下面两项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.登陆失败次数限制</span></span><br><span class="line"><span class="attr">connection-control-failed-connections-threshold</span>=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.限制重试时间，此处为毫秒，注意按需求换算</span></span><br><span class="line"><span class="attr">connection-control-min-connection-delay</span>=<span class="number">900000</span> </span><br></pre></td></tr></table></figure>

<p>方式二：设置全局变量（重启失效）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 登陆失败次数限制</span><br><span class="line">SET GLOBAL connection_control_failed_connections_threshold = 5;</span><br><span class="line"></span><br><span class="line"># 限制重试时间，此处为毫秒，注意按需求换算</span><br><span class="line">SET GLOBAL connection_control_min_connection_delay = 900000;</span><br><span class="line"></span><br><span class="line"># 配置完成，再次查看参数：</span><br><span class="line">show variables like &#x27;%connection_control%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212222219404.png" alt="image-20221212222219404"></p>
<h4 id="核查超时功能"><a href="#核查超时功能" class="headerlink" title="核查超时功能"></a>核查超时功能</h4><blockquote>
<p>从官方文档上来看 wait_timeout 和 interactive_timeout 都是指不活跃的连接超时时间，连接线程启动的时候wait_timeout会根据是交互模式还是非交互模式被设置为这两个值中的一个。</p>
<p>如果我们运行mysql -uroot -p命令登陆到mysql，wait_timeout就会被设置为interactive_timeout的值。<br>如果我们在wait_timeout时间内没有进行任何操作，那么再次操作的时候就会提示超时，这时 mysql client会重新连接。</p>
</blockquote>
<p>MySQL连接超时退出主要看三个参数：</p>
<ul>
<li><p>interactive_timeout</p>
<ul>
<li>服务器关闭交互式连接前等待活动的秒数。</li>
</ul>
</li>
<li><p>wait_timeout</p>
<ul>
<li>服务器关闭非交互连接之前等待活动的秒数。</li>
</ul>
</li>
<li><p>两者生效取决于</p>
<ul>
<li>客户端是交互或者非交互的连接。</li>
<li>在交互模式下，interactive_timeout才生效；非交互模式下，wait_timeout生效。</li>
</ul>
</li>
<li><p>connect_timeout &#x3D;10</p>
<ul>
<li>指的是连接过程中握手的超时时间(s)</li>
</ul>
</li>
</ul>
<h5 id="核查方式-3"><a href="#核查方式-3" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>show global variables like &#39;%timeout%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212223356808.png" alt="image-20221212223356808"></p>
<h5 id="加固方式-3"><a href="#加固方式-3" class="headerlink" title="加固方式"></a>加固方式</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 设置全局变量 `connect_timeout` 为 `10s`</span><br><span class="line">msyql&gt; set global connect_timeout=10;</span><br><span class="line"></span><br><span class="line"># 设置 MySQL Server 超时时间（以秒为单位）</span><br><span class="line"># 默认是28800，即8小时。</span><br><span class="line">msyql&gt; set global wait_timeout=28800;</span><br><span class="line">msyql&gt; set global interactive_timeout=28800;</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212225225553.png" alt="image-20221212225225553"></p>
<h4 id="核查是否开启远程加密通信"><a href="#核查是否开启远程加密通信" class="headerlink" title="核查是否开启远程加密通信"></a>核查是否开启远程加密通信</h4><h5 id="核查方式-4"><a href="#核查方式-4" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>show variables like &#39;have_openssl&#39;;</code></li>
<li><code>SHOW VARIABLES LIKE &#39;%ssl%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212203451814.png" alt="image-20221212203451814"></p>
<blockquote>
<p>MySQL8.0.12默认开启加密通信</p>
<p>禁用加密通信：在配置文件 <code>my.cnf</code> 中的 <code>[mysqld]</code> 下加入<code>skip_ssl</code>，重启MySQL。</p>
</blockquote>
<h5 id="加固方式-4"><a href="#加固方式-4" class="headerlink" title="加固方式"></a>加固方式</h5><p>加固通信传输要求项：启用 <code>ssl</code> 加密通信，<em><strong>注释</strong></em> 配置文件 <code>my.cnf</code> 中的 <code>[mysqld]</code> 下的<code>skip_ssl</code>，并在下面追加 <code>ssl</code>，重启MySQL。</p>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212204608383.png" alt="image-20221212204608383"></p>
<h3 id="8-1-4-2-访问控制"><a href="#8-1-4-2-访问控制" class="headerlink" title="8.1.4.2 访问控制"></a>8.1.4.2 访问控制</h3><p>本项要求包括：</p>
<p>a) 应对登录的用户分配账户和权限；</p>
<ul>
<li>核查是否对登录的用户分配账户和权限</li>
</ul>
<p>b) 应重命名或删除默认账户，修改默认账户的默认口令；</p>
<ul>
<li>核查是否重命名账号</li>
<li>核查是否修改默认口令</li>
</ul>
<p>c) 应及时删除或停用多余的、过期的账户，避免共享账户的存在；</p>
<ul>
<li>核查是否存在多余的、过期的账号</li>
</ul>
<p>d) 应授予管理用户所需的最小权限，实现管理用户的权限分离；</p>
<p>e) 应由授权主体配置访问控制策略，访问控制策略规定主体对客体的访问规则；</p>
<p>f) 访问控制的粒度应达到主体为用户级或进程级，客体为文件、数据库表级；</p>
<p>g) 应对重要主体和客体设置安全标记，并控制主体对有安全标记信息资源的访问。</p>
<h4 id="核查是否对登录的用户分配账户和权限"><a href="#核查是否对登录的用户分配账户和权限" class="headerlink" title="核查是否对登录的用户分配账户和权限"></a>核查是否对登录的用户分配账户和权限</h4><h5 id="核查方式-5"><a href="#核查方式-5" class="headerlink" title="核查方式"></a>核查方式</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySQL 中所有使用者的权限是记录在 `mysql` 这个数据库的 `user` 资料表中:</span></span><br><span class="line">SELECT * FROM mysql.user;</span><br><span class="line"><span class="comment"># 你可以看到所有的使用者权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有关db的数据是记录在Db(大小写要注意)这个数据表中</span></span><br><span class="line">SELECT * FROM mysql.Db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者你可以用条件查询找出你要的答案</span></span><br><span class="line">SELECT * FROM mysql.Db WHERE Db=<span class="string">&#x27;$&#123;dbname&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000354563.png" alt="image-20221213000354563"></p>
<h5 id="加固方式-5"><a href="#加固方式-5" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><p>禁止root账号远程登录</p>
</li>
<li><p>禁止程序使用root账号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 设置允许任何IP登录</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000524679.png" alt="image-20221213000524679"></p>
<h4 id="核查是否重命名账号"><a href="#核查是否重命名账号" class="headerlink" title="核查是否重命名账号"></a>核查是否重命名账号</h4><h5 id="核查方式-6"><a href="#核查方式-6" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212234533536.png" alt="image-20221212234533536"></p>
<h5 id="加固方式-6"><a href="#加固方式-6" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><p>修改root账号名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set user=&#x27;haiyi_root&#x27; where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000732709.png" alt="image-20221213000732709"></p>
<h4 id="核查是否修改默认口令"><a href="#核查是否修改默认口令" class="headerlink" title="核查是否修改默认口令"></a>核查是否修改默认口令</h4><h5 id="核查方式-7"><a href="#核查方式-7" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li>访谈</li>
<li>查询空口令账号<ul>
<li><code>select * from mysql.user where length(authentication_string)=0 or authentication_string is null;</code></li>
</ul>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213162949400.png" alt="image-20221213162949400"></p>
<h5 id="加固方式-7"><a href="#加固方式-7" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li>修改默认口令、空口令(谨慎操作)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; UPDATE user SET authentication_string=&quot;H!q@31UI!&quot; WHERE user=&quot;root&quot;;</span><br><span class="line">Query OK, 1 row affected (0.39 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH privileges;  # 刷新保存</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br></pre></td></tr></table></figure>



<h4 id="核查是否存在多余的、过期的账号"><a href="#核查是否存在多余的、过期的账号" class="headerlink" title="核查是否存在多余的、过期的账号"></a>核查是否存在多余的、过期的账号</h4><h5 id="核查方式-8"><a href="#核查方式-8" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212235526618.png" alt="image-20221212235526618"></p>
<h5 id="加固方式-8"><a href="#加固方式-8" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><p>删除多余的、过期的账号，如：test, dev等测试账号。</p>
</li>
<li><p>删除 <code>test</code>：<code>drop user &#39;test&#39;@&#39;localhost&#39;;</code></p>
</li>
<li><p>删除 <code>dev</code> ：<code>drop user &#39;dev&#39;@&#39;localhost&#39;;</code></p>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212235744110.png" alt="image-20221212235744110"></p>
<h3 id="8-1-4-3-安全审计"><a href="#8-1-4-3-安全审计" class="headerlink" title="8.1.4.3 安全审计"></a>8.1.4.3 安全审计</h3><p>本项要求包括：</p>
<p>a) 应启用安全审计功能，审计覆盖到每个用户，对重要的用户行为和重要安全事件进行审计；</p>
<ul>
<li>核查是否启用日志记录</li>
</ul>
<p>b) 审计记录应包括事件的日期和时间、用户、事件类型、事件是否成功及其他与审计相关的信息；</p>
<p>c) 应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等；</p>
<ul>
<li>核查日志保存时间</li>
<li>核查日志文件权限信息</li>
</ul>
<p>d) 应对审计进程进行保护，防止未经授权的中断。</p>
<h4 id="核查是否启用日志记录"><a href="#核查是否启用日志记录" class="headerlink" title="核查是否启用日志记录"></a>核查是否启用日志记录</h4><h5 id="核查方式-9"><a href="#核查方式-9" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li>查询所有日志相关信息：<code>show variables like &#39;%log%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213094849716.png" alt="image-20221213094849716"></p>
<h5 id="加固方式-9"><a href="#加固方式-9" class="headerlink" title="加固方式"></a>加固方式</h5><h6 id="1-开启常规日志审计功能"><a href="#1-开启常规日志审计功能" class="headerlink" title="1) 开启常规日志审计功能"></a>1) 开启常规日志审计功能</h6><ul>
<li><code>set global general_log=on;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213095710756.png" alt="image-20221213095710756"></p>
<h6 id="2-开启错误日志审计功能"><a href="#2-开启错误日志审计功能" class="headerlink" title="2) 开启错误日志审计功能"></a>2) 开启错误日志审计功能</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误日志包括数据库运行和停止过程中的一系列活动信息，有助于分析数据库运行过程中的一些异常活动</span></span><br><span class="line"><span class="comment"># 一般情况下需要开启错误日志记录功能，使用如下命令查询：</span></span><br><span class="line"></span><br><span class="line">SHOW variables LIKE <span class="string">&#x27;log_error&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保返回结果为非空，如果为空，需要在mysql数据库配置文件中增加相关配置</span></span><br><span class="line"><span class="comment"># &gt;&gt;&gt; log_error	D:\phpstudy_pro\Extensions\MySQL8.0.12\data.err</span></span><br></pre></td></tr></table></figure>

<h6 id="3-确保日志存放在非系统区域"><a href="#3-确保日志存放在非系统区域" class="headerlink" title="3) 确保日志存放在非系统区域"></a>3) 确保日志存放在非系统区域</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志文件随着数据库的运行会不断增加，如果存放在系统区域，则会影响系统的正常运行，使用如下命令进行查询：</span></span><br><span class="line"></span><br><span class="line">SELECT @@global.log_bin_basename;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保返回结果不是如下路径：/、/var、/usr</span></span><br></pre></td></tr></table></figure>

<h6 id="4-关闭原始日志功能"><a href="#4-关闭原始日志功能" class="headerlink" title="4) 关闭原始日志功能"></a>4) 关闭原始日志功能</h6><blockquote>
<p>当 <code>log-raw</code> 记录启用时，有权访问日志文件的人可能会看到纯文本密码。</p>
<p>编辑 MySQL 配置文件 <code>/etc/my.cnf</code> ，删除 <code>log-raw</code> 参数，并重启 <code>mysql</code> 服务</p>
<blockquote>
<p>上述与下面的操作好像有点冲突，以实际情况为准。待探索……</p>
</blockquote>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原始日志选项会决定一些敏感信息是否会被明文写进日志中，例如查询日志、慢查询日志、二进制日志</span></span><br><span class="line"><span class="comment"># 确保数据库配置文件中存在如下配置项：</span></span><br><span class="line"></span><br><span class="line">log-raw = OFF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如无，配置并重启</span></span><br></pre></td></tr></table></figure>



<h4 id="核查日志保存时间"><a href="#核查日志保存时间" class="headerlink" title="核查日志保存时间"></a>核查日志保存时间</h4><blockquote>
<p>set global expire_logs_days&#x3D;365</p>
<p>&gt; 3683 - The option expire_logs_days and binlog_expire_logs_seconds cannot be used together. Please use binlog_expire_logs_seconds to set the expire time (expire_logs_days is deprecated)</p>
</blockquote>
<h5 id="核查方式-10"><a href="#核查方式-10" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li>查看日志时间（已废弃）：<code>show variables like &#39;%logs_days%&#39;;</code></li>
<li>查看日志时间：<code>show variables like &#39;binlog_expire_logs_seconds&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213100143478.png" alt="image-20221213100143478"></p>
<h5 id="加固方式-10"><a href="#加固方式-10" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><code>set global binlog_expire_logs_seconds=2596096;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213100323167.png" alt="image-20221213100323167"></p>
<h4 id="核查日志文件权限信息"><a href="#核查日志文件权限信息" class="headerlink" title="核查日志文件权限信息"></a>核查日志文件权限信息</h4><h5 id="1-控制二进制日志文件的权限"><a href="#1-控制二进制日志文件的权限" class="headerlink" title="1) 控制二进制日志文件的权限"></a>1) 控制二进制日志文件的权限</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql的运行会产生很多日志，例如二进制日志、错误日志、慢查询日志等等，Mysql命令行下执行如下命令：</span></span><br><span class="line">show variables like <span class="string">&#x27;log_bin_basename&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端命令行执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> &lt;log_bin_basename&gt;.*</span><br><span class="line"><span class="comment"># 对于发现的每一个文件，执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;log_bin_basename.nnnnn&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># 根据输出确认日志文件的权限设置是否存在问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于每个日志文件，修改其权限和属组如下：</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt; </span><br></pre></td></tr></table></figure>



<h5 id="2-控制数据目录、基准目录的访问权限"><a href="#2-控制数据目录、基准目录的访问权限" class="headerlink" title="2) 控制数据目录、基准目录的访问权限"></a>2) 控制数据目录、基准目录的访问权限</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据目录是mysql数据库存放的位置，在mysql命令行界面下执行如下命令：</span></span><br><span class="line">show variables <span class="built_in">where</span> variable_name = <span class="string">&#x27;datadir&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端命令行下执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;datadir&gt;/.. | egrep <span class="string">&quot;^d[r|w|x]&#123;3&#125;------\s*.\s*mysql\s*mysql\s*\d*.*mysql&quot;</span></span><br><span class="line"><span class="comment"># 其中&lt;datadir&gt;是第一条命令的执行结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果存在问题，linux环境下在终端执行如下命令进行加固：</span></span><br><span class="line"><span class="built_in">chmod</span> 700 &lt;datadir&gt; <span class="comment">#仅MySQL数据库用户有读写权限</span></span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;datadir&gt; </span><br><span class="line"><span class="comment"># 同理控制基准目录权限 &lt;basedir&gt;，仅DBA和数据库用户可访问</span></span><br></pre></td></tr></table></figure>



<h5 id="3-控制错误日志文件的权限"><a href="#3-控制错误日志文件的权限" class="headerlink" title="3) 控制错误日志文件的权限"></a>3) 控制错误日志文件的权限</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 控制错误日志文件的权限</span></span><br><span class="line"><span class="comment"># Mysql命令行下执行如下命令：</span></span><br><span class="line">show variables like <span class="string">&#x27;log_error&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端命令行执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> &lt;log_error&gt;.*</span><br><span class="line"><span class="comment"># 对于发现的每一个文件，执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;log_error&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># 根据输出确认日志文件的权限设置是否存在问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于每个日志文件，修改其权限和属组如下：</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="4-控制慢查询日志文件的权限"><a href="#4-控制慢查询日志文件的权限" class="headerlink" title="4) 控制慢查询日志文件的权限"></a>4) 控制慢查询日志文件的权限</h5><p>MySQL的慢查询日志是MySQL提供的一种日志记录，它用来记录MySQL中查询时间超过（大于）设置阈值（long_query_time）的语句，记录到慢查询日志中。</p>
<p><strong>默认情况下，MySQL没有开启慢查询日志</strong>。需要手动打开，如果不是调优需要的话，不建议开启，因为开启会带来一定的性能影响，慢查询日志支持将日志记录写入文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 开启慢查询日志，只对当前数据库生效，并且重启数据库后失效</span><br><span class="line">set global slow_query_log = 1;</span><br></pre></td></tr></table></figure>

<p><strong>慢查询日志文件权限控制查看与设置：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mysql命令行下执行如下命令：</span></span><br><span class="line">show variables like <span class="string">&#x27;slow_query_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端命令行执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> &lt;slow_query_log_file&gt;.*</span><br><span class="line"><span class="comment"># 对于发现的每一个文件，执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;slow_query_log_file&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># 根据输出确认日志文件的权限设置是否存在问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于每个日志文件，修改其权限和属组如下：</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="5-控制通用日志文件的权限"><a href="#5-控制通用日志文件的权限" class="headerlink" title="5) 控制通用日志文件的权限"></a>5) 控制通用日志文件的权限</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mysql命令行下执行如下命令：</span></span><br><span class="line">show variables like <span class="string">&#x27;general_log_file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端命令行执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> &lt;general_log_file&gt;.*</span><br><span class="line"><span class="comment"># 对于发现的每一个文件，执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;general_log_file&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># 根据输出确认日志文件的权限设置是否存在问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于每个日志文件，修改其权限和属组如下：</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="6-控制审计日志文件的权限"><a href="#6-控制审计日志文件的权限" class="headerlink" title="6) 控制审计日志文件的权限"></a>6) 控制审计日志文件的权限</h5><blockquote>
<h5 id="Naming-Conventions-for-Audit-Log-Files"><a href="#Naming-Conventions-for-Audit-Log-Files" class="headerlink" title="Naming Conventions for Audit Log Files"></a>Naming Conventions for Audit Log Files</h5><p>To configure the audit log file name, set the <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/audit-log-reference.html#sysvar_audit_log_file"><code>audit_log_file</code></a> system variable at server startup. The default name is <code>audit.log</code> in the server data directory. For best security, write the audit log to a directory accessible only to the MySQL server and to users with a legitimate reason to view the log.</p>
<p>[MySQL :: MySQL 8.0 Reference Manual :: 6.4.5.5 Configuring Audit Logging Characteristics](<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/audit-log-logging-configuration.html#:~:text=To">https://dev.mysql.com/doc/refman/8.0/en/audit-log-logging-configuration.html#:~:text=To</a> configure the audit log file name%2C set,with a legitimate reason to view the log.)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mysql命令行下执行如下命令：</span></span><br><span class="line">show global variables <span class="built_in">where</span> variable_name =  <span class="string">&#x27;audit_log_file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端执行如下命令：</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;audit_log_file&gt; | egrep <span class="string">&quot;^-rw[-x]rw[-x][-r][-w][-x][ \t]*[0-9][ \t]*mysql[\t]*mysql.*$&quot;</span></span><br><span class="line"><span class="comment"># 根据输出确认日志文件的权限设置是否存在问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于每个日志文件，修改其权限和属组如下：</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;audit_log_file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;audit_log_file&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-1-4-4-入侵防范"><a href="#8-1-4-4-入侵防范" class="headerlink" title="8.1.4.4 入侵防范"></a><strong>8.1.4.4 入侵防范</strong></h3><p>本项要求包括：</p>
<p>a) 应遵循最小安装的原则，仅安装需要的组件和应用程序；</p>
<ul>
<li>核查测试数据库以及空账号</li>
</ul>
<p>b) 应关闭不需要的系统服务、默认共享和高危端口；</p>
<p>c) 应通过设定终端接入方式或网络地址范围对通过网络进行管理的管理终端进行限制；</p>
<ul>
<li>核查是否限制源IP访问</li>
</ul>
<p>d) 应提供数据有效性检验功能，保证通过人机接口输入或通过通信接口输入的内容符合系统设定要求；</p>
<p>e) 应能发现可能存在的已知漏洞，并在经过充分测试评估后，及时修补漏洞；</p>
<ul>
<li><del>核查是否及时打补丁</del></li>
</ul>
<p>f) 应能够检测到对重要节点进行入侵的行为，并在发生严重入侵事件时提供报警。</p>
<h4 id="核查测试数据库以及空账号"><a href="#核查测试数据库以及空账号" class="headerlink" title="核查测试数据库以及空账号"></a>核查测试数据库以及空账号</h4><h5 id="核查方式-11"><a href="#核查方式-11" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li>查询数据库：<code>show DATABASES;</code></li>
<li>使用该命令查询是否存在空账号：<code>SELECT user,host FROM mysql.user WHERE user = &#39;&#39;; </code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101248151.png" alt="查询空用户名用户"></p>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101419440.png" alt="查询数据库"></p>
<h5 id="加固方式-11"><a href="#加固方式-11" class="headerlink" title="加固方式"></a>加固方式</h5><p>删除测试数据库以及空账号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除冗余数据库, 如 test</span></span><br><span class="line">drop database <span class="keyword">if</span> exists <span class="variable">$&#123;dbname&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除无用用户（没有用户名的用户）</span></span><br><span class="line">drop user <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101612486.png" alt="image-20221213101612486"></p>
<h4 id="核查是否限制源IP访问"><a href="#核查是否限制源IP访问" class="headerlink" title="核查是否限制源IP访问"></a>核查是否限制源IP访问</h4><blockquote>
<p>默认需要所有账号进行限制，不能存在 “<code>%</code> “ 任意源 <code>IP</code> 设置。</p>
</blockquote>
<h5 id="核查方式-12"><a href="#核查方式-12" class="headerlink" title="核查方式"></a>核查方式</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000354563.png" alt="image-20221213000354563"></p>
<h5 id="加固方式-12"><a href="#加固方式-12" class="headerlink" title="加固方式"></a>加固方式</h5><ul>
<li><p>设置 <code>$&#123;账号&#125;</code> 指定源IP登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># update user set host=&#x27;$&#123;IP&#125;&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line"># 设置 root 用户只允许本地登录</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000524679.png" alt="image-20221213000524679"></p>
<p><img data-src="/./harden-mysql/image-20240411134901748.png" alt="image-20240411134901748"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><h3 id="安全标准"><a href="#安全标准" class="headerlink" title="安全标准"></a>安全标准</h3><ul>
<li><a target="_blank" rel="noopener" href="http://c.gb688.cn/bzgk/gb/showGb?type=online&hcno=BAFB47E8874764186BDB7865E8344DAF"><strong>《信息安全技术  网络安全等级保护基本要求》</strong></a></li>
</ul>
<h3 id="产品文档"><a href="#产品文档" class="headerlink" title="产品文档"></a>产品文档</h3><ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/">MySQL :: MySQL Documentation</a></li>
</ul>
<h3 id="博客文章"><a href="#博客文章" class="headerlink" title="博客文章"></a>博客文章</h3><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Lee_Natuo/article/details/83995418">(100条消息) MySQL数据库安全加固方法_Lee_Natuo的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2115190">MySQL8.0正确修改密码的姿势- 腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/liliuqing/article/details/88723409">(100条消息) mysql8.0.15用户root登录开启远程访问权限_藤叶香来的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40147863/article/details/86485439">(100条消息) MySQL 8.0 版本授权 root 远程连接，修改权限，更改加密方式_肖朋伟的博客-CSDN博客_mysql8.0更改root 权限</a></li>
<li>[(100条消息) Linux系统中，Mysql 8的安装、修改root密码及允许root远程登录_时栈的博客-CSDN博客_mysql8允许root远程连接](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44667259/article/details/123228144#:~:text=%E4%B8%80%E3%80%81CentOS%E7%B3%BB%E7%BB%9F%E4%B8%ADMysql">https://blog.csdn.net/qq_44667259/article/details/123228144#:~:text=一、CentOS系统中Mysql</a> 8的安装 1 1.安装 sudo yum install mysql-,user from user where user%3D’root’%3B %2F%2F 查看 )</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_35067439/article/details/113159734">(100条消息) mysql8.0 删除用户_MYSQL8 创建、删除用户和授权、消权操作_番茄君小弟的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_23859799/article/details/85862821">(100条消息) mysql8.0数据库添加用户和授权_liuzh2443的博客-CSDN博客_mysql8用户授权</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_27017211/article/details/113113357">(100条消息) mysql8.0 新增用户_MySQL8.0添加创建用户、删除用户与授权(create user，delete user)_故事档案局的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_35750747/article/details/113155504">(100条消息) mysql connect 超时_MySQL修改connect_timeout（连接超时）全局变量_半清斋的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d14377a57d3a">MySQL修改connect_timeout（连接超时）全局变量 - 简书 (jianshu.com)</a></li>
<li>[(100条消息) mysql 5.7 连接超时参数设置_大龄奋斗程序猿的博客-CSDN博客_mysql 5.7配置超时](<a target="_blank" rel="noopener" href="https://blog.csdn.net/aichogn/article/details/118113114#:~:text=connect_timeout%E6%8C%87%E7%9A%84%E6%98%AF%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B%E4%B8%AD%E6%8F%A1%E6%89%8B%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%2C%E5%9C%A8">https://blog.csdn.net/aichogn/article/details/118113114#:~:text=connect_timeout指的是连接过程中握手的超时时间%2C在</a> 5.0.52 以后默认为,10 秒，之前版本默认是 5 秒。)</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42586723/article/details/121057330">(100条消息) MySQL学习之三级等保整改_Charles Yan的博客-CSDN博客_mysql 等保</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1173009">设置Mysql的连接超时参数wait_timeout、interactive_timeout - 腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xtaypyvi123456/article/details/125274821">(100条消息) Linux MySQL5.7等保问题整改：数据库未配置登录失败处理功能，未配置非法登录策略和登录超时自动退出功能。_可爱的小张666的博客-CSDN博客_mysql超时自动退出功能。</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33622153/article/details/115906282">(100条消息) mysql多次登录失败控制,Mysql登录失败多次锁定配置_Luna Li的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/windysai/p/15996858.html">mysql密码策略和登录失败处理 - windysai - 博客园 (cnblogs.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39762666/article/details/113627025">(100条消息) mysql 修改登录失败处理功能参数_等保测评2.0：MySQL身份鉴别_weixin_39762666的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mysqljs/p/14246130.html">MySQL密码复杂度与密码过期策略介绍 - MySQL技术 - 博客园 (cnblogs.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4ac3cb49d208">mysql查看密码自动过期时间 - 简书 (jianshu.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/andyguan01_2/article/details/88966432">(100条消息) MySQL关闭SSL的方法_andyguan01_2的博客-CSDN博客_mysql关闭openssl</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/63ba67e133ce">配置MySQL支持ssl - 简书 (jianshu.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39572257/article/details/116227265">(100条消息) MySQL配置SSL加密连接_guan-qing的博客-CSDN博客_navicate ssl连接</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Lee_Natuo/article/details/84856377">(100条消息) MySQL数据库安全基线（加固方法）_Lee_Natuo的博客-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_36340926/article/details/113256066">(106条消息) mysql永久修改变量_MySQL 8.0 新特性之持久化全局变量的修改_实在知道什么的博客-CSDN博客</a></li>
</ul>
<h3 id="持久化全局变量"><a href="#持久化全局变量" class="headerlink" title="持久化全局变量"></a>持久化全局变量</h3><p>全局变量的持久化命令</p>
<p>1） <code>SET PERSIST</code> </p>
<ul>
<li>修改内存值，将全局变量的修改持久化到配置文件中</li>
<li>只需要 <code>SYSTEM_VARIABLES_ADMIN</code></li>
</ul>
<p>2）<code>SET PERSIST_ONLY</code></p>
<ul>
<li>只持久化全局变量，而不修改其内存值</li>
<li>需要 <code>SYSTEM_VARIABLES_ADMIN</code> 和 <code>PERSIST_RO_VARIABLES_ADMIN</code> 权限</li>
</ul>
<p>3）<code>set persist max_connections=default;</code></p>
<ul>
<li><p>将全局变量持久化为默认值。注意，是默认值，而不是修改前的值。</p>
</li>
<li><p>这个命令同 <code>set global max_connections=default</code> 类似，都会将变量的值设置为默认值，只不过前者还会将默认值持久化到配置文件中。</p>
</li>
</ul>
<p>清除持久化变量命令</p>
<p>1）<code>RESET PERSIST</code> </p>
<ul>
<li>注意，其只是清空 <code>mysqld-auto.cnf</code> 和 <code>performance_schema.persisted_variables</code> 中的内容，对于已经修改了的变量的值，不会产生任何影响。</li>
</ul>
<h3 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"># 核查是否开启加密通信</span><br><span class="line">show variables like &#x27;have_openssl&#x27;;</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%ssl%&#x27;;</span><br><span class="line"></span><br><span class="line"># 设置为0，即表示密码永不过期</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%default_password_lifetime%&#x27;; </span><br><span class="line">SET GLOBAL default_password_lifetime = 90;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;validate%&#x27;; </span><br><span class="line">INSTALL PLUGIN validate_password SONAME &#x27;validate_password.dll&#x27;;</span><br><span class="line">set global validate_password_length = 16;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;%connection_control%&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL soname &#x27;connection_control.dll&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#x27;connection_control.dll&#x27;;</span><br><span class="line">SET GLOBAL connection_control_failed_connections_threshold = 5;</span><br><span class="line">SET GLOBAL connection_control_min_connection_delay = 900000;</span><br><span class="line"></span><br><span class="line"># 查看已安装插件</span><br><span class="line">show plugins;</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%timeout%&#x27;;</span><br><span class="line">set global connect_timeout = 43200;</span><br><span class="line">set global wait_timeout=28800;</span><br><span class="line">set global interactive_timeout=28800;</span><br><span class="line"></span><br><span class="line">SELECT user, host FROM mysql.user;</span><br><span class="line">create user &#x27;dev&#x27;@&#x27;localhost&#x27; identified by &#x27;Haiyisec@123&#x27;; </span><br><span class="line">create user &#x27;test&#x27;@&#x27;localhost&#x27; identified by &#x27;Haiyisec@123&#x27;; </span><br><span class="line">drop user &#x27;test&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">drop user &#x27;dev&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line"># 设置只允许root用户本地登录</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"># 重命名账号</span><br><span class="line">update user set user=&#x27;haiyi_root&#x27; where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">SELECT user, host FROM mysql.user;</span><br><span class="line"></span><br><span class="line"># 实验时出现问题，更新后无法登录，谨慎操作</span><br><span class="line">UPDATE user SET authentication_string=&quot;123456&quot; WHERE user=&quot;root&quot;;</span><br><span class="line">FLUSH privileges;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;%log%&#x27;;</span><br><span class="line">show variables like &#x27;slow_query_log%&#x27;;</span><br><span class="line">SHOW variables LIKE &#x27;log_error&#x27;;</span><br><span class="line">SELECT @@global.log_bin_basename;</span><br><span class="line">set global general_log=on;</span><br><span class="line"></span><br><span class="line">set global binlog_expire_logs_seconds=2596096;</span><br><span class="line">show variables like &#x27;binlog_expire_logs_seconds&#x27;;</span><br><span class="line">show variables where variable_name = &#x27;datadir&#x27;; </span><br><span class="line"></span><br><span class="line">SELECT user,host FROM mysql.user WHERE user = &#x27;&#x27;;</span><br><span class="line">CREATE DATABASE test;</span><br><span class="line">DROP DATABASE if EXISTS test;</span><br><span class="line">show DATABASES;</span><br><span class="line"></span><br><span class="line"># 查看指定用户权限</span><br><span class="line">SHOW GRANTS FOR &#x27;root&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"># 查看所有用户详细信息</span><br><span class="line">SELECT * FROM mysql.user;</span><br><span class="line"># 查看所有数据库详细</span><br><span class="line">SELECT * FROM mysql.Db;</span><br><span class="line"></span><br><span class="line"># 如下语句查询是否有用户不需要密码即可登录：</span><br><span class="line">select * from mysql.user where length(authentication_string)=0 or authentication_string is null;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%9F%BA%E7%BA%BF%E6%A0%B8%E6%9F%A5%E4%B8%8E%E5%8A%A0%E5%9B%BA/" rel="tag"># 基线核查与加固</a>
              <a href="/tags/mysql/" rel="tag"># mysql</a>
              <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%AD%89%E7%BA%A7%E4%BF%9D%E6%8A%A4%E5%9F%BA%E6%9C%AC%E8%A6%81%E6%B1%82/" rel="tag"># 网络安全等级保护基本要求</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/10/29/pypi/" rel="prev" title="PyPI 镜像使用帮助">
                  <i class="fa fa-angle-left"></i> PyPI 镜像使用帮助
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/04/11/hello-world/" rel="next" title="Hello World">
                  Hello World <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2023 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">G3G4X5X6</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"G3G4X5X6","repo":"G3G4X5X6.github.io","client_id":"dab36424893a52bd9dcd","client_secret":"a6b2b9b66ee5b34562b1124ee87e694d128facc7","admin_user":"G3G4X5X6","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"ffae099df3093f48abcf30e33d7b06bb"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
