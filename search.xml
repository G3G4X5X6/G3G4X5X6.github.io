<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ARPåè®®</title>
    <url>/2023/06/15/ARP%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h2 id="åè®®è§£æ"><a href="#åè®®è§£æ" class="headerlink" title="åè®®è§£æ"></a>åè®®è§£æ</h2><p>ARPï¼ˆAddress Resolution Protocolï¼‰åè®®æ˜¯ä¸€ç§ç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸­è§£æç½‘ç»œå±‚åœ°å€ï¼ˆå¦‚IPåœ°å€ï¼‰ä¸ç‰©ç†åœ°å€ï¼ˆå¦‚MACåœ°å€ï¼‰ä¹‹é—´æ˜ å°„å…³ç³»çš„åè®®ã€‚åœ¨æ•°æ®åŒ…ä»æºä¸»æœºå‘é€åˆ°ç›®æ ‡ä¸»æœºçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å°†ç›®æ ‡ä¸»æœºçš„ç½‘ç»œå±‚åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œæ‰èƒ½åœ¨é“¾è·¯å±‚ä¸Šè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p>
<span id="more"></span>

<p>ARPåè®®å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æºä¸»æœºæ£€æŸ¥ç›®æ ‡IPåœ°å€æ˜¯å¦åœ¨æœ¬åœ°ç½‘ç»œï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™å°†æ•°æ®åŒ…è½¬å‘ç»™é»˜è®¤ç½‘å…³ã€‚</li>
<li>æºä¸»æœºæ£€æŸ¥ARPç¼“å­˜è¡¨ä¸­æ˜¯å¦å·²ç»æœ‰ç›®æ ‡IPåœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥å°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ä¸»æœºçš„ç‰©ç†åœ°å€ã€‚</li>
<li>å¦‚æœARPç¼“å­˜è¡¨ä¸­æ²¡æœ‰ç›®æ ‡IPåœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œæºä¸»æœºå°±ä¼šå‘é€ä¸€ä¸ªARPè¯·æ±‚å¹¿æ’­ï¼Œè¯·æ±‚ç›®æ ‡ä¸»æœºå›å¤è‡ªå·±çš„ç‰©ç†åœ°å€ã€‚</li>
<li>ç½‘ç»œä¸­æ‰€æœ‰çš„ä¸»æœºéƒ½ä¼šæ¥æ”¶åˆ°è¿™ä¸ªARPè¯·æ±‚å¹¿æ’­ï¼Œä½†åªæœ‰ç›®æ ‡ä¸»æœºä¼šå›å¤è‡ªå·±çš„ç‰©ç†åœ°å€ã€‚</li>
<li>ç›®æ ‡ä¸»æœºæ”¶åˆ°ARPè¯·æ±‚åï¼Œä¼šå°†è‡ªå·±çš„ç‰©ç†åœ°å€æ‰“åŒ…åœ¨ARPå›å¤ä¸­å‘é€ç»™æºä¸»æœºã€‚</li>
<li>æºä¸»æœºæ”¶åˆ°ARPå›å¤åï¼Œå°†ç›®æ ‡ä¸»æœºçš„IPåœ°å€å’Œç‰©ç†åœ°å€å­˜å‚¨åœ¨ARPç¼“å­˜è¡¨ä¸­ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡å‘é€æ•°æ®åŒ…æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>
</ol>
<p>ARPåè®®æ˜¯ä¸€ä¸ªç®€å•è€Œé‡è¦çš„åè®®ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ç½‘ç»œä¸­çš„ä¸»æœºå¿«é€Ÿåœ°è§£æIPåœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä»è€Œå®ç°æ•°æ®åŒ…åœ¨å±€åŸŸç½‘å†…çš„å¿«é€Ÿä¼ è¾“ã€‚</p>
<h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_arp_request</span>(<span class="params">source_ip, target_ip, interface</span>):</span><br><span class="line">    <span class="comment"># æ„å»º Ethernet è¯·æ±‚æ•°æ®åŒ…</span></span><br><span class="line">    <span class="comment"># å¹¿æ’­åœ°å€</span></span><br><span class="line">    broadcast_bytes = <span class="string">b&#x27;\xff\xff\xff\xff\xff\xff&#x27;</span></span><br><span class="line">    <span class="comment"># æº MAC åœ°å€</span></span><br><span class="line">    src_mac_bytes = binascii.unhexlify(<span class="string">&#x27;00:50:56:c0:00:08&#x27;</span>.replace(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    ethernet_header = struct.pack(<span class="string">&quot;!6s6s2s&quot;</span>, broadcast_bytes, src_mac_bytes, <span class="string">b&#x27;\x08\x06&#x27;</span>)  <span class="comment"># ARP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»º ARP è¯·æ±‚æ•°æ®åŒ…</span></span><br><span class="line">    source_ip = socket.inet_aton(source_ip)  <span class="comment"># æºIPåœ°å€</span></span><br><span class="line">    target_mac_bytes = <span class="string">b&#x27;\x00\x00\x00\x00\x00\x00&#x27;</span>  <span class="comment"># ç›®æ ‡ MAC åœ°å€</span></span><br><span class="line">    target_ip = socket.inet_aton(target_ip)  <span class="comment"># ç›®æ ‡IPåœ°å€</span></span><br><span class="line"></span><br><span class="line">    arp_request = struct.pack(<span class="string">&#x27;!HHBBH6s4s6s4s&#x27;</span>,</span><br><span class="line">                              <span class="number">0x0001</span>,  <span class="comment"># ç¡¬ä»¶ç±»å‹ï¼šä»¥å¤ªç½‘</span></span><br><span class="line">                              <span class="number">0x0800</span>,  <span class="comment"># åè®®ç±»å‹ï¼šIPv4ï¼ˆè¡¨ç¤ºå‘é€æ–¹è¦æ˜ å°„çš„åè®®åœ°å€ç±»å‹ã€‚å¯¹äºIPåœ°å€ï¼Œè¯¥å€¼ä¸º0x0800ã€‚ï¼‰</span></span><br><span class="line">                              <span class="number">6</span>,  <span class="comment"># ç¡¬ä»¶åœ°å€é•¿åº¦ï¼š6å­—èŠ‚</span></span><br><span class="line">                              <span class="number">4</span>,  <span class="comment"># åè®®åœ°å€é•¿åº¦ï¼š4å­—èŠ‚</span></span><br><span class="line">                              <span class="number">0x0001</span>,  <span class="comment"># æ“ä½œç ï¼šARPè¯·æ±‚</span></span><br><span class="line">                              src_mac_bytes,</span><br><span class="line">                              source_ip,</span><br><span class="line">                              target_mac_bytes,</span><br><span class="line">                              target_ip)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºåŸå§‹å¥—æ¥å­—</span></span><br><span class="line">    <span class="comment"># ä¸å¯æˆ–ç¼ºï¼šsocket.htons(0x0806)ï¼Œå¦åˆ™æ— æ³•æ¥å—è¿”å›</span></span><br><span class="line">    raw_socket = socket.socket(socket.PF_PACKET, socket.SOCK_RAW, socket.htons(<span class="number">0x0806</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»‘å®šæŒ‡å®šçš„ç½‘ç»œæ¥å£</span></span><br><span class="line">    raw_socket.bind((interface, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘é€ARPè¯·æ±‚</span></span><br><span class="line">    raw_socket.send(ethernet_header + arp_request)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¥æ”¶å¹¶è§£æå“åº”</span></span><br><span class="line">    response = raw_socket.recv(<span class="number">2048</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£æå“åº”æ•°æ®åŒ…</span></span><br><span class="line">    _, _, _, _, _, _, _, _, sender_mac, sender_ip, target_mac, target_ip = struct.unpack(<span class="string">&#x27;!6s6s2sHHBBH6s4s6s4s&#x27;</span>,</span><br><span class="line">                                                                                         response)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°ç›®æ ‡MACåœ°å€</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Reply -&gt; IP: <span class="subst">&#123;socket.inet_ntoa(sender_ip)&#125;</span>  MAC: <span class="subst">&#123;<span class="string">&#x27;:&#x27;</span>.join(<span class="built_in">format</span>(x, <span class="string">&#x27;02x&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> sender_mac)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…³é—­åŸå§‹å¥—æ¥å­—</span></span><br><span class="line">    raw_socket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    src_ip = <span class="string">&#x27;172.16.66.1&#x27;</span>  <span class="comment"># ç›®æ ‡IPåœ°å€</span></span><br><span class="line">    dst_ip = <span class="string">&#x27;172.16.66.130&#x27;</span>  <span class="comment"># ç›®æ ‡IPåœ°å€</span></span><br><span class="line">    inter = <span class="string">&#x27;vmnet8&#x27;</span>  <span class="comment"># ç½‘ç»œæ¥å£å</span></span><br><span class="line"></span><br><span class="line">    send_arp_request(src_ip, dst_ip, inter)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>TCP/IPåè®®</category>
      </categories>
      <tags>
        <tag>arp</tag>
        <tag>socket</tag>
        <tag>chatgpt</tag>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust: å¿«é€Ÿå¼€å§‹</title>
    <url>/2024/12/14/Rust-Getting-Started/</url>
    <content><![CDATA[<h1 id="0x01-å®‰è£…"><a href="#0x01-å®‰è£…" class="headerlink" title="0x01. å®‰è£…"></a>0x01. å®‰è£…</h1><p>åœ¨ Rust å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰å·¥å…·éƒ½å®‰è£…åˆ° <code>~/.cargo/bin</code> ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ° Rust å·¥å…·é“¾ï¼ŒåŒ…æ‹¬ <code>rustc</code>ã€<code>cargo</code> å’Œ <code>rustup</code>ã€‚</p>
<h2 id="1-1-Windows"><a href="#1-1-Windows" class="headerlink" title="1.1 Windows"></a>1.1 Windows</h2><ol>
<li>Using rustup (Recommended)<ul>
<li><a href="https://www.rust-lang.org/tools/install">å»å®˜æ–¹ç½‘ç«™ä¸‹è½½å®‰è£…ç¨‹åº</a></li>
</ul>
</li>
<li>Windows Subsystem for Linux<ul>
<li><code>curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh</code></li>
</ul>
</li>
</ol>
<span id="more"></span>

<h2 id="1-2-Linux-MacOS"><a href="#1-2-Linux-MacOS" class="headerlink" title="1.2 Linux &amp; MacOS"></a>1.2 Linux &amp; MacOS</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br></pre></td></tr></table></figure>


<h1 id="0x02-æ›´æ–°"><a href="#0x02-æ›´æ–°" class="headerlink" title="0x02. æ›´æ–°"></a>0x02. æ›´æ–°</h1><p>è¦æ›´æ–° Rustï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯æ›´æ–°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rustup update</span><br></pre></td></tr></table></figure>

<h1 id="0x03-å¸è½½"><a href="#0x03-å¸è½½" class="headerlink" title="0x03. å¸è½½"></a>0x03. å¸è½½</h1><p>è¦å¸è½½ Rust å’Œ rustupï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¸è½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rustup self uninstall</span><br></pre></td></tr></table></figure>

<h1 id="0x04-æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸ"><a href="#0x04-æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸ" class="headerlink" title="0x04. æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸ"></a>0x04. æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸ</h1><p>æ£€æŸ¥æ˜¯å¦æ­£ç¡®å®‰è£…äº† Rustï¼Œå¯æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ä¸‹é¢è¿™è¡Œï¼Œæ­¤æ—¶èƒ½çœ‹åˆ°æœ€æ–°å‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬çš„ç‰ˆæœ¬å·ã€æäº¤å“ˆå¸Œå€¼å’Œæäº¤æ—¥æœŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rustc -V</span><br><span class="line"><span class="comment"># rustc 1.83.0 (90b35a623 2024-11-26)</span></span><br><span class="line"></span><br><span class="line">cargo -V</span><br><span class="line"><span class="comment"># cargo 1.83.0 (5ffbef321 2024-10-29)</span></span><br></pre></td></tr></table></figure>

<h1 id="0x05-åˆ‡æ¢å›½å†…é•œåƒæº"><a href="#0x05-åˆ‡æ¢å›½å†…é•œåƒæº" class="headerlink" title="0x05. åˆ‡æ¢å›½å†…é•œåƒæº"></a>0x05. åˆ‡æ¢å›½å†…é•œåƒæº</h1><blockquote>
<p>ç”±äºå›½å†…æ‹‰å– crates.io ä»¥åŠå®‰è£… Rust ä¼šé¢ä¸´æµé‡å‡ºå¢ƒä¸ç¨³å®šçš„é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå›½å†…é•œåƒä»£ç†ä»¥å¸®åŠ©å›½å†… Rust ç”Ÿæ€å‘å±•ï¼Œæ¬¢è¿å¤§å®¶ä½¿ç”¨ã€‚ï¼ˆ<a href="https://rsproxy.cn/#getStarted">rsproxy</a>ï¼‰<br>â€”â€”å­—èŠ‚è·³åŠ¨</p>
</blockquote>
<h2 id="5-1-é…ç½®è¯´æ˜"><a href="#5-1-é…ç½®è¯´æ˜" class="headerlink" title="5.1 é…ç½®è¯´æ˜"></a>5.1 é…ç½®è¯´æ˜</h2><p>æ­¥éª¤ä¸€ï¼šè®¾ç½® Rustup é•œåƒï¼Œ ä¿®æ”¹é…ç½® ~&#x2F;.zshrc or ~&#x2F;.bashrc</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export RUSTUP_DIST_SERVER=&quot;https://rsproxy.cn&quot;</span><br><span class="line">export RUSTUP_UPDATE_ROOT=&quot;https://rsproxy.cn/rustup&quot;</span><br></pre></td></tr></table></figure>

<p>æ­¥éª¤äºŒï¼šå®‰è£… Rustï¼ˆè¯·å…ˆå®Œæˆæ­¥éª¤ä¸€çš„ç¯å¢ƒå˜é‡å¯¼å…¥å¹¶ source rc æ–‡ä»¶æˆ–é‡å¯ç»ˆç«¯ç”Ÿæ•ˆï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://rsproxy.cn/rustup-init.sh | sh</span><br></pre></td></tr></table></figure>

<p>æ­¥éª¤ä¸‰ï¼šè®¾ç½® crates.io é•œåƒï¼Œ ä¿®æ”¹é…ç½® ~&#x2F;.cargo&#x2F;configï¼Œå·²æ”¯æŒgitåè®®å’Œsparseåè®®ï¼Œ&gt;&#x3D;1.68 ç‰ˆæœ¬å»ºè®®ä½¿ç”¨ sparse-indexï¼Œé€Ÿåº¦æ›´å¿«ã€‚ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[source.crates-io]</span><br><span class="line">replace-with = &#x27;rsproxy-sparse&#x27;</span><br><span class="line">[source.rsproxy]</span><br><span class="line">registry = &quot;https://rsproxy.cn/crates.io-index&quot;</span><br><span class="line">[source.rsproxy-sparse]</span><br><span class="line">registry = &quot;sparse+https://rsproxy.cn/index/&quot;</span><br><span class="line">[registries.rsproxy]</span><br><span class="line">index = &quot;https://rsproxy.cn/crates.io-index&quot;</span><br><span class="line">[net]</span><br><span class="line">git-fetch-with-cli = true</span><br></pre></td></tr></table></figure>

<h1 id="0x06-æœ¬åœ°æ–‡æ¡£"><a href="#0x06-æœ¬åœ°æ–‡æ¡£" class="headerlink" title="0x06. æœ¬åœ°æ–‡æ¡£"></a>0x06. æœ¬åœ°æ–‡æ¡£</h1><p>Rust çš„å®‰è£…è¿˜åŒ…æ‹¬æ–‡æ¡£çš„æœ¬åœ°å‰¯æœ¬ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ç¦»çº¿é˜…è¯»ã€‚è¿è¡Œ <code>rustup doc</code> å³å¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æœ¬åœ°æ–‡æ¡£ã€‚</p>
<h1 id="0x07-ç¤ºä¾‹"><a href="#0x07-ç¤ºä¾‹" class="headerlink" title="0x07. ç¤ºä¾‹"></a>0x07. ç¤ºä¾‹</h1><h2 id="7-1-åˆ›å»ºé¡¹ç›®ç›®å½•"><a href="#7-1-åˆ›å»ºé¡¹ç›®ç›®å½•" class="headerlink" title="7.1 åˆ›å»ºé¡¹ç›®ç›®å½•"></a>7.1 åˆ›å»ºé¡¹ç›®ç›®å½•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> hello_world</span><br><span class="line"><span class="built_in">cd</span> hello_world</span><br></pre></td></tr></table></figure>

<h2 id="7-2-ç¼–å†™å¹¶è¿è¡ŒRustç¨‹åº"><a href="#7-2-ç¼–å†™å¹¶è¿è¡ŒRustç¨‹åº" class="headerlink" title="7.2 ç¼–å†™å¹¶è¿è¡ŒRustç¨‹åº"></a>7.2 ç¼–å†™å¹¶è¿è¡ŒRustç¨‹åº</h2><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æºæ–‡ä»¶å¹¶å°†å…¶å‘½åä¸º <code>main.rs</code>ã€‚Rust æ–‡ä»¶å§‹ç»ˆä»¥ <code>.rs</code> æ‰©å±•åç»“å°¾ã€‚å¦‚æœæ–‡ä»¶åä¸­ä½¿ç”¨å¤šä¸ªå•è¯ï¼Œåˆ™æƒ¯ä¾‹æ˜¯ä½¿ç”¨ä¸‹åˆ’çº¿å°†å®ƒä»¬åˆ†éš”å¼€ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>hello_world.rs</code> è€Œä¸æ˜¯ <code>helloworld.rs</code>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rustc main.rs</span><br><span class="line">./main</span><br><span class="line"><span class="comment"># Hello, world!</span></span><br></pre></td></tr></table></figure>
















]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Cargo ä½¿ç”¨æŒ‡å—ä¹‹ä»£ç ç»„ç»‡ç®¡ç†</title>
    <url>/2024/12/14/Rust-Cargo-Workspace/</url>
    <content><![CDATA[<p>Cargo æ˜¯ Rust è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚Cargo å¯ä»¥ä¸‹è½½ Rust è½¯ä»¶åŒ…çš„ä¾èµ–é¡¹ã€ç¼–è¯‘è½¯ä»¶åŒ…ã€åˆ¶ä½œå¯åˆ†å‘çš„è½¯ä»¶åŒ…ï¼Œå¹¶å°†å®ƒä»¬ä¸Šä¼ åˆ° Rust ç¤¾åŒºçš„è½¯ä»¶åŒ…æ³¨å†Œä¸­å¿ƒï¼ˆ<a href="crates.io">Package Registry</a> ï¼‰ ã€‚</p>
<h1 id="0x01-å¿«é€Ÿä¸Šæ‰‹"><a href="#0x01-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="0x01. å¿«é€Ÿä¸Šæ‰‹"></a>0x01. å¿«é€Ÿä¸Šæ‰‹</h1><h2 id="1-1-åˆ›å»ºäºŒè¿›åˆ¶é¡¹ç›®"><a href="#1-1-åˆ›å»ºäºŒè¿›åˆ¶é¡¹ç›®" class="headerlink" title="1.1 åˆ›å»ºäºŒè¿›åˆ¶é¡¹ç›®"></a>1.1 åˆ›å»ºäºŒè¿›åˆ¶é¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo new hello_world</span><br><span class="line"><span class="comment"># ç­‰ä»·äº cargo new hello_world --bin</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> hello_world/</span><br><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„</span></span><br><span class="line">tree .</span><br><span class="line"><span class="comment"># .</span></span><br><span class="line"><span class="comment"># â”œâ”€â”€ Cargo.toml</span></span><br><span class="line"><span class="comment"># â””â”€â”€ src</span></span><br><span class="line"><span class="comment">#     â””â”€â”€ main.rs</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 2 directories, 2 files</span></span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cat src/main.rs</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line">// cat Cargo.toml</span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello_world&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œ</span></span><br><span class="line">cargo run</span><br><span class="line"><span class="comment">#    Compiling hello_world v0.1.0 (/home/sec/rust-code/hello_world)</span></span><br><span class="line"><span class="comment">#     Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.74s</span></span><br><span class="line"><span class="comment">#      Running `target/debug/hello_world`</span></span><br><span class="line"><span class="comment"># Hello, world!</span></span><br></pre></td></tr></table></figure>


<h2 id="1-2-åˆ›å»ºä¾èµ–åº“é¡¹ç›®"><a href="#1-2-åˆ›å»ºä¾èµ–åº“é¡¹ç›®" class="headerlink" title="1.2 åˆ›å»ºä¾èµ–åº“é¡¹ç›®"></a>1.2 åˆ›å»ºä¾èµ–åº“é¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo new hello_world --lib</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> hello_world/</span><br><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„</span></span><br><span class="line">tree .</span><br><span class="line"><span class="comment"># .</span></span><br><span class="line"><span class="comment"># â”œâ”€â”€ Cargo.toml</span></span><br><span class="line"><span class="comment"># â””â”€â”€ src</span></span><br><span class="line"><span class="comment">#     â””â”€â”€ lib.rs</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 2 directories, 2 files</span></span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(left: <span class="type">u64</span>, right: <span class="type">u64</span>) <span class="punctuation">-&gt;</span> <span class="type">u64</span> &#123;</span><br><span class="line">    left + right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(result, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line">// Cargo.toml</span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello_world&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»£ç æµ‹è¯•</span></span><br><span class="line">cargo <span class="built_in">test</span></span><br><span class="line"><span class="comment">#    Compiling hello_world v0.1.0 (/home/sec/rust-code/hello_world)</span></span><br><span class="line"><span class="comment">#     Finished `test` profile [unoptimized + debuginfo] target(s) in 0.51s</span></span><br><span class="line"><span class="comment">#      Running unittests src/lib.rs (target/debug/deps/hello_world-75e6e3a0ae56ef19)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># running 1 test</span></span><br><span class="line"><span class="comment"># test tests::it_works ... ok</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#    Doc-tests hello_world</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># running 0 tests</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span></span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure>




<h2 id="1-3-ä¸‹è½½é¡¹ç›®å¹¶æ„å»º"><a href="#1-3-ä¸‹è½½é¡¹ç›®å¹¶æ„å»º" class="headerlink" title="1.3 ä¸‹è½½é¡¹ç›®å¹¶æ„å»º"></a>1.3 ä¸‹è½½é¡¹ç›®å¹¶æ„å»º</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/rust-lang/regex.git</span><br><span class="line"><span class="comment"># Cloning into &#x27;regex&#x27;...</span></span><br><span class="line"><span class="comment"># remote: Enumerating objects: 9712, done.</span></span><br><span class="line"><span class="comment"># remote: Counting objects: 100% (3776/3776), done.</span></span><br><span class="line"><span class="comment"># remote: Compressing objects: 100% (1345/1345), done.</span></span><br><span class="line"><span class="comment"># remote: Total 9712 (delta 2492), reused 3367 (delta 2373), pack-reused 5936 (from 1)</span></span><br><span class="line"><span class="comment"># Receiving objects: 100% (9712/9712), 8.03 MiB | 816.00 KiB/s, done.</span></span><br><span class="line"><span class="comment"># Resolving deltas: 100% (6364/6364), done.</span></span><br><span class="line"><span class="built_in">cd</span> regex</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ„å»º</span></span><br><span class="line">cargo build</span><br><span class="line"><span class="comment">#     Updating `rsproxy-sparse` index</span></span><br><span class="line"><span class="comment">#      Locking 54 packages to latest compatible versions</span></span><br><span class="line"><span class="comment">#       Adding env_logger v0.9.3 (available: v0.11.5)</span></span><br><span class="line"><span class="comment">#    Compiling memchr v2.7.4</span></span><br><span class="line"><span class="comment">#    Compiling regex-syntax v0.8.5 (/home/sec/rust-code/regex/regex-syntax)</span></span><br><span class="line"><span class="comment">#    Compiling aho-corasick v1.1.3</span></span><br><span class="line"><span class="comment">#    Compiling regex-automata v0.4.9 (/home/sec/rust-code/regex/regex-automata)</span></span><br><span class="line"><span class="comment">#    Compiling regex v1.11.1 (/home/sec/rust-code/regex)</span></span><br><span class="line"><span class="comment">#     Finished `dev` profile [optimized + debuginfo] target(s) in 7.13s</span></span><br></pre></td></tr></table></figure>


<h1 id="0x02-æ ¸å¿ƒæ¦‚å¿µ"><a href="#0x02-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="0x02. æ ¸å¿ƒæ¦‚å¿µ"></a>0x02. æ ¸å¿ƒæ¦‚å¿µ</h1><h2 id="2-1-Module"><a href="#2-1-Module" class="headerlink" title="2.1 Module"></a>2.1 Module</h2><ul>
<li>æ¨¡å—(Module)ï¼šå¯ä»¥ç”¨æ¥å°†ä»£ç åˆ†å±‚åœ°æ‹†åˆ†ä¸ºé€»è¾‘å•å…ƒï¼ˆæ¨¡å—ï¼‰ï¼Œå¹¶ç®¡ç†å®ƒä»¬ä¹‹é—´çš„å¯è§æ€§ï¼ˆå…¬å…±&#x2F;ç§æœ‰ï¼‰</li>
<li>æ¨¡å—ä¸­åŒ…å«ï¼šå‡½æ•°ã€ç»“æ„ã€ç‰¹å¾ã€å®ç°å—ï¼Œç”šè‡³å…¶ä»–æ¨¡å—ã€‚</li>
<li>ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å¤šä¸ªæ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—å¯ä»¥è¢«è®¤ä¸ºæ˜¯çœŸå®é¡¹ç›®ä¸­çš„<strong>ä»£ç ç»„ç»‡å•å…ƒ</strong></li>
</ul>
<h2 id="2-2-Crate"><a href="#2-2-Crate" class="headerlink" title="2.2 Crate"></a>2.2 Crate</h2><ul>
<li>æ¿æ¡ç®± (Crate) æ˜¯ Rust ä¸­çš„<strong>ç¼–è¯‘å•å…ƒ</strong>ã€‚</li>
</ul>
<h2 id="2-3-Package"><a href="#2-3-Package" class="headerlink" title="2.3  Package"></a>2.3  Package</h2><ul>
<li>åŒ…ï¼ˆpackageï¼‰æ˜¯ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª crate çš„é›†åˆï¼Œç”¨äºæä¾›ä¸€ç»„åŠŸèƒ½ã€‚</li>
<li>ä¸€ä¸ªåŒ…ï¼ˆpackageï¼‰åŒ…å«ä¸€ä¸ª <code>Cargo.toml</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†å¦‚ä½•æ„å»ºè¿™äº› crateã€‚</li>
<li>ä¸€ä¸ªåŒ…ï¼ˆpackageï¼‰å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªäºŒè¿›åˆ¶ crateï¼Œä½†æœ€å¤šåªèƒ½åŒ…å«ä¸€ä¸ªåº“ crateã€‚</li>
<li>ä¸€ä¸ªåŒ…ï¼ˆpackageï¼‰å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ª crateï¼Œæ— è®ºæ˜¯åº“ crate è¿˜æ˜¯äºŒè¿›åˆ¶ crateã€‚</li>
</ul>
<h3 id="2-3-1-Package-ç›®å½•å¸ƒå±€"><a href="#2-3-1-Package-ç›®å½•å¸ƒå±€" class="headerlink" title="2.3.1 Package ç›®å½•å¸ƒå±€"></a>2.3.1 Package ç›®å½•å¸ƒå±€</h3><p>Cargo ä½¿ç”¨çº¦å®šæ¥æ”¾ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿è½»æ¾è¿›å…¥æ–°çš„ Cargo Package</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Cargo.lock</span><br><span class="line">â”œâ”€â”€ Cargo.toml</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ lib.rs</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ main.rs</span><br><span class="line">â”‚Â Â  â””â”€â”€ bin/</span><br><span class="line">â”‚       â”œâ”€â”€ named-executable.rs</span><br><span class="line">â”‚Â Â   Â Â  â”œâ”€â”€ another-executable.rs</span><br><span class="line">â”‚Â Â   Â Â  â””â”€â”€ multi-file-executable/</span><br><span class="line">â”‚Â Â   Â Â      â”œâ”€â”€ main.rs</span><br><span class="line">â”‚Â Â   Â Â      â””â”€â”€ some_module.rs</span><br><span class="line">â”œâ”€â”€ benches/</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ large-input.rs</span><br><span class="line">â”‚Â Â  â””â”€â”€ multi-file-bench/</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ main.rs</span><br><span class="line">â”‚Â Â      â””â”€â”€ bench_module.rs</span><br><span class="line">â”œâ”€â”€ examples/</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ simple.rs</span><br><span class="line">â”‚Â Â  â””â”€â”€ multi-file-example/</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ main.rs</span><br><span class="line">â”‚Â Â      â””â”€â”€ ex_module.rs</span><br><span class="line">â””â”€â”€ tests/</span><br><span class="line">    â”œâ”€â”€ some-integration-tests.rs</span><br><span class="line">    â””â”€â”€ multi-file-test/</span><br><span class="line">        â”œâ”€â”€ main.rs</span><br><span class="line">        â””â”€â”€ test_module.rs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Cargo.toml</code> å’Œ <code>Cargo.lock</code> å­˜å‚¨åœ¨åŒ…çš„æ ¹ç›®å½•ä¸­ï¼ˆåŒ…æ ¹ç›®å½•ï¼‰ã€‚</li>
<li>æºä»£ç æ”¾åœ¨ <code>src</code> ç›®å½•ä¸­ã€‚</li>
<li>é»˜è®¤åº“æ–‡ä»¶æ˜¯ <code>src/lib.rs</code>ã€‚</li>
<li>é»˜è®¤å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ <code>src/main.rs</code>ã€‚<ul>
<li>å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ”¾åœ¨ <code>src/bin/</code> ä¸­ã€‚</li>
</ul>
</li>
<li>åŸºå‡†æµ‹è¯•æ”¾åœ¨ <code>benches</code> ç›®å½•ä¸­ã€‚</li>
<li>ç¤ºä¾‹æ”¾åœ¨ <code>examples</code> ç›®å½•ä¸­ã€‚</li>
<li>é›†æˆæµ‹è¯•æ”¾åœ¨ <code>tests</code> ç›®å½•ä¸­ã€‚</li>
</ul>
<h2 id="2-4-Workspace"><a href="#2-4-Workspace" class="headerlink" title="2.4 Workspace"></a>2.4 Workspace</h2><p>å·¥ä½œåŒº(Workspace)æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…(Package)çš„é›†åˆï¼Œè¿™äº›åŒ…ç§°ä¸ºå·¥ä½œåŒºæˆå‘˜ï¼Œå®ƒä»¬ä¸€èµ·è¿›è¡Œç®¡ç†ã€‚</p>
<h1 id="0x03-åŸºç¡€åŒ…ç®¡ç†"><a href="#0x03-åŸºç¡€åŒ…ç®¡ç†" class="headerlink" title="0x03. åŸºç¡€åŒ…ç®¡ç†"></a>0x03. åŸºç¡€åŒ…ç®¡ç†</h1><h2 id="3-1-åŒ…å«ä¸€ä¸ª-crate"><a href="#3-1-åŒ…å«ä¸€ä¸ª-crate" class="headerlink" title="3.1 åŒ…å«ä¸€ä¸ª crate"></a>3.1 åŒ…å«ä¸€ä¸ª crate</h2><ul>
<li>åº“ crate<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> hello_world/</span><br><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„</span></span><br><span class="line">tree .</span><br><span class="line"><span class="comment"># .</span></span><br><span class="line"><span class="comment"># â”œâ”€â”€ Cargo.toml</span></span><br><span class="line"><span class="comment"># â””â”€â”€ src</span></span><br><span class="line"><span class="comment">#     â””â”€â”€ lib.rs</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 2 directories, 2 files</span></span><br></pre></td></tr></table></figure></li>
<li>äºŒè¿›åˆ¶ crate<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> hello_world/</span><br><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„</span></span><br><span class="line">tree .</span><br><span class="line"><span class="comment"># .</span></span><br><span class="line"><span class="comment"># â”œâ”€â”€ Cargo.toml</span></span><br><span class="line"><span class="comment"># â””â”€â”€ src</span></span><br><span class="line"><span class="comment">#     â””â”€â”€ main.rs</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 2 directories, 2 files</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-2-åŒ…å«å¤šä¸ª-crate"><a href="#3-2-åŒ…å«å¤šä¸ª-crate" class="headerlink" title="3.2 åŒ…å«å¤šä¸ª crate"></a>3.2 åŒ…å«å¤šä¸ª crate</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåº“crate</span></span><br><span class="line">cargo new mutil_crate --lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ `src/main.rs`ï¼Œå…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ”¾åœ¨ `src/bin/` ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå¤šä¸ªäºŒè¿›åˆ¶crate</span></span><br><span class="line"><span class="built_in">mkdir</span> src/bin</span><br><span class="line">vim src/bin/main1.rs</span><br><span class="line">vim src/bin/main2.rs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Packageç»“æ„</span></span><br><span class="line">tree .</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ Cargo.toml</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â”œâ”€â”€ bin</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ main1.rs</span><br><span class="line">    â”‚Â Â  â””â”€â”€ main2.rs</span><br><span class="line">    â””â”€â”€ lib.rs</span><br><span class="line"></span><br><span class="line">3 directories, 4 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡ŒæŒ‡å®šäºŒè¿›åˆ¶crate</span></span><br><span class="line">cargo run --bin main1</span><br><span class="line"><span class="comment">#    Compiling mutil_crate v0.1.0 (/home/sec/rust-code/mutil_crate)</span></span><br><span class="line"><span class="comment">#     Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.23s</span></span><br><span class="line"><span class="comment">#      Running `target/debug/main1`</span></span><br><span class="line"><span class="comment"># Hello, main1!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œåº“crateå•å…ƒæµ‹è¯•</span></span><br><span class="line">cargo <span class="built_in">test</span> --lib</span><br><span class="line"><span class="comment">#    Compiling mutil_crate v0.1.0 (/home/sec/rust-code/mutil_crate)</span></span><br><span class="line"><span class="comment">#     Finished `test` profile [unoptimized + debuginfo] target(s) in 0.27s</span></span><br><span class="line"><span class="comment">#      Running unittests src/lib.rs (target/debug/deps/mutil_crate-55531a037166be43)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># running 1 test</span></span><br><span class="line"><span class="comment"># test tests::it_works ... ok</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span></span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure>



<h1 id="0x04-è¿›é˜¶å·¥ä½œç©ºé—´"><a href="#0x04-è¿›é˜¶å·¥ä½œç©ºé—´" class="headerlink" title="0x04. è¿›é˜¶å·¥ä½œç©ºé—´"></a>0x04. è¿›é˜¶å·¥ä½œç©ºé—´</h1><p>å·¥ä½œåŒºæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…çš„é›†åˆï¼Œè¿™äº›åŒ…ç§°ä¸ºå·¥ä½œåŒºæˆå‘˜ï¼Œå®ƒä»¬ä¸€èµ·è¿›è¡Œç®¡ç†ã€‚</p>
<h2 id="4-1-åŠŸèƒ½è¦ç‚¹"><a href="#4-1-åŠŸèƒ½è¦ç‚¹" class="headerlink" title="4.1 åŠŸèƒ½è¦ç‚¹"></a>4.1 åŠŸèƒ½è¦ç‚¹</h2><ul>
<li>é€šç”¨å‘½ä»¤å¯ä»¥åœ¨æ‰€æœ‰å·¥ä½œåŒºæˆå‘˜ä¸­è¿è¡Œï¼Œä¾‹å¦‚ <code>cargo check --workspace</code>ã€‚</li>
<li>æ‰€æœ‰åŒ…å…±äº«ä¸€ä¸ªä½äºå·¥ä½œåŒºæ ¹ç›®å½•ä¸­çš„é€šç”¨ <code>Cargo.lock</code> æ–‡ä»¶ã€‚</li>
<li>æ‰€æœ‰åŒ…å…±äº«ä¸€ä¸ªé€šç”¨è¾“å‡ºç›®å½•ï¼Œè¯¥ç›®å½•é»˜è®¤ä¸ºå·¥ä½œåŒºæ ¹ç›®å½•ä¸­åä¸º <code>target</code> çš„ç›®å½•ã€‚</li>
<li>å…±äº«åŒ…å…ƒæ•°æ®ï¼Œä¾‹å¦‚ä¸ <code>workspace.package</code>ã€‚</li>
<li><code>Cargo.toml</code> ä¸­çš„ <code>[patch]</code>ã€<code>[replace] </code> å’Œ <code>[profile.*]</code> éƒ¨åˆ†ä»…åœ¨æ ¹æ¸…å•ä¸­è¢«è¯†åˆ«ï¼Œå¹¶åœ¨æˆå‘˜åŒ…çš„æ¸…å•ä¸­è¢«å¿½ç•¥ã€‚</li>
</ul>
<h2 id="4-2-æ”¯æŒé…ç½®"><a href="#4-2-æ”¯æŒé…ç½®" class="headerlink" title="4.2 æ”¯æŒé…ç½®"></a>4.2 æ”¯æŒé…ç½®</h2><p>å·¥ä½œåŒºçš„æ ¹ <code>Cargo.toml</code> æ”¯æŒä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li>[workspace] â€” å®šä¹‰å·¥ä½œåŒºã€‚<ul>
<li>resolver â€” è®¾ç½®è¦ä½¿ç”¨çš„ä¾èµ–é¡¹è§£æå™¨ã€‚</li>
<li>members â€” å·¥ä½œåŒºä¸­è¦åŒ…å«çš„è½¯ä»¶åŒ…ã€‚</li>
<li>exclude â€” ä»å·¥ä½œåŒºä¸­æ’é™¤çš„è½¯ä»¶åŒ…ã€‚</li>
<li>default-members â€” æœªé€‰æ‹©ç‰¹å®šè½¯ä»¶åŒ…æ—¶è¦æ“ä½œçš„è½¯ä»¶åŒ…ã€‚</li>
<li>package â€” è½¯ä»¶åŒ…ä¸­ç”¨äºç»§æ‰¿çš„é”®ã€‚</li>
<li>dependency â€” è½¯ä»¶åŒ…ä¾èµ–é¡¹ä¸­ç”¨äºç»§æ‰¿çš„é”®ã€‚</li>
<li>lints â€” è½¯ä»¶åŒ… lints ä¸­ç”¨äºç»§æ‰¿çš„é”®ã€‚</li>
<li>metadata â€” å¤–éƒ¨å·¥å…·çš„é¢å¤–è®¾ç½®ã€‚</li>
</ul>
</li>
<li>[patch] â€” è¦†ç›–ä¾èµ–é¡¹ã€‚</li>
<li>[replace] â€” è¦†ç›–ä¾èµ–é¡¹ï¼ˆå·²å¼ƒç”¨ï¼‰ã€‚</li>
<li>[profile] â€” ç¼–è¯‘å™¨è®¾ç½®å’Œä¼˜åŒ–ã€‚</li>
</ul>
<h2 id="4-3-åˆ›å»ºå·¥ä½œç©ºé—´"><a href="#4-3-åˆ›å»ºå·¥ä½œç©ºé—´" class="headerlink" title="4.3 åˆ›å»ºå·¥ä½œç©ºé—´"></a>4.3 åˆ›å»ºå·¥ä½œç©ºé—´</h2><p>å·¥ä½œåŒºè‡³å°‘å¿…é¡»æœ‰ä¸€ä¸ªæˆå‘˜ï¼Œè¦ä¹ˆæ˜¯æ ¹åŒ…ï¼Œè¦ä¹ˆæ˜¯è™šæ‹Ÿæ¸…å•ã€‚</p>
<p>è¦åˆ›å»ºå·¥ä½œåŒºï¼Œè¯·å°† <code>[workspace]</code> è¡¨æ·»åŠ åˆ° <code>Cargo.toml</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[workspace]</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-1-æœ‰æ ¹-Package-çš„å·¥ä½œç©ºé—´"><a href="#4-3-1-æœ‰æ ¹-Package-çš„å·¥ä½œç©ºé—´" class="headerlink" title="4.3.1 æœ‰æ ¹ Package çš„å·¥ä½œç©ºé—´"></a>4.3.1 æœ‰æ ¹ Package çš„å·¥ä½œç©ºé—´</h3><p>å¦‚æœåœ¨å·²ç»å®šä¹‰ <code>[package]</code> çš„ <code>Cargo.toml</code> ä¸­æ·»åŠ äº† <code>[workspace]</code> éƒ¨åˆ†ï¼Œåˆ™è¯¥åŒ…æ˜¯å·¥ä½œåŒºçš„æ ¹åŒ…ã€‚å·¥ä½œåŒºæ ¹ç›®å½•æ˜¯å·¥ä½œåŒºçš„ <code>Cargo.toml</code> æ‰€åœ¨çš„ç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[workspace]</span><br><span class="line"></span><br><span class="line">[package]</span><br><span class="line">name = <span class="string">&quot;hello_world&quot;</span> <span class="comment"># the name of the package</span></span><br><span class="line">version = <span class="string">&quot;0.1.0&quot;</span>    <span class="comment"># the current version, obeying semver</span></span><br><span class="line">authors = [<span class="string">&quot;Alice &lt;a@example.com&gt;&quot;</span>, <span class="string">&quot;Bob &lt;b@example.com&gt;&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-è™šæ‹Ÿå·¥ä½œç©ºé—´"><a href="#4-3-2-è™šæ‹Ÿå·¥ä½œç©ºé—´" class="headerlink" title="4.3.2 è™šæ‹Ÿå·¥ä½œç©ºé—´"></a>4.3.2 è™šæ‹Ÿå·¥ä½œç©ºé—´</h3><p>æˆ–è€…ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å« <code>[workspace]</code> éƒ¨åˆ†ä½†ä¸åŒ…å« <code>[package]</code> éƒ¨åˆ†çš„ <code>Cargo.toml</code> æ–‡ä»¶ã€‚è¿™ç§°ä¸ºè™šæ‹Ÿæ¸…å•ã€‚å½“æ²¡æœ‰â€œä¸»â€åŒ…æˆ–æ‚¨å¸Œæœ›å°†æ‰€æœ‰åŒ…ç»„ç»‡åœ¨å•ç‹¬çš„ç›®å½•ä¸­æ—¶ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># [PROJECT_DIR]/Cargo.toml</span></span><br><span class="line">[workspace]</span><br><span class="line">members = [<span class="string">&quot;hello_world&quot;</span>]</span><br><span class="line">resolver = <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># [PROJECT_DIR]/hello_world/Cargo.toml</span></span><br><span class="line">[package]</span><br><span class="line">name = <span class="string">&quot;hello_world&quot;</span> <span class="comment"># the name of the package</span></span><br><span class="line">version = <span class="string">&quot;0.1.0&quot;</span>    <span class="comment"># the current version, obeying semver</span></span><br><span class="line">edition = <span class="string">&quot;2021&quot;</span>     <span class="comment"># the edition, will have no effect on a resolver used in the workspace</span></span><br><span class="line">authors = [<span class="string">&quot;Alice &lt;a@example.com&gt;&quot;</span>, <span class="string">&quot;Bob &lt;b@example.com&gt;&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>å¿…é¡»åœ¨è™šæ‹Ÿå·¥ä½œåŒºä¸­æ˜ç¡®è®¾ç½®è§£æå™¨ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ <code>package.edition</code> æ¥ä»è§£æå™¨ç‰ˆæœ¬æ¨æ–­å®ƒã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å·¥ä½œåŒºæ ¹ç›®å½•ä¸­è¿è¡Œçš„å‘½ä»¤å°†é’ˆå¯¹æ‰€æœ‰å·¥ä½œåŒºæˆå‘˜è¿è¡Œï¼Œè¯·å‚é˜… <a href="https://doc.rust-lang.org/stable/cargo/reference/workspaces.html#the-default-members-field"><code>default-members</code></a>ã€‚</li>
</ul>
<h2 id="4-4-å°ç»“"><a href="#4-4-å°ç»“" class="headerlink" title="4.4 å°ç»“"></a>4.4 å°ç»“</h2><ol>
<li>åˆ›å»ºå·¥ä½œç©ºé—´å°±æ˜¯åœ¨  <code>Cargo.toml</code> ä¸­æ·»åŠ äº† <code>[workspace]</code> éƒ¨åˆ†ã€‚</li>
<li>æˆå‘˜ <code>Package</code> å¯¹ <code>Workspace</code> çš„æ•°æ®ç»§æ‰¿ã€‚</li>
<li><code>cargo</code> é€šç”¨å‘½ä»¤å¯ä»¥å¯¹ç©ºé—´æˆå‘˜è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</li>
<li>å…·ä½“ <code>[workspace]</code> éƒ¨åˆ†é…ç½®ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹å®˜æ–¹æŒ‡å—ï¼š <a href="https://doc.rust-lang.org/stable/cargo/reference/workspaces.html#workspaces">Workspaces</a></li>
</ol>
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
        <tag>ç¬”è®°</tag>
        <tag>Cargo</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust â€œç±»å‹â€</title>
    <url>/2024/12/14/Rust-Types/</url>
    <content><![CDATA[<h1 id="0x01-æ ‡é‡ç±»å‹"><a href="#0x01-æ ‡é‡ç±»å‹" class="headerlink" title="0x01. æ ‡é‡ç±»å‹"></a>0x01. æ ‡é‡ç±»å‹</h1><p>æ ‡é‡ç±»å‹è¡¨ç¤ºå•ä¸ªå€¼ã€‚Rust æœ‰å››ç§ä¸»è¦æ ‡é‡ç±»å‹ï¼šæ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼å’Œå­—ç¬¦ã€‚</p>
<span id="more"></span>

<h2 id="1-1-æ•´æ•°ç±»å‹"><a href="#1-1-æ•´æ•°ç±»å‹" class="headerlink" title="1.1 æ•´æ•°ç±»å‹"></a>1.1 æ•´æ•°ç±»å‹</h2><p>Rust ä¸­çš„æ•´æ•°ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th align="center">Length</th>
<th align="center">Signed</th>
<th align="center">Unsigned</th>
</tr>
</thead>
<tbody><tr>
<td align="center">8-bit</td>
<td align="center"><code>i8</code></td>
<td align="center"><code>u8</code></td>
</tr>
<tr>
<td align="center">16-bit</td>
<td align="center"><code>i16</code></td>
<td align="center"><code>u16</code></td>
</tr>
<tr>
<td align="center">32-bit</td>
<td align="center"><code>i32</code></td>
<td align="center"><code>u32</code></td>
</tr>
<tr>
<td align="center">64-bit</td>
<td align="center"><code>i64</code></td>
<td align="center"><code>u64</code></td>
</tr>
<tr>
<td align="center">128-bit</td>
<td align="center"><code>i128</code></td>
<td align="center"><code>u128</code></td>
</tr>
<tr>
<td align="center">arch</td>
<td align="center"><code>isize</code></td>
<td align="center"><code>usize</code></td>
</tr>
</tbody></table>
<p>Rust ä¸­çš„æ•´æ•°å­—é¢é‡ï¼š</p>
<table>
<thead>
<tr>
<th align="center">Numberliterals</th>
<th align="center">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Decimal</td>
<td align="center"><code>98_222</code></td>
</tr>
<tr>
<td align="center">Hex</td>
<td align="center"><code>0xff</code></td>
</tr>
<tr>
<td align="center">Octal</td>
<td align="center"><code>0o77</code></td>
</tr>
<tr>
<td align="center">Binary</td>
<td align="center"><code>0b1111_0000</code></td>
</tr>
<tr>
<td align="center">Byte (<code>u8</code> only)</td>
<td align="center"><code>b&#39;A&#39;</code></td>
</tr>
</tbody></table>
<h2 id="1-2-æµ®ç‚¹ç±»å‹"><a href="#1-2-æµ®ç‚¹ç±»å‹" class="headerlink" title="1.2 æµ®ç‚¹ç±»å‹"></a>1.2 æµ®ç‚¹ç±»å‹</h2><ul>
<li>Rust è¿˜å…·æœ‰ä¸¤ç§æµ®ç‚¹æ•°åŸºæœ¬ç±»å‹ï¼Œå³å¸¦æœ‰å°æ•°ç‚¹çš„æ•°å­—ã€‚</li>
<li>Rust çš„æµ®ç‚¹ç±»å‹æ˜¯ f32 å’Œ f64ï¼Œå¤§å°åˆ†åˆ«ä¸º 32 ä½å’Œ 64 ä½ã€‚</li>
<li>é»˜è®¤ç±»å‹ä¸º f64ï¼Œå› ä¸ºåœ¨ç°ä»£ CPU ä¸Šï¼Œå®ƒçš„é€Ÿåº¦ä¸ f32 å¤§è‡´ç›¸åŒï¼Œä½†ç²¾åº¦æ›´é«˜ã€‚</li>
<li>æ‰€æœ‰æµ®ç‚¹ç±»å‹éƒ½æ˜¯æœ‰ç¬¦å·çš„ã€‚</li>
</ul>
<h2 id="1-3-å¸ƒå°”ç±»å‹"><a href="#1-3-å¸ƒå°”ç±»å‹" class="headerlink" title="1.3 å¸ƒå°”ç±»å‹"></a>1.3 å¸ƒå°”ç±»å‹</h2><ul>
<li>Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseã€‚</li>
<li>å¸ƒå°”å€¼çš„å¤§å°ä¸ºä¸€ä¸ªå­—èŠ‚ã€‚</li>
</ul>
<p>Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨ bool æŒ‡å®šã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">bool</span> = <span class="literal">false</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-å­—ç¬¦ç±»å‹"><a href="#1-4-å­—ç¬¦ç±»å‹" class="headerlink" title="1.4 å­—ç¬¦ç±»å‹"></a>1.4 å­—ç¬¦ç±»å‹</h2><p>Rust çš„ char ç±»å‹æ˜¯è¯¥è¯­è¨€æœ€åŸå§‹çš„å­—æ¯ç±»å‹ã€‚ä»¥ä¸‹æ˜¯å£°æ˜ char å€¼çš„ä¸€äº›ç¤ºä¾‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="string">&#x27;z&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span>: <span class="type">char</span> = <span class="string">&#x27;â„¤&#x27;</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">heart_eyed_cat</span> = &#x27;ğŸ˜»&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬<strong>ç”¨å•å¼•å·æŒ‡å®š char æ–‡å­—</strong>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŒå¼•å·çš„å­—ç¬¦ä¸²æ–‡å­—ã€‚Rust çš„ <strong>char ç±»å‹å¤§å°ä¸ºå››ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤º Unicode æ ‡é‡å€¼</strong>ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è¡¨ç¤ºçš„ä¸ä»…ä»…æ˜¯ ASCIIã€‚é‡éŸ³å­—æ¯ï¼›ä¸­æ–‡ã€æ—¥æ–‡å’ŒéŸ©æ–‡å­—ç¬¦ï¼›è¡¨æƒ…ç¬¦å·ï¼›ä»¥åŠé›¶å®½åº¦ç©ºæ ¼éƒ½æ˜¯ Rust ä¸­çš„æœ‰æ•ˆ char å€¼ã€‚</p>
<p>Unicode æ ‡é‡å€¼çš„èŒƒå›´ä» U+0000 åˆ° U+D7FF å’Œ U+E000 åˆ° U+10FFFF ï¼ˆå«ï¼‰ã€‚ä½†æ˜¯ï¼Œâ€œå­—ç¬¦â€åœ¨ Unicode ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ¦‚å¿µï¼Œå› æ­¤ä½ å¯¹â€œå­—ç¬¦â€çš„äººç±»ç›´è§‰å¯èƒ½ä¸ Rust ä¸­çš„ char ä¸åŒ¹é…ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ 8 ç« â€œ<a href="https://doc.rust-lang.org/book/ch08-02-strings.html#storing-utf-8-encoded-text-with-strings">ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ UTF-8 ç¼–ç æ–‡æœ¬</a> â€ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸ªä¸»é¢˜ã€‚</p>
<h1 id="0x02-å¤åˆç±»å‹"><a href="#0x02-å¤åˆç±»å‹" class="headerlink" title="0x02. å¤åˆç±»å‹"></a>0x02. å¤åˆç±»å‹</h1><h2 id="2-2-æ•°ç»„"><a href="#2-2-æ•°ç»„" class="headerlink" title="2.2 æ•°ç»„"></a>2.2 æ•°ç»„</h2><p>å¦ä¸€ç§æ‹¥æœ‰å¤šä¸ªå€¼é›†åˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨æ•°ç»„ã€‚ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½<strong>å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹</strong>ã€‚ä¸å…¶ä»–ä¸€äº›è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒï¼ŒRust ä¸­çš„æ•°ç»„<strong>å…·æœ‰å›ºå®šé•¿åº¦</strong>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·æ¥ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€åˆ†å·ï¼Œç„¶åæ˜¯æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br></pre></td></tr></table></figure>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šåˆå§‹å€¼ï¼Œåè·Ÿåˆ†å·ï¼Œç„¶ååœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œæ¥åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ï¼Œä½¿å…¶æ¯ä¸ªå…ƒç´ åŒ…å«ç›¸åŒçš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br><span class="line"><span class="comment">// è¿™ä¸ let a = [3, 3, 3, 3, 3]; çš„å†™æ³•ç›¸åŒï¼Œä½†æ›´ç®€æ´ã€‚</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„æ˜¯ä¸€å—å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ï¼Œå¯åœ¨å †æ ˆä¸Šåˆ†é…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first</span> = a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = a[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-1-å…ƒç»„"><a href="#2-1-å…ƒç»„" class="headerlink" title="2.1 å…ƒç»„"></a>2.1 å…ƒç»„</h2><p>å…ƒç»„æ˜¯ä¸€ç§å°†å¤šä¸ªå…·æœ‰å„ç§ç±»å‹çš„å€¼ç»„åˆæˆä¸€ç§å¤åˆç±»å‹çš„é€šç”¨æ–¹æ³•ã€‚å…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼šä¸€æ—¦å£°æ˜ï¼Œå®ƒä»¬çš„å¤§å°å°±ä¸èƒ½å¢åŠ æˆ–ç¼©å°ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡åœ¨æ‹¬å·å†…å†™å…¥é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºå…ƒç»„ã€‚å…ƒç»„ä¸­çš„æ¯ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œå¹¶ä¸”å…ƒç»„ä¸­ä¸åŒå€¼çš„ç±»å‹ä¸å¿…ç›¸åŒã€‚æˆ‘ä»¬åœ¨æ­¤ç¤ºä¾‹ä¸­æ·»åŠ äº†å¯é€‰çš„ç±»å‹æ³¨é‡Šï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å˜é‡ tup ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ï¼Œå› ä¸ºå…ƒç»„è¢«è§†ä¸ºå•ä¸ªå¤åˆå…ƒç´ ã€‚è¦ä»å…ƒç»„ä¸­è·å–å•ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„å…ƒç»„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span> = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (x, y, z) = tup;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of y is: &#123;y&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¥ç‚¹ (<code>.</code>) åè·Ÿè¦è®¿é—®çš„å€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å…ƒç»„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five_hundred</span> = x.<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">six_point_four</span> = x.<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">one</span> = x.<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ä»»ä½•å€¼çš„å…ƒç»„æœ‰ä¸€ä¸ªç‰¹æ®Šåç§°ï¼Œå³ <code>unit</code>ã€‚æ­¤å€¼åŠå…¶å¯¹åº”çš„ç±»å‹éƒ½å†™ä¸º <code>()</code>ï¼Œè¡¨ç¤ºç©ºå€¼æˆ–ç©ºè¿”å›ç±»å‹ã€‚å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œåˆ™éšå¼è¿”å› unit å€¼ã€‚</p>
<h2 id="2-3-ç»“æ„ä½“"><a href="#2-3-ç»“æ„ä½“" class="headerlink" title="2.3 ç»“æ„ä½“"></a>2.3 ç»“æ„ä½“</h2><p>ç»“æ„ä½“ç±»ä¼¼äºâ€œå…ƒç»„ç±»å‹â€éƒ¨åˆ†ä¸­è®¨è®ºçš„å…ƒç»„ï¼Œå› ä¸ºä¸¤è€…éƒ½åŒ…å«å¤šä¸ªç›¸å…³å€¼ã€‚ä¸å…ƒç»„ä¸€æ ·ï¼Œç»“æ„ä½“çš„å„ä¸ªéƒ¨åˆ†å¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹ã€‚ä¸å…ƒç»„ä¸åŒï¼Œåœ¨ç»“æ„ä½“ä¸­ï¼Œæ‚¨å°†å‘½åæ¯ä¸ªæ•°æ®éƒ¨åˆ†ï¼Œä»¥ä¾¿æ¸…æ¥šåœ°äº†è§£å€¼çš„å«ä¹‰ã€‚æ·»åŠ è¿™äº›åç§°æ„å‘³ç€ç»“æ„ä½“æ¯”å…ƒç»„æ›´çµæ´»ï¼šæ‚¨ä¸å¿…ä¾èµ–æ•°æ®çš„é¡ºåºæ¥æŒ‡å®šæˆ–è®¿é—®å®ä¾‹çš„å€¼ã€‚</p>
<p>è¦å®šä¹‰ç»“æ„ä½“ï¼Œæˆ‘ä»¬è¾“å…¥å…³é”®å­— struct å¹¶å‘½åæ•´ä¸ªç»“æ„ä½“ã€‚ç»“æ„ä½“çš„åç§°åº”è¯¥æè¿°å°†æ•°æ®ç»„åˆåœ¨ä¸€èµ·çš„æ„ä¹‰ã€‚ç„¶åï¼Œåœ¨èŠ±æ‹¬å·å†…ï¼Œæˆ‘ä»¬å®šä¹‰æ•°æ®çš„åç§°å’Œç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå­—æ®µã€‚ä¾‹å¦‚ï¼Œæ¸…å• 5-1 æ˜¾ç¤ºäº†ä¸€ä¸ªå­˜å‚¨æœ‰å…³ç”¨æˆ·å¸æˆ·ä¿¡æ¯çš„ç»“æ„ä½“ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦åœ¨å®šä¹‰ç»“æ„ä½“åä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šå…·ä½“å€¼æ¥åˆ›å»ºè¯¥ç»“æ„çš„å®ä¾‹ã€‚æˆ‘ä»¬é€šè¿‡å£°æ˜ç»“æ„ä½“çš„åç§°æ¥åˆ›å»ºå®ä¾‹ï¼Œç„¶åæ·»åŠ åŒ…å«é”®ï¼šå€¼å¯¹çš„å¤§æ‹¬å·ï¼Œå…¶ä¸­é”®æ˜¯å­—æ®µçš„åç§°ï¼Œå€¼æ˜¯æˆ‘ä»¬æƒ³è¦å­˜å‚¨åœ¨è¿™äº›å­—æ®µä¸­çš„æ•°æ®ã€‚æˆ‘ä»¬ä¸å¿…æŒ‰ç…§åœ¨ç»“æ„ä½“ä¸­å£°æ˜å­—æ®µçš„é¡ºåºæŒ‡å®šå­—æ®µã€‚æ¢å¥è¯è¯´ï¼Œç»“æ„ä½“å®šä¹‰å°±åƒç±»å‹çš„é€šç”¨æ¨¡æ¿ï¼Œå®ä¾‹ç”¨ç‰¹å®šæ•°æ®å¡«å……è¯¥æ¨¡æ¿ä»¥åˆ›å»ºç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ï¼Œå¦‚ç¤ºä¾‹ 5-2 æ‰€ç¤ºã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ä»ç»“æ„ä½“ä¸­è·å–ç‰¹å®šå€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ç‚¹ç¬¦å·ã€‚ä¾‹å¦‚ï¼Œè¦è®¿é—®æ­¤ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œæˆ‘ä»¬ä½¿ç”¨ user1.emailã€‚å¦‚æœå®ä¾‹æ˜¯å¯å˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‚¹ç¬¦å·å¹¶èµ‹å€¼åˆ°ç‰¹å®šå­—æ®µæ¥æ›´æ”¹å€¼ã€‚æ¸…å• 5-3 æ˜¾ç¤ºäº†å¦‚ä½•æ›´æ”¹å¯å˜ User å®ä¾‹çš„ email å­—æ®µä¸­çš„å€¼ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">user1</span> = User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    user1.email = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;anotheremail@example.com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¸…å• 5-4 æ˜¾ç¤ºäº† build_user å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›å…·æœ‰ç»™å®šç”µå­é‚®ä»¶å’Œç”¨æˆ·åçš„ User å®ä¾‹ã€‚active å­—æ®µçš„å€¼ä¸º trueï¼Œsign_in_count çš„å€¼ä¸º 1ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_user</span>(email: <span class="type">String</span>, username: <span class="type">String</span>) <span class="punctuation">-&gt;</span> User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: username,</span><br><span class="line">        email: email,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†å‡½æ•°å‚æ•°å‘½åä¸ºä¸ç»“æ„å­—æ®µç›¸åŒçš„åç§°æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å¿…é¡»é‡å¤ç”µå­é‚®ä»¶å’Œç”¨æˆ·åå­—æ®µåç§°å’Œå˜é‡æœ‰ç‚¹ä¹å‘³ã€‚å¦‚æœç»“æ„æœ‰æ›´å¤šå­—æ®µï¼Œé‡å¤æ¯ä¸ªåç§°ä¼šå˜å¾—æ›´åŠ çƒ¦äººã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ç®€å†™ï¼</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_user</span>(email: <span class="type">String</span>, username: <span class="type">String</span>) <span class="punctuation">-&gt;</span> User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username,</span><br><span class="line">        email,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº† User ç»“æ„ä½“çš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œè¯¥ç»“æ„ä½“æœ‰ä¸€ä¸ªåä¸º email çš„å­—æ®µã€‚æˆ‘ä»¬æƒ³å°† email å­—æ®µçš„å€¼è®¾ç½®ä¸º build_user å‡½æ•°çš„ email å‚æ•°ä¸­çš„å€¼ã€‚ç”±äº email å­—æ®µå’Œ email å‚æ•°åŒåï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å†™ email è€Œä¸æ˜¯ email: emailã€‚</p>
<h3 id="2-3-1-ç»“æ„ä½“æ›´æ–°è¯­æ³•"><a href="#2-3-1-ç»“æ„ä½“æ›´æ–°è¯­æ³•" class="headerlink" title="2.3.1 ç»“æ„ä½“æ›´æ–°è¯­æ³•"></a>2.3.1 ç»“æ„ä½“æ›´æ–°è¯­æ³•</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">        active: user1.active,</span><br><span class="line">        username: user1.username,</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: user1.sign_in_count,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">        ..user1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¸…å• 5-7 ä¸­çš„ä»£ç è¿˜åœ¨ user2 ä¸­åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥å®ä¾‹çš„ email å€¼ä¸ user1 ä¸åŒï¼Œä½† usernameã€active å’Œ sign_in_count å­—æ®µçš„å€¼ä¸ user1 ç›¸åŒã€‚..user1 å¿…é¡»æ”¾åœ¨æœ€åï¼Œä»¥æŒ‡å®šä»»ä½•å‰©ä½™å­—æ®µåº”ä» user1 ä¸­çš„ç›¸åº”å­—æ®µä¸­è·å–å…¶å€¼ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»¥ä»»æ„é¡ºåºä¸ºä»»æ„æ•°é‡çš„å­—æ®µæŒ‡å®šå€¼ï¼Œè€Œä¸ç®¡ç»“æ„å®šä¹‰ä¸­å­—æ®µçš„é¡ºåºå¦‚ä½•ã€‚</p>
<h3 id="2-3-2-å…ƒç»„ç»“æ„ä½“"><a href="#2-3-2-å…ƒç»„ç»“æ„ä½“" class="headerlink" title="2.3.2  å…ƒç»„ç»“æ„ä½“"></a>2.3.2  å…ƒç»„ç»“æ„ä½“</h3><p>Rust è¿˜æ”¯æŒç±»ä¼¼äºå…ƒç»„çš„ç»“æ„ï¼Œç§°ä¸ºå…ƒç»„ç»“æ„ã€‚å…ƒç»„ç»“æ„å…·æœ‰ç»“æ„åç§°æä¾›çš„é™„åŠ å«ä¹‰ï¼Œä½†æ²¡æœ‰ä¸å…¶å­—æ®µå…³è”çš„åç§°ï¼›ç›¸åï¼Œå®ƒä»¬åªæœ‰å­—æ®µçš„ç±»å‹ã€‚å½“ä½ æƒ³ç»™æ•´ä¸ªå…ƒç»„å‘½åå¹¶ä½¿å…ƒç»„ä¸å…¶ä»–å…ƒç»„çš„ç±»å‹ä¸åŒï¼Œå¹¶ä¸”åƒåœ¨å¸¸è§„ç»“æ„ä¸­ä¸€æ ·å‘½åæ¯ä¸ªå­—æ®µä¼šå¾ˆå†—é•¿æˆ–å†—ä½™æ—¶ï¼Œå…ƒç»„ç»“æ„å¾ˆæœ‰ç”¨ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">black</span> = <span class="title function_ invoke__">Color</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">origin</span> = <span class="title function_ invoke__">Point</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-å•å…ƒç»“æ„ä½“"><a href="#2-3-3-å•å…ƒç»“æ„ä½“" class="headerlink" title="2.3.3 å•å…ƒç»“æ„ä½“"></a>2.3.3 å•å…ƒç»“æ„ä½“</h3><p>æ‚¨è¿˜å¯ä»¥å®šä¹‰æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼è¿™äº›è¢«ç§°ä¸ºç±»å•å…ƒç»“æ„ï¼Œå› ä¸ºå®ƒä»¬çš„è¡Œä¸ºç±»ä¼¼äº <code>()</code>ï¼Œåè€…æ˜¯æˆ‘ä»¬åœ¨â€œå…ƒç»„ç±»å‹â€éƒ¨åˆ†ä¸­æåˆ°çš„å•å…ƒç±»å‹ã€‚å½“æ‚¨éœ€è¦åœ¨æŸç§ç±»å‹ä¸Šå®ç°ç‰¹å¾ä½†æ²¡æœ‰ä»»ä½•è¦å­˜å‚¨åœ¨ç±»å‹æœ¬èº«ä¸­çš„æ•°æ®æ—¶ï¼Œç±»å•å…ƒç»“æ„ä¼šå¾ˆæœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯å£°æ˜å’Œå®ä¾‹åŒ–åä¸º <code>AlwaysEqual</code> çš„å•å…ƒç»“æ„ä½“çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">subject</span> = AlwaysEqual;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="2-4-æšä¸¾"><a href="#2-4-æšä¸¾" class="headerlink" title="2.4 æšä¸¾"></a>2.4 æšä¸¾</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ IpAddrKind æšä¸¾å¹¶åˆ—å‡º IP åœ°å€å¯èƒ½çš„ç±»å‹ V4 å’Œ V6ï¼Œåœ¨ä»£ç ä¸­è¡¨è¾¾è¿™ä¸€æ¦‚å¿µã€‚è¿™äº›æ˜¯æšä¸¾çš„å˜ä½“ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddrKind</span> &#123;</span><br><span class="line">    V4,</span><br><span class="line">    V6,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åˆ›å»º IpAddrKind çš„ä¸¤ä¸ªå˜ä½“çš„å®ä¾‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">four</span> = IpAddrKind::V4;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">six</span> = IpAddrKind::V6;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œæšä¸¾çš„å˜ä½“åœ¨å…¶æ ‡è¯†ç¬¦ä¸‹å‘½åï¼Œæˆ‘ä»¬ä½¿ç”¨åŒå†’å·å°†ä¸¤è€…åˆ†å¼€ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºç°åœ¨ IpAddrKind::V4 å’Œ IpAddrKind::V6 è¿™ä¸¤ä¸ªå€¼éƒ½å±äºåŒä¸€ç±»å‹ï¼šIpAddrKindã€‚ç„¶åï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å—ä»»ä½• IpAddrKind çš„å‡½æ•°ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">route</span>(ip_kind: IpAddrKind) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹å¼è°ƒç”¨è¯¥å‡½æ•°ï¼š</span></span><br><span class="line"><span class="title function_ invoke__">route</span>(IpAddrKind::V4);</span><br><span class="line"><span class="title function_ invoke__">route</span>(IpAddrKind::V6);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æšä¸¾è€Œä¸æ˜¯ç»“æ„è¿˜æœ‰å¦ä¸€ä¸ªä¼˜åŠ¿ï¼šæ¯ä¸ªå˜ä½“å¯ä»¥å…·æœ‰ä¸åŒç±»å‹å’Œæ•°é‡çš„å…³è”æ•°æ®ã€‚ç‰ˆæœ¬ 4 IP åœ°å€å°†å§‹ç»ˆå…·æœ‰å››ä¸ªæ•°å­—ç»„ä»¶ï¼Œå…¶å€¼ä»‹äº 0 åˆ° 255 ä¹‹é—´ã€‚å¦‚æœæˆ‘ä»¬æƒ³å°† V4 åœ°å€å­˜å‚¨ä¸ºå››ä¸ª u8 å€¼ï¼Œä½†ä»å°† V6 åœ°å€è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç»“æ„ã€‚æšä¸¾å¯ä»¥è½»æ¾å¤„ç†è¿™ç§æƒ…å†µï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">V4</span>(<span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">V6</span>(<span class="type">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">home</span> = IpAddr::<span class="title function_ invoke__">V4</span>(<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">loopback</span> = IpAddr::<span class="title function_ invoke__">V6</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;::1&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ 6-2 ä¸­çš„å¦ä¸€ä¸ªæšä¸¾ç¤ºä¾‹ï¼šè¿™ä¸ªç¤ºä¾‹çš„å˜ä½“ä¸­åµŒå…¥äº†å¤šç§ç±»å‹ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æšä¸¾æœ‰å››ç§ä¸åŒç±»å‹çš„å˜ä½“ï¼š</p>
<ul>
<li>Quit æ ¹æœ¬æ²¡æœ‰ä¸ä¹‹å…³è”çš„æ•°æ®ã€‚</li>
<li>Move æœ‰å‘½åå­—æ®µï¼Œå°±åƒç»“æ„ä¸€æ ·ã€‚</li>
<li>Write åŒ…å«å•ä¸ªå­—ç¬¦ä¸²ã€‚</li>
<li>ChangeColor åŒ…å«ä¸‰ä¸ª i32 å€¼ã€‚</li>
</ul>
<h3 id="2-4-1-Option-æšä¸¾"><a href="#2-4-1-Option-æšä¸¾" class="headerlink" title="2.4.1 Option æšä¸¾"></a>2.4.1 Option æšä¸¾</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-Result-æšä¸¾"><a href="#2-4-2-Result-æšä¸¾" class="headerlink" title="2.4.2 Result æšä¸¾"></a>2.4.2 Result æšä¸¾</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="0x03-é›†åˆç±»å‹"><a href="#0x03-é›†åˆç±»å‹" class="headerlink" title="0x03. é›†åˆç±»å‹"></a>0x03. é›†åˆç±»å‹</h1><h2 id="3-1-å‘é‡-Vec"><a href="#3-1-å‘é‡-Vec" class="headerlink" title="3.1 å‘é‡ Vec&lt;T&gt;"></a>3.1 å‘é‡ <code>Vec&lt;T&gt;</code></h2><p>æˆ‘ä»¬å°†è¦ä»‹ç»çš„ç¬¬ä¸€ä¸ªé›†åˆç±»å‹æ˜¯ <code>Vec&lt;T&gt;</code>ï¼Œä¹Ÿç§°ä¸ºå‘é‡ã€‚å‘é‡å…è®¸æ‚¨åœ¨å•ä¸ªæ•°æ®ç»“æ„ä¸­å­˜å‚¨å¤šä¸ªå€¼ï¼Œè¯¥æ•°æ®ç»“æ„å°†æ‰€æœ‰å€¼å¹¶æ’æ”¾ç½®åœ¨å†…å­˜ä¸­ã€‚å‘é‡<strong>åªèƒ½å­˜å‚¨ç›¸åŒç±»å‹</strong>çš„å€¼ã€‚å½“æ‚¨æœ‰é¡¹ç›®åˆ—è¡¨æ—¶ï¼Œå®ƒä»¬å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸­çš„æ–‡æœ¬è¡Œæˆ–è´­ç‰©è½¦ä¸­é¡¹ç›®çš„ä»·æ ¼ã€‚</p>
<h3 id="3-1-1-åˆ›å»ºæ–°å‘é‡"><a href="#3-1-1-åˆ›å»ºæ–°å‘é‡" class="headerlink" title="3.1.1 åˆ›å»ºæ–°å‘é‡"></a>3.1.1 åˆ›å»ºæ–°å‘é‡</h3><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå‘é‡ï¼Œæˆ‘ä»¬è°ƒç”¨ Vec::new å‡½æ•°ï¼Œå¦‚ç¤ºä¾‹ 8-1 æ‰€ç¤ºã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br></pre></td></tr></table></figure>
<p>æ›´å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰åˆå§‹å€¼çš„ Vec<T>ï¼ŒRust ä¼šæ¨æ–­å‡ºä½ æƒ³è¦å­˜å‚¨çš„å€¼çš„ç±»å‹ï¼Œæ‰€ä»¥ä½ å¾ˆå°‘éœ€è¦åšè¿™ç§ç±»å‹æ³¨é‡Šã€‚Rust æ–¹ä¾¿åœ°æä¾›äº† vec! å®ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„å‘é‡æ¥ä¿å­˜ä½ ç»™å®ƒçš„å€¼ã€‚ç¤ºä¾‹ 8-2 åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Vec<i32>ï¼Œå®ƒä¿å­˜äº†å€¼ 1ã€2 å’Œ 3ã€‚æ•´æ•°ç±»å‹æ˜¯ i32ï¼Œå› ä¸ºè¿™æ˜¯é»˜è®¤çš„æ•´æ•°ç±»å‹ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ 3 ç« çš„â€œæ•°æ®ç±»å‹â€éƒ¨åˆ†è®¨è®ºçš„é‚£æ ·ã€‚</i32></T></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-æ›´æ–°å‘é‡"><a href="#3-1-2-æ›´æ–°å‘é‡" class="headerlink" title="3.1.2 æ›´æ–°å‘é‡"></a>3.1.2 æ›´æ–°å‘é‡</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">5</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">6</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">7</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">8</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-è¯»å–å‘é‡å…ƒç´ "><a href="#3-1-3-è¯»å–å‘é‡å…ƒç´ " class="headerlink" title="3.1.3 è¯»å–å‘é‡å…ƒç´ "></a>3.1.3 è¯»å–å‘é‡å…ƒç´ </h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third</span>: &amp;<span class="type">i32</span> = &amp;v[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;The third element is &#123;third&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third</span>: <span class="type">Option</span>&lt;&amp;<span class="type">i32</span>&gt; = v.<span class="title function_ invoke__">get</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">match</span> third &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(third) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The third element is &#123;third&#125;&quot;</span>),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;There is no third element.&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-1-4-è¿­ä»£å‘é‡ä¸­çš„å€¼"><a href="#3-1-4-è¿­ä»£å‘é‡ä¸­çš„å€¼" class="headerlink" title="3.1.4 è¿­ä»£å‘é‡ä¸­çš„å€¼"></a>3.1.4 è¿­ä»£å‘é‡ä¸­çš„å€¼</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;i&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è¿­ä»£å¯å˜å‘é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å¯å˜å¼•ç”¨ï¼Œä»¥ä¾¿æ›´æ”¹æ‰€æœ‰å…ƒç´ ã€‚ç¤ºä¾‹ 8-8 ä¸­çš„ for å¾ªç¯å°†ä¸ºæ¯ä¸ªå…ƒç´ æ·»åŠ  50ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;<span class="keyword">mut</span> v &#123;</span><br><span class="line">    *i += <span class="number">50</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦æ›´æ”¹å¯å˜å¼•ç”¨æ‰€æŒ‡çš„å€¼ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆä½¿ç”¨ <code>*</code> è§£å¼•ç”¨è¿ç®—ç¬¦æ¥è·å– i ä¸­çš„å€¼ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ +&#x3D; è¿ç®—ç¬¦ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ 15 ç« çš„â€œä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦è·Ÿè¸ªæŒ‡é’ˆæŒ‡å‘å€¼â€éƒ¨åˆ†ä¸­è¿›ä¸€æ­¥è®¨è®ºè§£å¼•ç”¨è¿ç®—ç¬¦ã€‚</p>
<h3 id="3-1-5-ä½¿ç”¨æšä¸¾å­˜å‚¨å¤šç§ç±»å‹"><a href="#3-1-5-ä½¿ç”¨æšä¸¾å­˜å‚¨å¤šç§ç±»å‹" class="headerlink" title="3.1.5 ä½¿ç”¨æšä¸¾å­˜å‚¨å¤šç§ç±»å‹"></a>3.1.5 ä½¿ç”¨æšä¸¾å­˜å‚¨å¤šç§ç±»å‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">SpreadsheetCell</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Int</span>(<span class="type">i32</span>),</span><br><span class="line">    <span class="title function_ invoke__">Float</span>(<span class="type">f64</span>),</span><br><span class="line">    <span class="title function_ invoke__">Text</span>(<span class="type">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">row</span> = <span class="built_in">vec!</span>[</span><br><span class="line">    SpreadsheetCell::<span class="title function_ invoke__">Int</span>(<span class="number">3</span>),</span><br><span class="line">    SpreadsheetCell::<span class="title function_ invoke__">Text</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;blue&quot;</span>)),</span><br><span class="line">    SpreadsheetCell::<span class="title function_ invoke__">Float</span>(<span class="number">10.12</span>),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="3-2-å“ˆå¸Œæ˜ å°„-HashMap"><a href="#3-2-å“ˆå¸Œæ˜ å°„-HashMap" class="headerlink" title="3.2 å“ˆå¸Œæ˜ å°„ HashMap&lt;K, V&gt;"></a>3.2 å“ˆå¸Œæ˜ å°„ <code>HashMap&lt;K, V&gt;</code></h2><h3 id="3-2-1-åˆ›å»ºæ–°çš„-HashMap"><a href="#3-2-1-åˆ›å»ºæ–°çš„-HashMap" class="headerlink" title="3.2.1 åˆ›å»ºæ–°çš„ HashMap&lt;K, V&gt;"></a>3.2.1 åˆ›å»ºæ–°çš„ <code>HashMap&lt;K, V&gt;</code></h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-è®¿é—®å“ˆå¸Œæ˜ å°„ä¸­çš„å€¼"><a href="#3-2-2-è®¿é—®å“ˆå¸Œæ˜ å°„ä¸­çš„å€¼" class="headerlink" title="3.2.2 è®¿é—®å“ˆå¸Œæ˜ å°„ä¸­çš„å€¼"></a>3.2.2 è®¿é—®å“ˆå¸Œæ˜ å°„ä¸­çš„å€¼</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name).<span class="title function_ invoke__">copied</span>().<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸å‘é‡ç±»ä¼¼çš„æ–¹å¼ï¼Œä½¿ç”¨ for å¾ªç¯éå†å“ˆå¸Œå›¾ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (key, value) <span class="keyword">in</span> &amp;scores &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;key&#125;: &#123;value&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºçº¿æ ¸æŸ¥ä¸åŠ å›º - MySQL</title>
    <url>/2023/10/29/harden-mysql/</url>
    <content><![CDATA[<blockquote>
<p>åŸºäº <code>MySQL8.0.12</code> è¿›è¡Œæ“ä½œï¼Œç¯å¢ƒï¼š<code>phpstudy_pro</code> &amp; <code>Windows11</code></p>
<ol>
<li>ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤åŸºæœ¬è¦æ±‚ - <code>ç¬¬ä¸‰çº§å®‰å…¨è¦æ±‚</code> - <code>å®‰å…¨è®¡ç®—ç¯å¢ƒ</code></li>
<li>æ ¸æŸ¥</li>
<li>åŠ å›º</li>
</ol>
</blockquote>
<span id="more"></span>

<h2 id="8-1-4-å®‰å…¨è®¡ç®—ç¯å¢ƒ"><a href="#8-1-4-å®‰å…¨è®¡ç®—ç¯å¢ƒ" class="headerlink" title="8.1.4 å®‰å…¨è®¡ç®—ç¯å¢ƒ"></a>8.1.4 å®‰å…¨è®¡ç®—ç¯å¢ƒ</h2><h3 id="8-1-4-1-èº«ä»½é‰´åˆ«"><a href="#8-1-4-1-èº«ä»½é‰´åˆ«" class="headerlink" title="8.1.4.1 èº«ä»½é‰´åˆ«"></a>8.1.4.1 èº«ä»½é‰´åˆ«</h3><p>æœ¬é¡¹è¦æ±‚åŒ…æ‹¬ï¼š</p>
<p>a) åº”å¯¹ç™»å½•çš„ç”¨æˆ·è¿›è¡Œèº«ä»½æ ‡è¯†å’Œé‰´åˆ«ï¼Œèº«ä»½æ ‡è¯†å…·æœ‰å”¯ä¸€æ€§ï¼Œèº«ä»½é‰´åˆ«ä¿¡æ¯å…·æœ‰å¤æ‚åº¦è¦æ±‚å¹¶å®šæœŸæ›´æ¢ï¼›</p>
<ul>
<li>æ ¸æŸ¥å¯†ç å¤æ‚åº¦</li>
<li>æ ¸æŸ¥å¯†ç ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<p>b) åº”å…·æœ‰ç™»å½•å¤±è´¥å¤„ç†åŠŸèƒ½ï¼Œåº”é…ç½®å¹¶å¯ç”¨ç»“æŸä¼šè¯ã€é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°å’Œå½“ç™»å½•è¿æ¥è¶…æ—¶è‡ªåŠ¨é€€å‡ºç­‰ç›¸å…³æªæ–½ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°</li>
<li>æ ¸æŸ¥ç™»å½•è¿æ¥è¶…æ—¶é…ç½®</li>
</ul>
<p>c) å½“è¿›è¡Œè¿œç¨‹ç®¡ç†æ—¶ï¼Œåº”é‡‡å–å¿…è¦æªæ–½é˜²æ­¢é‰´åˆ«ä¿¡æ¯åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå¬ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦å¼€å¯è¿œç¨‹åŠ å¯†é€šä¿¡</li>
</ul>
<p>d) åº”é‡‡ç”¨å£ä»¤ã€å¯†ç æŠ€æœ¯ã€ç”Ÿç‰©æŠ€æœ¯ç­‰ä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šç»„åˆçš„é‰´åˆ«æŠ€æœ¯å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½é‰´åˆ«ï¼Œä¸”å…¶ä¸­ä¸€ç§é‰´åˆ«æŠ€æœ¯è‡³å°‘åº”ä½¿ç”¨å¯†ç æŠ€æœ¯æ¥å®ç°ã€‚</p>
<ul>
<li>ä¸é€‚ç”¨</li>
</ul>
<h4 id="æ ¸æŸ¥å¯†ç å¤æ‚åº¦"><a href="#æ ¸æŸ¥å¯†ç å¤æ‚åº¦" class="headerlink" title="æ ¸æŸ¥å¯†ç å¤æ‚åº¦"></a>æ ¸æŸ¥å¯†ç å¤æ‚åº¦</h4><p>MySQL ç³»ç»Ÿè‡ªå¸¦æœ‰ validate_password æ’ä»¶ï¼Œæ­¤æ’ä»¶å¯ä»¥éªŒè¯å¯†ç å¼ºåº¦ï¼Œæœªè¾¾åˆ°è§„å®šå¼ºåº¦çš„å¯†ç åˆ™ä¸å…è®¸è¢«è®¾ç½®ã€‚MySQL 5.7 åŠ 8.0 ç‰ˆæœ¬é»˜è®¤æƒ…å†µä¸‹è²Œä¼¼éƒ½ä¸å¯ç”¨è¯¥æ’ä»¶ï¼Œè¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥éšæ„è®¾ç½®å¯†ç ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 123ã€123456ç­‰ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä»æ ¹æºä¸Šè§„èŒƒå¯†ç å¼ºåº¦ï¼Œå¯ä»¥å¯ç”¨è¯¥æ’ä»¶ï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸‹å¦‚ä½•é€šè¿‡æ­¤æ’ä»¶æ¥è®¾ç½®å¯†ç å¤æ‚åº¦ç­–ç•¥ã€‚</p>
<h5 id="æ ¸æŸ¥æ–¹å¼"><a href="#æ ¸æŸ¥æ–¹å¼" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><p>å®‰è£…å‰æ£€æŸ¥ ä¸ºç©ºåˆ™è¯´æ˜æœªå®‰è£…æ­¤æ’ä»¶ï¼š<code>show variables like &#39;validate%&#39;; </code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;; </span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212213316407.png" alt="image-20221212213316407"></p>
<h5 id="åŠ å›ºæ–¹å¼"><a href="#åŠ å›ºæ–¹å¼" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><h6 id="1ï¼‰å®‰è£…-validate-password-æ’ä»¶"><a href="#1ï¼‰å®‰è£…-validate-password-æ’ä»¶" class="headerlink" title="1ï¼‰å®‰è£… validate_password æ’ä»¶"></a>1ï¼‰å®‰è£… validate_password æ’ä»¶</h6><p><code>INSTALL PLUGIN validate_password SONAME &#39;validate_password.so&#39;;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># é€šè¿‡ INSTALL PLUGIN å‘½ä»¤å¯å®‰è£…æ­¤æ’ä»¶</span><br><span class="line"># æ¯ä¸ªå¹³å°çš„æ–‡ä»¶ååç¼€éƒ½ä¸åŒ å¯¹äº Unix å’Œç±» Unix ç³»ç»Ÿï¼Œä¸º.soï¼Œå¯¹äº Windows ä¸º.dll</span><br><span class="line">mysql&gt; INSTALL PLUGIN validate_password SONAME &#x27;validate_password.so&#x27;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.28 sec)</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ validate_password ç›¸å…³å‚æ•°</span><br><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;;</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password_check_user_name    | ON     |</span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 8      |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212213649720.png" alt="image-20221212213649720"></p>
<h6 id="2ï¼‰å¯†ç å¼ºåº¦ç›¸å…³å‚æ•°è§£é‡Š"><a href="#2ï¼‰å¯†ç å¼ºåº¦ç›¸å…³å‚æ•°è§£é‡Š" class="headerlink" title="2ï¼‰å¯†ç å¼ºåº¦ç›¸å…³å‚æ•°è§£é‡Š"></a>2ï¼‰å¯†ç å¼ºåº¦ç›¸å…³å‚æ•°è§£é‡Š</h6><p>å®‰è£… validate_password æ’ä»¶åï¼Œå¤šäº†ä¸€äº›å¯†ç å¼ºåº¦ç›¸å…³å‚æ•°ï¼Œè¿™äº›å‚æ•°ä»å­—é¢æ„æ€ä¸Šä¹Ÿå¾ˆå®¹æ˜“çœ‹æ‡‚ï¼Œä¸‹é¢ç®€å•è§£é‡Šä¸‹å‡ ä¸ªé‡ç‚¹å‚æ•°ã€‚</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> validate<span class="emphasis">_password_</span>policy</span><br><span class="line"><span class="bullet">	-</span> ä»£è¡¨çš„å¯†ç ç­–ç•¥ï¼Œé»˜è®¤æ˜¯MEDIUM å¯é…ç½®çš„å€¼æœ‰ä»¥ä¸‹ï¼š</span><br><span class="line"><span class="code">        0 or LOW ä»…éœ€éœ€ç¬¦åˆå¯†ç é•¿åº¦ï¼ˆç”±å‚æ•°validate_password_lengthæŒ‡å®šï¼‰</span></span><br><span class="line"><span class="code">        1 or MEDIUM æ»¡è¶³LOWç­–ç•¥ï¼ŒåŒæ—¶è¿˜éœ€æ»¡è¶³è‡³å°‘æœ‰1ä¸ªæ•°å­—ï¼Œå°å†™å­—æ¯ï¼Œå¤§å†™å­—æ¯å’Œç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line"><span class="code">        2 or STRONG æ»¡è¶³MEDIUMç­–ç•¥ï¼ŒåŒæ—¶å¯†ç ä¸èƒ½å­˜åœ¨å­—å…¸æ–‡ä»¶ï¼ˆdictionary fileï¼‰ä¸­</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">2.</span> validate<span class="emphasis">_password_</span>dictionary<span class="emphasis">_file</span></span><br><span class="line"><span class="emphasis">	- ç”¨äºé…ç½®å¯†ç çš„å­—å…¸æ–‡ä»¶ï¼Œå½“validate_</span>password<span class="emphasis">_policyè®¾ç½®ä¸ºSTRONGæ—¶å¯ä»¥é…ç½®å¯†ç å­—å…¸æ–‡ä»¶ï¼Œå­—å…¸æ–‡ä»¶ä¸­å­˜åœ¨çš„å¯†ç ä¸å¾—ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">3. validate_</span>password<span class="emphasis">_length</span></span><br><span class="line"><span class="emphasis">	- ç”¨æ¥è®¾ç½®å¯†ç çš„æœ€å°é•¿åº¦ï¼Œé»˜è®¤å€¼æ˜¯8</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">4. validate_</span>password<span class="emphasis">_mixed_</span>case<span class="emphasis">_count</span></span><br><span class="line"><span class="emphasis">	- å½“validate_</span>password<span class="emphasis">_policyè®¾ç½®ä¸ºMEDIUMæˆ–è€…STRONGæ—¶ï¼Œå¯†ç ä¸­è‡³å°‘åŒæ—¶æ‹¥æœ‰çš„å°å†™å’Œå¤§å†™å­—æ¯çš„æ•°é‡</span></span><br><span class="line"><span class="emphasis">	- é»˜è®¤æ˜¯1æœ€å°æ˜¯0ï¼›é»˜è®¤æ˜¯è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªå°å†™å’Œä¸€ä¸ªå¤§å†™å­—æ¯ã€‚</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">5. validate_</span>password<span class="emphasis">_number_</span>count</span><br><span class="line"><span class="bullet">	-</span> å½“validate<span class="emphasis">_password_</span>policyè®¾ç½®ä¸ºMEDIUMæˆ–è€…STRONGæ—¶ï¼Œå¯†ç ä¸­è‡³å°‘æ‹¥æœ‰çš„æ•°å­—çš„ä¸ªæ•°ï¼Œé»˜è®¤1æœ€å°æ˜¯0</span><br><span class="line"></span><br><span class="line"><span class="bullet">6.</span> validate<span class="emphasis">_password_</span>special<span class="emphasis">_char_</span>count</span><br><span class="line"><span class="bullet">	-</span> å½“validate<span class="emphasis">_password_</span>policyè®¾ç½®ä¸ºMEDIUMæˆ–è€…STRONGæ—¶ï¼Œå¯†ç ä¸­è‡³å°‘æ‹¥æœ‰çš„ç‰¹æ®Šå­—ç¬¦çš„ä¸ªæ•°ï¼Œé»˜è®¤1æœ€å°æ˜¯0</span><br></pre></td></tr></table></figure>

<h6 id="3ï¼‰å¯†ç å¤æ‚åº¦ç­–ç•¥å…·ä½“è®¾ç½®"><a href="#3ï¼‰å¯†ç å¤æ‚åº¦ç­–ç•¥å…·ä½“è®¾ç½®" class="headerlink" title="3ï¼‰å¯†ç å¤æ‚åº¦ç­–ç•¥å…·ä½“è®¾ç½®"></a>3ï¼‰å¯†ç å¤æ‚åº¦ç­–ç•¥å…·ä½“è®¾ç½®</h6><p><code>set global validate_password_length = 16;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å¯†ç é•¿åº¦è‡³å°‘10ä½</span><br><span class="line">mysql&gt; set global validate_password_length = 16;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#x27;validate%&#x27;;                                                                                   </span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password_check_user_name    | ON     |</span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 16     |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>!!! note â€œè‹¥æƒ³æ°¸ä¹…ç”Ÿæ•ˆï¼Œå»ºè®®å°†ä»¥ä¸‹å‚æ•°å†™å…¥é…ç½®æ–‡ä»¶â€</p>
<pre><code><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">plugin-load = validate_password.dll</span><br><span class="line">validate_password_length = 16</span><br><span class="line">validate_password_policy = 1</span><br><span class="line">validate-password = FORCE_PLUS_PERMANENT</span><br></pre></td></tr></table></figure>
</code></pre>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212220000175.png" alt="image-20221212220000175"></p>
<h4 id="æ ¸æŸ¥å¯†ç ç”Ÿå‘½å‘¨æœŸ"><a href="#æ ¸æŸ¥å¯†ç ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ ¸æŸ¥å¯†ç ç”Ÿå‘½å‘¨æœŸ"></a>æ ¸æŸ¥å¯†ç ç”Ÿå‘½å‘¨æœŸ</h4><h5 id="æ ¸æŸ¥æ–¹å¼-1"><a href="#æ ¸æŸ¥æ–¹å¼-1" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><p>æŸ¥çœ‹å¯†ç æœ‰æ•ˆæœŸï¼š<code>SHOW VARIABLES LIKE &#39;default_password_lifetime&#39;; </code></p>
<blockquote>
<p><code>default_password_lifetime</code> è®¾ç½®ä¸º <code>0</code> ï¼Œå³è¡¨ç¤ºå¯†ç æ°¸ä¸è¿‡æœŸã€‚</p>
</blockquote>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212211606097.png" alt="image-20221212211606097"></p>
<h5 id="åŠ å›ºæ–¹å¼-1"><a href="#åŠ å›ºæ–¹å¼-1" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><p>ä¸€æ¬¡æ€§è®¾ç½®å…¨å±€è¿‡æœŸç­–ç•¥ï¼š<code>SET GLOBAL default_password_lifetime = 90;</code></p>
</li>
<li><p>æˆ–è€…ç›´æ¥å†™å…¥é…ç½®æ–‡ä»¶å¹¶é‡å¯ä»¥æ°¸ä¹…ç”Ÿæ•ˆ</p>
  <figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥é…ç½®æ–‡ä»¶ä½¿å¾—é‡å¯ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">default_password_lifetime</span> = <span class="number">90</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>è®¾ç½®å…¨å±€è¿‡æœŸç­–ç•¥åï¼Œéœ€è¦æŠŠé…ç½®å†™å…¥é…ç½®æ–‡ä»¶ <code>mysql.cn</code>ä¸­å¹¶é‡å¯æ‰èƒ½æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¦åˆ™ <code>MySQL</code> é‡å¯åæ¢å¤é»˜è®¤å€¼ã€‚</p>
</blockquote>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212211840616.png" alt="image-20221212211840616"></p>
<h4 id="æ ¸æŸ¥æ˜¯å¦é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°"><a href="#æ ¸æŸ¥æ˜¯å¦é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°"></a>æ ¸æŸ¥æ˜¯å¦é™åˆ¶éæ³•ç™»å½•æ¬¡æ•°</h4><p>MySQL&gt;&#x3D; 5.7.17 ä»¥åæä¾›äº† Connection-Control æ’ä»¶ï¼Œç”¨æ¥æ§åˆ¶å®¢æˆ·ç«¯åœ¨ç™»å½•æ“ä½œè¿ç»­å¤±è´¥ä¸€å®šæ¬¡æ•°åçš„å“åº”çš„å»¶è¿Ÿã€‚</p>
<h5 id="æ ¸æŸ¥æ–¹å¼-2"><a href="#æ ¸æŸ¥æ–¹å¼-2" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>show variables like &#39;%connection_control%&#39;;</code><ul>
<li>ä¸ºç©ºï¼Œåˆ™æœªå¯ç”¨æ’ä»¶ï¼Œéœ€è¦å®‰è£…å†è¿›è¡ŒåŠ å›ºã€‚</li>
</ul>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212220652885.png" alt="image-20221212220652885"></p>
<h5 id="åŠ å›ºæ–¹å¼-2"><a href="#åŠ å›ºæ–¹å¼-2" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><h6 id="1ï¼‰å®‰è£…-Connection-Control-æ’ä»¶"><a href="#1ï¼‰å®‰è£…-Connection-Control-æ’ä»¶" class="headerlink" title="1ï¼‰å®‰è£… Connection-Control æ’ä»¶"></a>1ï¼‰å®‰è£… Connection-Control æ’ä»¶</h6><ul>
<li>CONNECTION_CONTROLï¼šç”¨æ¥æ§åˆ¶ç™»å½•å¤±è´¥çš„æ¬¡æ•°åŠå»¶è¿Ÿå“åº”æ—¶é—´ã€‚</li>
<li>CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTSï¼šè¯¥è¡¨å°†ç™»å½•å¤±è´¥çš„æ“ä½œè®°å½•è‡³ISåº“ä¸­ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ¯ä¸ªå¹³å°çš„æ–‡ä»¶ååç¼€éƒ½ä¸åŒ å¯¹äº Unix å’Œç±» Unix ç³»ç»Ÿï¼Œä¸º.soï¼Œå¯¹äº Windows ä¸º.dll</span><br><span class="line">install plugin CONNECTION_CONTROL soname &#x27;connection_control.so&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#x27;connection_control.so&#x27;;</span><br><span class="line">	# å¼€å¯çš„é€‰é¡¹</span><br><span class="line">	# connection_control_failed_connections_threshold	3</span><br><span class="line">	# connection_control_max_connection_delay	2147483647</span><br><span class="line">	# connection_control_min_connection_delay	1000</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h6 id="2ï¼‰å‚æ•°è§£é‡Š"><a href="#2ï¼‰å‚æ•°è§£é‡Š" class="headerlink" title="2ï¼‰å‚æ•°è§£é‡Š"></a>2ï¼‰å‚æ•°è§£é‡Š</h6><ul>
<li><p>connection_control_failed_connections_threshold</p>
<ul>
<li>å¤±è´¥å°è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º3ï¼Œè¡¨ç¤ºå½“è¿æ¥å¤±è´¥3æ¬¡åå¯ç”¨è¿æ¥æ§åˆ¶ï¼Œ0è¡¨ç¤ºä¸å¼€å¯ã€‚</li>
</ul>
</li>
<li><p>connection_control_max_connection_delay</p>
<ul>
<li>å“åº”å»¶è¿Ÿçš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤çº¦25å¤©</li>
</ul>
</li>
<li><p>connection_control_min_connection_delay</p>
<ul>
<li>å“åº”å»¶è¿Ÿçš„æœ€å°æ—¶é—´ï¼Œé»˜è®¤1000å¾®ç§’ï¼Œ1ç§’</li>
</ul>
</li>
</ul>
<h6 id="3ï¼‰å…·ä½“é…ç½®"><a href="#3ï¼‰å…·ä½“é…ç½®" class="headerlink" title="3ï¼‰å…·ä½“é…ç½®"></a>3ï¼‰å…·ä½“é…ç½®</h6><p>æ–¹å¼ä¸€ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ <code>my.cnf</code> or <code>my.ini</code>ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸‹é¢ä¸¤é¡¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.ç™»é™†å¤±è´¥æ¬¡æ•°é™åˆ¶</span></span><br><span class="line"><span class="attr">connection-control-failed-connections-threshold</span>=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.é™åˆ¶é‡è¯•æ—¶é—´ï¼Œæ­¤å¤„ä¸ºæ¯«ç§’ï¼Œæ³¨æ„æŒ‰éœ€æ±‚æ¢ç®—</span></span><br><span class="line"><span class="attr">connection-control-min-connection-delay</span>=<span class="number">900000</span> </span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šè®¾ç½®å…¨å±€å˜é‡ï¼ˆé‡å¯å¤±æ•ˆï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ç™»é™†å¤±è´¥æ¬¡æ•°é™åˆ¶</span><br><span class="line">SET GLOBAL connection_control_failed_connections_threshold = 5;</span><br><span class="line"></span><br><span class="line"># é™åˆ¶é‡è¯•æ—¶é—´ï¼Œæ­¤å¤„ä¸ºæ¯«ç§’ï¼Œæ³¨æ„æŒ‰éœ€æ±‚æ¢ç®—</span><br><span class="line">SET GLOBAL connection_control_min_connection_delay = 900000;</span><br><span class="line"></span><br><span class="line"># é…ç½®å®Œæˆï¼Œå†æ¬¡æŸ¥çœ‹å‚æ•°ï¼š</span><br><span class="line">show variables like &#x27;%connection_control%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212222219404.png" alt="image-20221212222219404"></p>
<h4 id="æ ¸æŸ¥è¶…æ—¶åŠŸèƒ½"><a href="#æ ¸æŸ¥è¶…æ—¶åŠŸèƒ½" class="headerlink" title="æ ¸æŸ¥è¶…æ—¶åŠŸèƒ½"></a>æ ¸æŸ¥è¶…æ—¶åŠŸèƒ½</h4><blockquote>
<p>ä»å®˜æ–¹æ–‡æ¡£ä¸Šæ¥çœ‹ wait_timeout å’Œ interactive_timeout éƒ½æ˜¯æŒ‡ä¸æ´»è·ƒçš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¿æ¥çº¿ç¨‹å¯åŠ¨çš„æ—¶å€™wait_timeoutä¼šæ ¹æ®æ˜¯äº¤äº’æ¨¡å¼è¿˜æ˜¯éäº¤äº’æ¨¡å¼è¢«è®¾ç½®ä¸ºè¿™ä¸¤ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¿è¡Œmysql -uroot -på‘½ä»¤ç™»é™†åˆ°mysqlï¼Œwait_timeoutå°±ä¼šè¢«è®¾ç½®ä¸ºinteractive_timeoutçš„å€¼ã€‚<br>å¦‚æœæˆ‘ä»¬åœ¨wait_timeoutæ—¶é—´å†…æ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œï¼Œé‚£ä¹ˆå†æ¬¡æ“ä½œçš„æ—¶å€™å°±ä¼šæç¤ºè¶…æ—¶ï¼Œè¿™æ—¶ mysql clientä¼šé‡æ–°è¿æ¥ã€‚</p>
</blockquote>
<p>MySQLè¿æ¥è¶…æ—¶é€€å‡ºä¸»è¦çœ‹ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><p>interactive_timeout</p>
<ul>
<li>æœåŠ¡å™¨å…³é—­äº¤äº’å¼è¿æ¥å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°ã€‚</li>
</ul>
</li>
<li><p>wait_timeout</p>
<ul>
<li>æœåŠ¡å™¨å…³é—­éäº¤äº’è¿æ¥ä¹‹å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°ã€‚</li>
</ul>
</li>
<li><p>ä¸¤è€…ç”Ÿæ•ˆå–å†³äº</p>
<ul>
<li>å®¢æˆ·ç«¯æ˜¯äº¤äº’æˆ–è€…éäº¤äº’çš„è¿æ¥ã€‚</li>
<li>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œinteractive_timeoutæ‰ç”Ÿæ•ˆï¼›éäº¤äº’æ¨¡å¼ä¸‹ï¼Œwait_timeoutç”Ÿæ•ˆã€‚</li>
</ul>
</li>
<li><p>connect_timeout &#x3D;10</p>
<ul>
<li>æŒ‡çš„æ˜¯è¿æ¥è¿‡ç¨‹ä¸­æ¡æ‰‹çš„è¶…æ—¶æ—¶é—´(s)</li>
</ul>
</li>
</ul>
<h5 id="æ ¸æŸ¥æ–¹å¼-3"><a href="#æ ¸æŸ¥æ–¹å¼-3" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>show global variables like &#39;%timeout%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212223356808.png" alt="image-20221212223356808"></p>
<h5 id="åŠ å›ºæ–¹å¼-3"><a href="#åŠ å›ºæ–¹å¼-3" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å…¨å±€å˜é‡ `connect_timeout` ä¸º `10s`</span><br><span class="line">msyql&gt; set global connect_timeout=10;</span><br><span class="line"></span><br><span class="line"># è®¾ç½® MySQL Server è¶…æ—¶æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰</span><br><span class="line"># é»˜è®¤æ˜¯28800ï¼Œå³8å°æ—¶ã€‚</span><br><span class="line">msyql&gt; set global wait_timeout=28800;</span><br><span class="line">msyql&gt; set global interactive_timeout=28800;</span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212225225553.png" alt="image-20221212225225553"></p>
<h4 id="æ ¸æŸ¥æ˜¯å¦å¼€å¯è¿œç¨‹åŠ å¯†é€šä¿¡"><a href="#æ ¸æŸ¥æ˜¯å¦å¼€å¯è¿œç¨‹åŠ å¯†é€šä¿¡" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦å¼€å¯è¿œç¨‹åŠ å¯†é€šä¿¡"></a>æ ¸æŸ¥æ˜¯å¦å¼€å¯è¿œç¨‹åŠ å¯†é€šä¿¡</h4><h5 id="æ ¸æŸ¥æ–¹å¼-4"><a href="#æ ¸æŸ¥æ–¹å¼-4" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>show variables like &#39;have_openssl&#39;;</code></li>
<li><code>SHOW VARIABLES LIKE &#39;%ssl%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212203451814.png" alt="image-20221212203451814"></p>
<blockquote>
<p>MySQL8.0.12é»˜è®¤å¼€å¯åŠ å¯†é€šä¿¡</p>
<p>ç¦ç”¨åŠ å¯†é€šä¿¡ï¼šåœ¨é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­çš„ <code>[mysqld]</code> ä¸‹åŠ å…¥<code>skip_ssl</code>ï¼Œé‡å¯MySQLã€‚</p>
</blockquote>
<h5 id="åŠ å›ºæ–¹å¼-4"><a href="#åŠ å›ºæ–¹å¼-4" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><p>åŠ å›ºé€šä¿¡ä¼ è¾“è¦æ±‚é¡¹ï¼šå¯ç”¨ <code>ssl</code> åŠ å¯†é€šä¿¡ï¼Œ<em><strong>æ³¨é‡Š</strong></em> é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­çš„ <code>[mysqld]</code> ä¸‹çš„<code>skip_ssl</code>ï¼Œå¹¶åœ¨ä¸‹é¢è¿½åŠ  <code>ssl</code>ï¼Œé‡å¯MySQLã€‚</p>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212204608383.png" alt="image-20221212204608383"></p>
<h3 id="8-1-4-2-è®¿é—®æ§åˆ¶"><a href="#8-1-4-2-è®¿é—®æ§åˆ¶" class="headerlink" title="8.1.4.2 è®¿é—®æ§åˆ¶"></a>8.1.4.2 è®¿é—®æ§åˆ¶</h3><p>æœ¬é¡¹è¦æ±‚åŒ…æ‹¬ï¼š</p>
<p>a) åº”å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™</li>
</ul>
<p>b) åº”é‡å‘½åæˆ–åˆ é™¤é»˜è®¤è´¦æˆ·ï¼Œä¿®æ”¹é»˜è®¤è´¦æˆ·çš„é»˜è®¤å£ä»¤ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦é‡å‘½åè´¦å·</li>
<li>æ ¸æŸ¥æ˜¯å¦ä¿®æ”¹é»˜è®¤å£ä»¤</li>
</ul>
<p>c) åº”åŠæ—¶åˆ é™¤æˆ–åœç”¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦æˆ·ï¼Œé¿å…å…±äº«è´¦æˆ·çš„å­˜åœ¨ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦å­˜åœ¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·</li>
</ul>
<p>d) åº”æˆäºˆç®¡ç†ç”¨æˆ·æ‰€éœ€çš„æœ€å°æƒé™ï¼Œå®ç°ç®¡ç†ç”¨æˆ·çš„æƒé™åˆ†ç¦»ï¼›</p>
<p>e) åº”ç”±æˆæƒä¸»ä½“é…ç½®è®¿é—®æ§åˆ¶ç­–ç•¥ï¼Œè®¿é—®æ§åˆ¶ç­–ç•¥è§„å®šä¸»ä½“å¯¹å®¢ä½“çš„è®¿é—®è§„åˆ™ï¼›</p>
<p>f) è®¿é—®æ§åˆ¶çš„ç²’åº¦åº”è¾¾åˆ°ä¸»ä½“ä¸ºç”¨æˆ·çº§æˆ–è¿›ç¨‹çº§ï¼Œå®¢ä½“ä¸ºæ–‡ä»¶ã€æ•°æ®åº“è¡¨çº§ï¼›</p>
<p>g) åº”å¯¹é‡è¦ä¸»ä½“å’Œå®¢ä½“è®¾ç½®å®‰å…¨æ ‡è®°ï¼Œå¹¶æ§åˆ¶ä¸»ä½“å¯¹æœ‰å®‰å…¨æ ‡è®°ä¿¡æ¯èµ„æºçš„è®¿é—®ã€‚</p>
<h4 id="æ ¸æŸ¥æ˜¯å¦å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™"><a href="#æ ¸æŸ¥æ˜¯å¦å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™"></a>æ ¸æŸ¥æ˜¯å¦å¯¹ç™»å½•çš„ç”¨æˆ·åˆ†é…è´¦æˆ·å’Œæƒé™</h4><h5 id="æ ¸æŸ¥æ–¹å¼-5"><a href="#æ ¸æŸ¥æ–¹å¼-5" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MySQL ä¸­æ‰€æœ‰ä½¿ç”¨è€…çš„æƒé™æ˜¯è®°å½•åœ¨ `mysql` è¿™ä¸ªæ•°æ®åº“çš„ `user` èµ„æ–™è¡¨ä¸­:</span></span><br><span class="line">SELECT * FROM mysql.user;</span><br><span class="line"><span class="comment"># ä½ å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ä½¿ç”¨è€…æƒé™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰å…³dbçš„æ•°æ®æ˜¯è®°å½•åœ¨Db(å¤§å°å†™è¦æ³¨æ„)è¿™ä¸ªæ•°æ®è¡¨ä¸­</span></span><br><span class="line">SELECT * FROM mysql.Db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½ å¯ä»¥ç”¨æ¡ä»¶æŸ¥è¯¢æ‰¾å‡ºä½ è¦çš„ç­”æ¡ˆ</span></span><br><span class="line">SELECT * FROM mysql.Db WHERE Db=<span class="string">&#x27;$&#123;dbname&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000354563.png" alt="image-20221213000354563"></p>
<h5 id="åŠ å›ºæ–¹å¼-5"><a href="#åŠ å›ºæ–¹å¼-5" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><p>ç¦æ­¢rootè´¦å·è¿œç¨‹ç™»å½•</p>
</li>
<li><p>ç¦æ­¢ç¨‹åºä½¿ç”¨rootè´¦å·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- è®¾ç½®å…è®¸ä»»ä½•IPç™»å½•</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000524679.png" alt="image-20221213000524679"></p>
<h4 id="æ ¸æŸ¥æ˜¯å¦é‡å‘½åè´¦å·"><a href="#æ ¸æŸ¥æ˜¯å¦é‡å‘½åè´¦å·" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦é‡å‘½åè´¦å·"></a>æ ¸æŸ¥æ˜¯å¦é‡å‘½åè´¦å·</h4><h5 id="æ ¸æŸ¥æ–¹å¼-6"><a href="#æ ¸æŸ¥æ–¹å¼-6" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212234533536.png" alt="image-20221212234533536"></p>
<h5 id="åŠ å›ºæ–¹å¼-6"><a href="#åŠ å›ºæ–¹å¼-6" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><p>ä¿®æ”¹rootè´¦å·å</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set user=&#x27;haiyi_root&#x27; where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000732709.png" alt="image-20221213000732709"></p>
<h4 id="æ ¸æŸ¥æ˜¯å¦ä¿®æ”¹é»˜è®¤å£ä»¤"><a href="#æ ¸æŸ¥æ˜¯å¦ä¿®æ”¹é»˜è®¤å£ä»¤" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦ä¿®æ”¹é»˜è®¤å£ä»¤"></a>æ ¸æŸ¥æ˜¯å¦ä¿®æ”¹é»˜è®¤å£ä»¤</h4><h5 id="æ ¸æŸ¥æ–¹å¼-7"><a href="#æ ¸æŸ¥æ–¹å¼-7" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li>è®¿è°ˆ</li>
<li>æŸ¥è¯¢ç©ºå£ä»¤è´¦å·<ul>
<li><code>select * from mysql.user where length(authentication_string)=0 or authentication_string is null;</code></li>
</ul>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213162949400.png" alt="image-20221213162949400"></p>
<h5 id="åŠ å›ºæ–¹å¼-7"><a href="#åŠ å›ºæ–¹å¼-7" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li>ä¿®æ”¹é»˜è®¤å£ä»¤ã€ç©ºå£ä»¤(è°¨æ…æ“ä½œ)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; USE mysql;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; UPDATE user SET authentication_string=&quot;H!q@31UI!&quot; WHERE user=&quot;root&quot;;</span><br><span class="line">Query OK, 1 row affected (0.39 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH privileges;  # åˆ·æ–°ä¿å­˜</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br></pre></td></tr></table></figure>



<h4 id="æ ¸æŸ¥æ˜¯å¦å­˜åœ¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·"><a href="#æ ¸æŸ¥æ˜¯å¦å­˜åœ¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦å­˜åœ¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·"></a>æ ¸æŸ¥æ˜¯å¦å­˜åœ¨å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·</h4><h5 id="æ ¸æŸ¥æ–¹å¼-8"><a href="#æ ¸æŸ¥æ–¹å¼-8" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212235526618.png" alt="image-20221212235526618"></p>
<h5 id="åŠ å›ºæ–¹å¼-8"><a href="#åŠ å›ºæ–¹å¼-8" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><p>åˆ é™¤å¤šä½™çš„ã€è¿‡æœŸçš„è´¦å·ï¼Œå¦‚ï¼štest, devç­‰æµ‹è¯•è´¦å·ã€‚</p>
</li>
<li><p>åˆ é™¤ <code>test</code>ï¼š<code>drop user &#39;test&#39;@&#39;localhost&#39;;</code></p>
</li>
<li><p>åˆ é™¤ <code>dev</code> ï¼š<code>drop user &#39;dev&#39;@&#39;localhost&#39;;</code></p>
</li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221212235744110.png" alt="image-20221212235744110"></p>
<h3 id="8-1-4-3-å®‰å…¨å®¡è®¡"><a href="#8-1-4-3-å®‰å…¨å®¡è®¡" class="headerlink" title="8.1.4.3 å®‰å…¨å®¡è®¡"></a>8.1.4.3 å®‰å…¨å®¡è®¡</h3><p>æœ¬é¡¹è¦æ±‚åŒ…æ‹¬ï¼š</p>
<p>a) åº”å¯ç”¨å®‰å…¨å®¡è®¡åŠŸèƒ½ï¼Œå®¡è®¡è¦†ç›–åˆ°æ¯ä¸ªç”¨æˆ·ï¼Œå¯¹é‡è¦çš„ç”¨æˆ·è¡Œä¸ºå’Œé‡è¦å®‰å…¨äº‹ä»¶è¿›è¡Œå®¡è®¡ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•</li>
</ul>
<p>b) å®¡è®¡è®°å½•åº”åŒ…æ‹¬äº‹ä»¶çš„æ—¥æœŸå’Œæ—¶é—´ã€ç”¨æˆ·ã€äº‹ä»¶ç±»å‹ã€äº‹ä»¶æ˜¯å¦æˆåŠŸåŠå…¶ä»–ä¸å®¡è®¡ç›¸å…³çš„ä¿¡æ¯ï¼›</p>
<p>c) åº”å¯¹å®¡è®¡è®°å½•è¿›è¡Œä¿æŠ¤ï¼Œå®šæœŸå¤‡ä»½ï¼Œé¿å…å—åˆ°æœªé¢„æœŸçš„åˆ é™¤ã€ä¿®æ”¹æˆ–è¦†ç›–ç­‰ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ—¥å¿—ä¿å­˜æ—¶é—´</li>
<li>æ ¸æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™ä¿¡æ¯</li>
</ul>
<p>d) åº”å¯¹å®¡è®¡è¿›ç¨‹è¿›è¡Œä¿æŠ¤ï¼Œé˜²æ­¢æœªç»æˆæƒçš„ä¸­æ–­ã€‚</p>
<h4 id="æ ¸æŸ¥æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•"><a href="#æ ¸æŸ¥æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•"></a>æ ¸æŸ¥æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•</h4><h5 id="æ ¸æŸ¥æ–¹å¼-9"><a href="#æ ¸æŸ¥æ–¹å¼-9" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li>æŸ¥è¯¢æ‰€æœ‰æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼š<code>show variables like &#39;%log%&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213094849716.png" alt="image-20221213094849716"></p>
<h5 id="åŠ å›ºæ–¹å¼-9"><a href="#åŠ å›ºæ–¹å¼-9" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><h6 id="1-å¼€å¯å¸¸è§„æ—¥å¿—å®¡è®¡åŠŸèƒ½"><a href="#1-å¼€å¯å¸¸è§„æ—¥å¿—å®¡è®¡åŠŸèƒ½" class="headerlink" title="1) å¼€å¯å¸¸è§„æ—¥å¿—å®¡è®¡åŠŸèƒ½"></a>1) å¼€å¯å¸¸è§„æ—¥å¿—å®¡è®¡åŠŸèƒ½</h6><ul>
<li><code>set global general_log=on;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213095710756.png" alt="image-20221213095710756"></p>
<h6 id="2-å¼€å¯é”™è¯¯æ—¥å¿—å®¡è®¡åŠŸèƒ½"><a href="#2-å¼€å¯é”™è¯¯æ—¥å¿—å®¡è®¡åŠŸèƒ½" class="headerlink" title="2) å¼€å¯é”™è¯¯æ—¥å¿—å®¡è®¡åŠŸèƒ½"></a>2) å¼€å¯é”™è¯¯æ—¥å¿—å®¡è®¡åŠŸèƒ½</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯æ—¥å¿—åŒ…æ‹¬æ•°æ®åº“è¿è¡Œå’Œåœæ­¢è¿‡ç¨‹ä¸­çš„ä¸€ç³»åˆ—æ´»åŠ¨ä¿¡æ¯ï¼Œæœ‰åŠ©äºåˆ†ææ•°æ®åº“è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›å¼‚å¸¸æ´»åŠ¨</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦å¼€å¯é”™è¯¯æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</span></span><br><span class="line"></span><br><span class="line">SHOW variables LIKE <span class="string">&#x27;log_error&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®ä¿è¿”å›ç»“æœä¸ºéç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œéœ€è¦åœ¨mysqlæ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­å¢åŠ ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># &gt;&gt;&gt; log_error	D:\phpstudy_pro\Extensions\MySQL8.0.12\data.err</span></span><br></pre></td></tr></table></figure>

<h6 id="3-ç¡®ä¿æ—¥å¿—å­˜æ”¾åœ¨éç³»ç»ŸåŒºåŸŸ"><a href="#3-ç¡®ä¿æ—¥å¿—å­˜æ”¾åœ¨éç³»ç»ŸåŒºåŸŸ" class="headerlink" title="3) ç¡®ä¿æ—¥å¿—å­˜æ”¾åœ¨éç³»ç»ŸåŒºåŸŸ"></a>3) ç¡®ä¿æ—¥å¿—å­˜æ”¾åœ¨éç³»ç»ŸåŒºåŸŸ</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶éšç€æ•°æ®åº“çš„è¿è¡Œä¼šä¸æ–­å¢åŠ ï¼Œå¦‚æœå­˜æ”¾åœ¨ç³»ç»ŸåŒºåŸŸï¼Œåˆ™ä¼šå½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥è¯¢ï¼š</span></span><br><span class="line"></span><br><span class="line">SELECT @@global.log_bin_basename;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®ä¿è¿”å›ç»“æœä¸æ˜¯å¦‚ä¸‹è·¯å¾„ï¼š/ã€/varã€/usr</span></span><br></pre></td></tr></table></figure>

<h6 id="4-å…³é—­åŸå§‹æ—¥å¿—åŠŸèƒ½"><a href="#4-å…³é—­åŸå§‹æ—¥å¿—åŠŸèƒ½" class="headerlink" title="4) å…³é—­åŸå§‹æ—¥å¿—åŠŸèƒ½"></a>4) å…³é—­åŸå§‹æ—¥å¿—åŠŸèƒ½</h6><blockquote>
<p>å½“ <code>log-raw</code> è®°å½•å¯ç”¨æ—¶ï¼Œæœ‰æƒè®¿é—®æ—¥å¿—æ–‡ä»¶çš„äººå¯èƒ½ä¼šçœ‹åˆ°çº¯æ–‡æœ¬å¯†ç ã€‚</p>
<p>ç¼–è¾‘ MySQL é…ç½®æ–‡ä»¶ <code>/etc/my.cnf</code> ï¼Œåˆ é™¤ <code>log-raw</code> å‚æ•°ï¼Œå¹¶é‡å¯ <code>mysql</code> æœåŠ¡</p>
<blockquote>
<p>ä¸Šè¿°ä¸ä¸‹é¢çš„æ“ä½œå¥½åƒæœ‰ç‚¹å†²çªï¼Œä»¥å®é™…æƒ…å†µä¸ºå‡†ã€‚å¾…æ¢ç´¢â€¦â€¦</p>
</blockquote>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸå§‹æ—¥å¿—é€‰é¡¹ä¼šå†³å®šä¸€äº›æ•æ„Ÿä¿¡æ¯æ˜¯å¦ä¼šè¢«æ˜æ–‡å†™è¿›æ—¥å¿—ä¸­ï¼Œä¾‹å¦‚æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"><span class="comment"># ç¡®ä¿æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨å¦‚ä¸‹é…ç½®é¡¹ï¼š</span></span><br><span class="line"></span><br><span class="line">log-raw = OFF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æ— ï¼Œé…ç½®å¹¶é‡å¯</span></span><br></pre></td></tr></table></figure>



<h4 id="æ ¸æŸ¥æ—¥å¿—ä¿å­˜æ—¶é—´"><a href="#æ ¸æŸ¥æ—¥å¿—ä¿å­˜æ—¶é—´" class="headerlink" title="æ ¸æŸ¥æ—¥å¿—ä¿å­˜æ—¶é—´"></a>æ ¸æŸ¥æ—¥å¿—ä¿å­˜æ—¶é—´</h4><blockquote>
<p>set global expire_logs_days&#x3D;365</p>
<p>&gt; 3683 - The option expire_logs_days and binlog_expire_logs_seconds cannot be used together. Please use binlog_expire_logs_seconds to set the expire time (expire_logs_days is deprecated)</p>
</blockquote>
<h5 id="æ ¸æŸ¥æ–¹å¼-10"><a href="#æ ¸æŸ¥æ–¹å¼-10" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li>æŸ¥çœ‹æ—¥å¿—æ—¶é—´ï¼ˆå·²åºŸå¼ƒï¼‰ï¼š<code>show variables like &#39;%logs_days%&#39;;</code></li>
<li>æŸ¥çœ‹æ—¥å¿—æ—¶é—´ï¼š<code>show variables like &#39;binlog_expire_logs_seconds&#39;;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213100143478.png" alt="image-20221213100143478"></p>
<h5 id="åŠ å›ºæ–¹å¼-10"><a href="#åŠ å›ºæ–¹å¼-10" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><code>set global binlog_expire_logs_seconds=2596096;</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213100323167.png" alt="image-20221213100323167"></p>
<h4 id="æ ¸æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™ä¿¡æ¯"><a href="#æ ¸æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™ä¿¡æ¯" class="headerlink" title="æ ¸æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™ä¿¡æ¯"></a>æ ¸æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™ä¿¡æ¯</h4><h5 id="1-æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æƒé™"><a href="#1-æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æƒé™" class="headerlink" title="1) æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æƒé™"></a>1) æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æƒé™</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysqlçš„è¿è¡Œä¼šäº§ç”Ÿå¾ˆå¤šæ—¥å¿—ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ç­‰ï¼ŒMysqlå‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show variables like <span class="string">&#x27;log_bin_basename&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> &lt;log_bin_basename&gt;.*</span><br><span class="line"><span class="comment"># å¯¹äºå‘ç°çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;log_bin_basename.nnnnn&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å‡ºç¡®è®¤æ—¥å¿—æ–‡ä»¶çš„æƒé™è®¾ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹å…¶æƒé™å’Œå±ç»„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt; </span><br></pre></td></tr></table></figure>



<h5 id="2-æ§åˆ¶æ•°æ®ç›®å½•ã€åŸºå‡†ç›®å½•çš„è®¿é—®æƒé™"><a href="#2-æ§åˆ¶æ•°æ®ç›®å½•ã€åŸºå‡†ç›®å½•çš„è®¿é—®æƒé™" class="headerlink" title="2) æ§åˆ¶æ•°æ®ç›®å½•ã€åŸºå‡†ç›®å½•çš„è®¿é—®æƒé™"></a>2) æ§åˆ¶æ•°æ®ç›®å½•ã€åŸºå‡†ç›®å½•çš„è®¿é—®æƒé™</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®ç›®å½•æ˜¯mysqlæ•°æ®åº“å­˜æ”¾çš„ä½ç½®ï¼Œåœ¨mysqlå‘½ä»¤è¡Œç•Œé¢ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show variables <span class="built_in">where</span> variable_name = <span class="string">&#x27;datadir&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯å‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;datadir&gt;/.. | egrep <span class="string">&quot;^d[r|w|x]&#123;3&#125;------\s*.\s*mysql\s*mysql\s*\d*.*mysql&quot;</span></span><br><span class="line"><span class="comment"># å…¶ä¸­&lt;datadir&gt;æ˜¯ç¬¬ä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå­˜åœ¨é—®é¢˜ï¼Œlinuxç¯å¢ƒä¸‹åœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡ŒåŠ å›ºï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 700 &lt;datadir&gt; <span class="comment">#ä»…MySQLæ•°æ®åº“ç”¨æˆ·æœ‰è¯»å†™æƒé™</span></span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;datadir&gt; </span><br><span class="line"><span class="comment"># åŒç†æ§åˆ¶åŸºå‡†ç›®å½•æƒé™ &lt;basedir&gt;ï¼Œä»…DBAå’Œæ•°æ®åº“ç”¨æˆ·å¯è®¿é—®</span></span><br></pre></td></tr></table></figure>



<h5 id="3-æ§åˆ¶é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„æƒé™"><a href="#3-æ§åˆ¶é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„æƒé™" class="headerlink" title="3) æ§åˆ¶é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„æƒé™"></a>3) æ§åˆ¶é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„æƒé™</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ§åˆ¶é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„æƒé™</span></span><br><span class="line"><span class="comment"># Mysqlå‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show variables like <span class="string">&#x27;log_error&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> &lt;log_error&gt;.*</span><br><span class="line"><span class="comment"># å¯¹äºå‘ç°çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;log_error&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å‡ºç¡®è®¤æ—¥å¿—æ–‡ä»¶çš„æƒé™è®¾ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹å…¶æƒé™å’Œå±ç»„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="4-æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„æƒé™"><a href="#4-æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„æƒé™" class="headerlink" title="4) æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„æƒé™"></a>4) æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„æƒé™</h5><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•MySQLä¸­æŸ¥è¯¢æ—¶é—´è¶…è¿‡ï¼ˆå¤§äºï¼‰è®¾ç½®é˜ˆå€¼ï¼ˆlong_query_timeï¼‰çš„è¯­å¥ï¼Œè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ã€‚éœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼Œå¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸å»ºè®®å¼€å¯ï¼Œå› ä¸ºå¼€å¯ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆï¼Œå¹¶ä¸”é‡å¯æ•°æ®åº“åå¤±æ•ˆ</span><br><span class="line">set global slow_query_log = 1;</span><br></pre></td></tr></table></figure>

<p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶æƒé™æ§åˆ¶æŸ¥çœ‹ä¸è®¾ç½®ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mysqlå‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show variables like <span class="string">&#x27;slow_query_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> &lt;slow_query_log_file&gt;.*</span><br><span class="line"><span class="comment"># å¯¹äºå‘ç°çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;slow_query_log_file&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å‡ºç¡®è®¤æ—¥å¿—æ–‡ä»¶çš„æƒé™è®¾ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹å…¶æƒé™å’Œå±ç»„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="5-æ§åˆ¶é€šç”¨æ—¥å¿—æ–‡ä»¶çš„æƒé™"><a href="#5-æ§åˆ¶é€šç”¨æ—¥å¿—æ–‡ä»¶çš„æƒé™" class="headerlink" title="5) æ§åˆ¶é€šç”¨æ—¥å¿—æ–‡ä»¶çš„æƒé™"></a>5) æ§åˆ¶é€šç”¨æ—¥å¿—æ–‡ä»¶çš„æƒé™</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mysqlå‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show variables like <span class="string">&#x27;general_log_file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> &lt;general_log_file&gt;.*</span><br><span class="line"><span class="comment"># å¯¹äºå‘ç°çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;general_log_file&gt; | egrep <span class="string">&quot;^-[r|w]&#123;2&#125;-[r|w]&#123;2&#125;----\s*.*$&quot;</span> </span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å‡ºç¡®è®¤æ—¥å¿—æ–‡ä»¶çš„æƒé™è®¾ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹å…¶æƒé™å’Œå±ç»„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;<span class="built_in">log</span> file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;<span class="built_in">log</span> file&gt;</span><br></pre></td></tr></table></figure>



<h5 id="6-æ§åˆ¶å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æƒé™"><a href="#6-æ§åˆ¶å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æƒé™" class="headerlink" title="6) æ§åˆ¶å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æƒé™"></a>6) æ§åˆ¶å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„æƒé™</h5><blockquote>
<h5 id="Naming-Conventions-for-Audit-Log-Files"><a href="#Naming-Conventions-for-Audit-Log-Files" class="headerlink" title="Naming Conventions for Audit Log Files"></a>Naming Conventions for Audit Log Files</h5><p>To configure the audit log file name, set the <a href="https://dev.mysql.com/doc/refman/8.0/en/audit-log-reference.html#sysvar_audit_log_file"><code>audit_log_file</code></a> system variable at server startup. The default name is <code>audit.log</code> in the server data directory. For best security, write the audit log to a directory accessible only to the MySQL server and to users with a legitimate reason to view the log.</p>
<p>[MySQL :: MySQL 8.0 Reference Manual :: 6.4.5.5 Configuring Audit Logging Characteristics](<a href="https://dev.mysql.com/doc/refman/8.0/en/audit-log-logging-configuration.html#:~:text=To">https://dev.mysql.com/doc/refman/8.0/en/audit-log-logging-configuration.html#:~:text=To</a> configure the audit log file name%2C set,with a legitimate reason to view the log.)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mysqlå‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">show global variables <span class="built_in">where</span> variable_name =  <span class="string">&#x27;audit_log_file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="built_in">ls</span> -l &lt;audit_log_file&gt; | egrep <span class="string">&quot;^-rw[-x]rw[-x][-r][-w][-x][ \t]*[0-9][ \t]*mysql[\t]*mysql.*$&quot;</span></span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å‡ºç¡®è®¤æ—¥å¿—æ–‡ä»¶çš„æƒé™è®¾ç½®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä¿®æ”¹å…¶æƒé™å’Œå±ç»„å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="built_in">chmod</span> 660 &lt;audit_log_file&gt;</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql &lt;audit_log_file&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-1-4-4-å…¥ä¾µé˜²èŒƒ"><a href="#8-1-4-4-å…¥ä¾µé˜²èŒƒ" class="headerlink" title="8.1.4.4 å…¥ä¾µé˜²èŒƒ"></a><strong>8.1.4.4 å…¥ä¾µé˜²èŒƒ</strong></h3><p>æœ¬é¡¹è¦æ±‚åŒ…æ‹¬ï¼š</p>
<p>a) åº”éµå¾ªæœ€å°å®‰è£…çš„åŸåˆ™ï¼Œä»…å®‰è£…éœ€è¦çš„ç»„ä»¶å’Œåº”ç”¨ç¨‹åºï¼›</p>
<ul>
<li>æ ¸æŸ¥æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·</li>
</ul>
<p>b) åº”å…³é—­ä¸éœ€è¦çš„ç³»ç»ŸæœåŠ¡ã€é»˜è®¤å…±äº«å’Œé«˜å±ç«¯å£ï¼›</p>
<p>c) åº”é€šè¿‡è®¾å®šç»ˆç«¯æ¥å…¥æ–¹å¼æˆ–ç½‘ç»œåœ°å€èŒƒå›´å¯¹é€šè¿‡ç½‘ç»œè¿›è¡Œç®¡ç†çš„ç®¡ç†ç»ˆç«¯è¿›è¡Œé™åˆ¶ï¼›</p>
<ul>
<li>æ ¸æŸ¥æ˜¯å¦é™åˆ¶æºIPè®¿é—®</li>
</ul>
<p>d) åº”æä¾›æ•°æ®æœ‰æ•ˆæ€§æ£€éªŒåŠŸèƒ½ï¼Œä¿è¯é€šè¿‡äººæœºæ¥å£è¾“å…¥æˆ–é€šè¿‡é€šä¿¡æ¥å£è¾“å…¥çš„å†…å®¹ç¬¦åˆç³»ç»Ÿè®¾å®šè¦æ±‚ï¼›</p>
<p>e) åº”èƒ½å‘ç°å¯èƒ½å­˜åœ¨çš„å·²çŸ¥æ¼æ´ï¼Œå¹¶åœ¨ç»è¿‡å……åˆ†æµ‹è¯•è¯„ä¼°åï¼ŒåŠæ—¶ä¿®è¡¥æ¼æ´ï¼›</p>
<ul>
<li><del>æ ¸æŸ¥æ˜¯å¦åŠæ—¶æ‰“è¡¥ä¸</del></li>
</ul>
<p>f) åº”èƒ½å¤Ÿæ£€æµ‹åˆ°å¯¹é‡è¦èŠ‚ç‚¹è¿›è¡Œå…¥ä¾µçš„è¡Œä¸ºï¼Œå¹¶åœ¨å‘ç”Ÿä¸¥é‡å…¥ä¾µäº‹ä»¶æ—¶æä¾›æŠ¥è­¦ã€‚</p>
<h4 id="æ ¸æŸ¥æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·"><a href="#æ ¸æŸ¥æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·" class="headerlink" title="æ ¸æŸ¥æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·"></a>æ ¸æŸ¥æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·</h4><h5 id="æ ¸æŸ¥æ–¹å¼-11"><a href="#æ ¸æŸ¥æ–¹å¼-11" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li>æŸ¥è¯¢æ•°æ®åº“ï¼š<code>show DATABASES;</code></li>
<li>ä½¿ç”¨è¯¥å‘½ä»¤æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç©ºè´¦å·ï¼š<code>SELECT user,host FROM mysql.user WHERE user = &#39;&#39;; </code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101248151.png" alt="æŸ¥è¯¢ç©ºç”¨æˆ·åç”¨æˆ·"></p>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101419440.png" alt="æŸ¥è¯¢æ•°æ®åº“"></p>
<h5 id="åŠ å›ºæ–¹å¼-11"><a href="#åŠ å›ºæ–¹å¼-11" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><p>åˆ é™¤æµ‹è¯•æ•°æ®åº“ä»¥åŠç©ºè´¦å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å†—ä½™æ•°æ®åº“, å¦‚ test</span></span><br><span class="line">drop database <span class="keyword">if</span> exists <span class="variable">$&#123;dbname&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤æ— ç”¨ç”¨æˆ·ï¼ˆæ²¡æœ‰ç”¨æˆ·åçš„ç”¨æˆ·ï¼‰</span></span><br><span class="line">drop user <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213101612486.png" alt="image-20221213101612486"></p>
<h4 id="æ ¸æŸ¥æ˜¯å¦é™åˆ¶æºIPè®¿é—®"><a href="#æ ¸æŸ¥æ˜¯å¦é™åˆ¶æºIPè®¿é—®" class="headerlink" title="æ ¸æŸ¥æ˜¯å¦é™åˆ¶æºIPè®¿é—®"></a>æ ¸æŸ¥æ˜¯å¦é™åˆ¶æºIPè®¿é—®</h4><blockquote>
<p>é»˜è®¤éœ€è¦æ‰€æœ‰è´¦å·è¿›è¡Œé™åˆ¶ï¼Œä¸èƒ½å­˜åœ¨ â€œ<code>%</code> â€œ ä»»æ„æº <code>IP</code> è®¾ç½®ã€‚</p>
</blockquote>
<h5 id="æ ¸æŸ¥æ–¹å¼-12"><a href="#æ ¸æŸ¥æ–¹å¼-12" class="headerlink" title="æ ¸æŸ¥æ–¹å¼"></a>æ ¸æŸ¥æ–¹å¼</h5><ul>
<li><code>SELECT user, host FROM mysql.user</code></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000354563.png" alt="image-20221213000354563"></p>
<h5 id="åŠ å›ºæ–¹å¼-12"><a href="#åŠ å›ºæ–¹å¼-12" class="headerlink" title="åŠ å›ºæ–¹å¼"></a>åŠ å›ºæ–¹å¼</h5><ul>
<li><p>è®¾ç½® <code>$&#123;è´¦å·&#125;</code> æŒ‡å®šæºIPç™»å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># update user set host=&#x27;$&#123;IP&#125;&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line"># è®¾ç½® root ç”¨æˆ·åªå…è®¸æœ¬åœ°ç™»å½•</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img data-src="/../images/harden-mysql/knowledge-baseimage-20221213000524679.png" alt="image-20221213000524679"></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><h3 id="å®‰å…¨æ ‡å‡†"><a href="#å®‰å…¨æ ‡å‡†" class="headerlink" title="å®‰å…¨æ ‡å‡†"></a>å®‰å…¨æ ‡å‡†</h3><ul>
<li><a href="http://c.gb688.cn/bzgk/gb/showGb?type=online&hcno=BAFB47E8874764186BDB7865E8344DAF"><strong>ã€Šä¿¡æ¯å®‰å…¨æŠ€æœ¯  ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤åŸºæœ¬è¦æ±‚ã€‹</strong></a></li>
</ul>
<h3 id="äº§å“æ–‡æ¡£"><a href="#äº§å“æ–‡æ¡£" class="headerlink" title="äº§å“æ–‡æ¡£"></a>äº§å“æ–‡æ¡£</h3><ul>
<li><a href="https://dev.mysql.com/doc/">MySQL :: MySQL Documentation</a></li>
</ul>
<h3 id="åšå®¢æ–‡ç« "><a href="#åšå®¢æ–‡ç« " class="headerlink" title="åšå®¢æ–‡ç« "></a>åšå®¢æ–‡ç« </h3><ul>
<li><a href="https://blog.csdn.net/Lee_Natuo/article/details/83995418">(100æ¡æ¶ˆæ¯) MySQLæ•°æ®åº“å®‰å…¨åŠ å›ºæ–¹æ³•_Lee_Natuoçš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2115190">MySQL8.0æ­£ç¡®ä¿®æ”¹å¯†ç çš„å§¿åŠ¿- è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></li>
<li><a href="https://blog.csdn.net/liliuqing/article/details/88723409">(100æ¡æ¶ˆæ¯) mysql8.0.15ç”¨æˆ·rootç™»å½•å¼€å¯è¿œç¨‹è®¿é—®æƒé™_è—¤å¶é¦™æ¥çš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://blog.csdn.net/qq_40147863/article/details/86485439">(100æ¡æ¶ˆæ¯) MySQL 8.0 ç‰ˆæœ¬æˆæƒ root è¿œç¨‹è¿æ¥ï¼Œä¿®æ”¹æƒé™ï¼Œæ›´æ”¹åŠ å¯†æ–¹å¼_è‚–æœ‹ä¼Ÿçš„åšå®¢-CSDNåšå®¢_mysql8.0æ›´æ”¹root æƒé™</a></li>
<li>[(100æ¡æ¶ˆæ¯) Linuxç³»ç»Ÿä¸­ï¼ŒMysql 8çš„å®‰è£…ã€ä¿®æ”¹rootå¯†ç åŠå…è®¸rootè¿œç¨‹ç™»å½•_æ—¶æ ˆçš„åšå®¢-CSDNåšå®¢_mysql8å…è®¸rootè¿œç¨‹è¿æ¥](<a href="https://blog.csdn.net/qq_44667259/article/details/123228144#:~:text=%E4%B8%80%E3%80%81CentOS%E7%B3%BB%E7%BB%9F%E4%B8%ADMysql">https://blog.csdn.net/qq_44667259/article/details/123228144#:~:text=ä¸€ã€CentOSç³»ç»Ÿä¸­Mysql</a> 8çš„å®‰è£… 1 1.å®‰è£… sudo yum install mysql-,user from user where user%3Dâ€™rootâ€™%3B %2F%2F æŸ¥çœ‹ )</li>
<li><a href="https://blog.csdn.net/weixin_35067439/article/details/113159734">(100æ¡æ¶ˆæ¯) mysql8.0 åˆ é™¤ç”¨æˆ·_MYSQL8 åˆ›å»ºã€åˆ é™¤ç”¨æˆ·å’Œæˆæƒã€æ¶ˆæƒæ“ä½œ_ç•ªèŒ„å›å°å¼Ÿçš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://blog.csdn.net/qq_23859799/article/details/85862821">(100æ¡æ¶ˆæ¯) mysql8.0æ•°æ®åº“æ·»åŠ ç”¨æˆ·å’Œæˆæƒ_liuzh2443çš„åšå®¢-CSDNåšå®¢_mysql8ç”¨æˆ·æˆæƒ</a></li>
<li><a href="https://blog.csdn.net/weixin_27017211/article/details/113113357">(100æ¡æ¶ˆæ¯) mysql8.0 æ–°å¢ç”¨æˆ·_MySQL8.0æ·»åŠ åˆ›å»ºç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ä¸æˆæƒ(create userï¼Œdelete user)_æ•…äº‹æ¡£æ¡ˆå±€çš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://blog.csdn.net/weixin_35750747/article/details/113155504">(100æ¡æ¶ˆæ¯) mysql connect è¶…æ—¶_MySQLä¿®æ”¹connect_timeoutï¼ˆè¿æ¥è¶…æ—¶ï¼‰å…¨å±€å˜é‡_åŠæ¸…æ–‹çš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://www.jianshu.com/p/d14377a57d3a">MySQLä¿®æ”¹connect_timeoutï¼ˆè¿æ¥è¶…æ—¶ï¼‰å…¨å±€å˜é‡ - ç®€ä¹¦ (jianshu.com)</a></li>
<li>[(100æ¡æ¶ˆæ¯) mysql 5.7 è¿æ¥è¶…æ—¶å‚æ•°è®¾ç½®_å¤§é¾„å¥‹æ–—ç¨‹åºçŒ¿çš„åšå®¢-CSDNåšå®¢_mysql 5.7é…ç½®è¶…æ—¶](<a href="https://blog.csdn.net/aichogn/article/details/118113114#:~:text=connect_timeout%E6%8C%87%E7%9A%84%E6%98%AF%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B%E4%B8%AD%E6%8F%A1%E6%89%8B%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%2C%E5%9C%A8">https://blog.csdn.net/aichogn/article/details/118113114#:~:text=connect_timeoutæŒ‡çš„æ˜¯è¿æ¥è¿‡ç¨‹ä¸­æ¡æ‰‹çš„è¶…æ—¶æ—¶é—´%2Cåœ¨</a> 5.0.52 ä»¥åé»˜è®¤ä¸º,10 ç§’ï¼Œä¹‹å‰ç‰ˆæœ¬é»˜è®¤æ˜¯ 5 ç§’ã€‚)</li>
<li><a href="https://blog.csdn.net/weixin_42586723/article/details/121057330">(100æ¡æ¶ˆæ¯) MySQLå­¦ä¹ ä¹‹ä¸‰çº§ç­‰ä¿æ•´æ”¹_Charles Yançš„åšå®¢-CSDNåšå®¢_mysql ç­‰ä¿</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1173009">è®¾ç½®Mysqlçš„è¿æ¥è¶…æ—¶å‚æ•°wait_timeoutã€interactive_timeout - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></li>
<li><a href="https://blog.csdn.net/xtaypyvi123456/article/details/125274821">(100æ¡æ¶ˆæ¯) Linux MySQL5.7ç­‰ä¿é—®é¢˜æ•´æ”¹ï¼šæ•°æ®åº“æœªé…ç½®ç™»å½•å¤±è´¥å¤„ç†åŠŸèƒ½ï¼Œæœªé…ç½®éæ³•ç™»å½•ç­–ç•¥å’Œç™»å½•è¶…æ—¶è‡ªåŠ¨é€€å‡ºåŠŸèƒ½ã€‚_å¯çˆ±çš„å°å¼ 666çš„åšå®¢-CSDNåšå®¢_mysqlè¶…æ—¶è‡ªåŠ¨é€€å‡ºåŠŸèƒ½ã€‚</a></li>
<li><a href="https://blog.csdn.net/weixin_33622153/article/details/115906282">(100æ¡æ¶ˆæ¯) mysqlå¤šæ¬¡ç™»å½•å¤±è´¥æ§åˆ¶,Mysqlç™»å½•å¤±è´¥å¤šæ¬¡é”å®šé…ç½®_Luna Liçš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://www.cnblogs.com/windysai/p/15996858.html">mysqlå¯†ç ç­–ç•¥å’Œç™»å½•å¤±è´¥å¤„ç† - windysai - åšå®¢å›­ (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/weixin_39762666/article/details/113627025">(100æ¡æ¶ˆæ¯) mysql ä¿®æ”¹ç™»å½•å¤±è´¥å¤„ç†åŠŸèƒ½å‚æ•°_ç­‰ä¿æµ‹è¯„2.0ï¼šMySQLèº«ä»½é‰´åˆ«_weixin_39762666çš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://www.cnblogs.com/mysqljs/p/14246130.html">MySQLå¯†ç å¤æ‚åº¦ä¸å¯†ç è¿‡æœŸç­–ç•¥ä»‹ç» - MySQLæŠ€æœ¯ - åšå®¢å›­ (cnblogs.com)</a></li>
<li><a href="https://www.jianshu.com/p/4ac3cb49d208">mysqlæŸ¥çœ‹å¯†ç è‡ªåŠ¨è¿‡æœŸæ—¶é—´ - ç®€ä¹¦ (jianshu.com)</a></li>
<li><a href="https://blog.csdn.net/andyguan01_2/article/details/88966432">(100æ¡æ¶ˆæ¯) MySQLå…³é—­SSLçš„æ–¹æ³•_andyguan01_2çš„åšå®¢-CSDNåšå®¢_mysqlå…³é—­openssl</a></li>
<li><a href="https://www.jianshu.com/p/63ba67e133ce">é…ç½®MySQLæ”¯æŒssl - ç®€ä¹¦ (jianshu.com)</a></li>
<li><a href="https://blog.csdn.net/qq_39572257/article/details/116227265">(100æ¡æ¶ˆæ¯) MySQLé…ç½®SSLåŠ å¯†è¿æ¥_guan-qingçš„åšå®¢-CSDNåšå®¢_navicate sslè¿æ¥</a></li>
<li><a href="https://blog.csdn.net/Lee_Natuo/article/details/84856377">(100æ¡æ¶ˆæ¯) MySQLæ•°æ®åº“å®‰å…¨åŸºçº¿ï¼ˆåŠ å›ºæ–¹æ³•ï¼‰_Lee_Natuoçš„åšå®¢-CSDNåšå®¢</a></li>
<li><a href="https://blog.csdn.net/weixin_36340926/article/details/113256066">(106æ¡æ¶ˆæ¯) mysqlæ°¸ä¹…ä¿®æ”¹å˜é‡_MySQL 8.0 æ–°ç‰¹æ€§ä¹‹æŒä¹…åŒ–å…¨å±€å˜é‡çš„ä¿®æ”¹_å®åœ¨çŸ¥é“ä»€ä¹ˆçš„åšå®¢-CSDNåšå®¢</a></li>
</ul>
<h3 id="æŒä¹…åŒ–å…¨å±€å˜é‡"><a href="#æŒä¹…åŒ–å…¨å±€å˜é‡" class="headerlink" title="æŒä¹…åŒ–å…¨å±€å˜é‡"></a>æŒä¹…åŒ–å…¨å±€å˜é‡</h3><p>å…¨å±€å˜é‡çš„æŒä¹…åŒ–å‘½ä»¤</p>
<p>1ï¼‰ <code>SET PERSIST</code> </p>
<ul>
<li>ä¿®æ”¹å†…å­˜å€¼ï¼Œå°†å…¨å±€å˜é‡çš„ä¿®æ”¹æŒä¹…åŒ–åˆ°é…ç½®æ–‡ä»¶ä¸­</li>
<li>åªéœ€è¦ <code>SYSTEM_VARIABLES_ADMIN</code></li>
</ul>
<p>2ï¼‰<code>SET PERSIST_ONLY</code></p>
<ul>
<li>åªæŒä¹…åŒ–å…¨å±€å˜é‡ï¼Œè€Œä¸ä¿®æ”¹å…¶å†…å­˜å€¼</li>
<li>éœ€è¦ <code>SYSTEM_VARIABLES_ADMIN</code> å’Œ <code>PERSIST_RO_VARIABLES_ADMIN</code> æƒé™</li>
</ul>
<p>3ï¼‰<code>set persist max_connections=default;</code></p>
<ul>
<li><p>å°†å…¨å±€å˜é‡æŒä¹…åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ³¨æ„ï¼Œæ˜¯é»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å‰çš„å€¼ã€‚</p>
</li>
<li><p>è¿™ä¸ªå‘½ä»¤åŒ <code>set global max_connections=default</code> ç±»ä¼¼ï¼Œéƒ½ä¼šå°†å˜é‡çš„å€¼è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œåªä¸è¿‡å‰è€…è¿˜ä¼šå°†é»˜è®¤å€¼æŒä¹…åŒ–åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
</li>
</ul>
<p>æ¸…é™¤æŒä¹…åŒ–å˜é‡å‘½ä»¤</p>
<p>1ï¼‰<code>RESET PERSIST</code> </p>
<ul>
<li>æ³¨æ„ï¼Œå…¶åªæ˜¯æ¸…ç©º <code>mysqld-auto.cnf</code> å’Œ <code>performance_schema.persisted_variables</code> ä¸­çš„å†…å®¹ï¼Œå¯¹äºå·²ç»ä¿®æ”¹äº†çš„å˜é‡çš„å€¼ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚</li>
</ul>
<h3 id="æ‰§è¡Œè„šæœ¬"><a href="#æ‰§è¡Œè„šæœ¬" class="headerlink" title="æ‰§è¡Œè„šæœ¬"></a>æ‰§è¡Œè„šæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ ¸æŸ¥æ˜¯å¦å¼€å¯åŠ å¯†é€šä¿¡</span><br><span class="line">show variables like &#x27;have_openssl&#x27;;</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%ssl%&#x27;;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®ä¸º0ï¼Œå³è¡¨ç¤ºå¯†ç æ°¸ä¸è¿‡æœŸ</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%default_password_lifetime%&#x27;; </span><br><span class="line">SET GLOBAL default_password_lifetime = 90;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;validate%&#x27;; </span><br><span class="line">INSTALL PLUGIN validate_password SONAME &#x27;validate_password.dll&#x27;;</span><br><span class="line">set global validate_password_length = 16;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;%connection_control%&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL soname &#x27;connection_control.dll&#x27;;</span><br><span class="line">install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#x27;connection_control.dll&#x27;;</span><br><span class="line">SET GLOBAL connection_control_failed_connections_threshold = 5;</span><br><span class="line">SET GLOBAL connection_control_min_connection_delay = 900000;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å·²å®‰è£…æ’ä»¶</span><br><span class="line">show plugins;</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%timeout%&#x27;;</span><br><span class="line">set global connect_timeout = 43200;</span><br><span class="line">set global wait_timeout=28800;</span><br><span class="line">set global interactive_timeout=28800;</span><br><span class="line"></span><br><span class="line">SELECT user, host FROM mysql.user;</span><br><span class="line">create user &#x27;dev&#x27;@&#x27;localhost&#x27; identified by &#x27;Haiyisec@123&#x27;; </span><br><span class="line">create user &#x27;test&#x27;@&#x27;localhost&#x27; identified by &#x27;Haiyisec@123&#x27;; </span><br><span class="line">drop user &#x27;test&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">drop user &#x27;dev&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®åªå…è®¸rootç”¨æˆ·æœ¬åœ°ç™»å½•</span><br><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"># é‡å‘½åè´¦å·</span><br><span class="line">update user set user=&#x27;haiyi_root&#x27; where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">SELECT user, host FROM mysql.user;</span><br><span class="line"></span><br><span class="line"># å®éªŒæ—¶å‡ºç°é—®é¢˜ï¼Œæ›´æ–°åæ— æ³•ç™»å½•ï¼Œè°¨æ…æ“ä½œ</span><br><span class="line">UPDATE user SET authentication_string=&quot;123456&quot; WHERE user=&quot;root&quot;;</span><br><span class="line">FLUSH privileges;</span><br><span class="line"></span><br><span class="line">show variables like &#x27;%log%&#x27;;</span><br><span class="line">show variables like &#x27;slow_query_log%&#x27;;</span><br><span class="line">SHOW variables LIKE &#x27;log_error&#x27;;</span><br><span class="line">SELECT @@global.log_bin_basename;</span><br><span class="line">set global general_log=on;</span><br><span class="line"></span><br><span class="line">set global binlog_expire_logs_seconds=2596096;</span><br><span class="line">show variables like &#x27;binlog_expire_logs_seconds&#x27;;</span><br><span class="line">show variables where variable_name = &#x27;datadir&#x27;; </span><br><span class="line"></span><br><span class="line">SELECT user,host FROM mysql.user WHERE user = &#x27;&#x27;;</span><br><span class="line">CREATE DATABASE test;</span><br><span class="line">DROP DATABASE if EXISTS test;</span><br><span class="line">show DATABASES;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŒ‡å®šç”¨æˆ·æƒé™</span><br><span class="line">SHOW GRANTS FOR &#x27;root&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"># æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</span><br><span class="line">SELECT * FROM mysql.user;</span><br><span class="line"># æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“è¯¦ç»†</span><br><span class="line">SELECT * FROM mysql.Db;</span><br><span class="line"></span><br><span class="line"># å¦‚ä¸‹è¯­å¥æŸ¥è¯¢æ˜¯å¦æœ‰ç”¨æˆ·ä¸éœ€è¦å¯†ç å³å¯ç™»å½•ï¼š</span><br><span class="line">select * from mysql.user where length(authentication_string)=0 or authentication_string is null;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>åŸºçº¿æ ¸æŸ¥ä¸åŠ å›º</category>
      </categories>
      <tags>
        <tag>åŸºçº¿æ ¸æŸ¥ä¸åŠ å›º</tag>
        <tag>mysql</tag>
        <tag>ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤åŸºæœ¬è¦æ±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å‘ç¯å¢ƒä¾èµ–ç»„ä»¶å®¹å™¨åŒ–é…ç½®å‚è€ƒ</title>
    <url>/2023/08/20/docker-compose4dev/</url>
    <content><![CDATA[<p>ä¸ºé¿å…å¼€å‘æ—¶æ€»æ˜¯éœ€è¦è€—æ—¶æ­å»ºå¼€å‘ä¾èµ–çš„ç»„ä»¶ï¼Œå› æ­¤ç»´æŠ¤ä¸€ä¸ª <code>docker-compose</code> ç”¨äºå¿«é€Ÿéƒ¨ç½²ä¾èµ–ç»„ä»¶ç¯å¢ƒ</p>
<h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><ul>
<li>elasticsearch:8.8.0</li>
<li>kibana:8.8.0</li>
<li>redis:7.0.11</li>
<li>mysql:8</li>
<li>postgres:15</li>
<li>grafana-enterprise</li>
</ul>
<p>â€‹	</p>
<span id="more"></span>



<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:8.8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch8</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ELASTIC_PASSWORD=&lt;Your_ELASTIC_PASSWORD&gt;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">esdata:/usr/share/elasticsearch/data</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:8.8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana8</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_NAME=kibana</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">XPACK_SECURITY_ENABLED=true</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kibanadata:/usr/share/kibana/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7.0.11</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹å¯†ç ä»¥åŠç»‘å®šåœ°å€</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--requirepass</span> <span class="string">&quot;&lt;your_redis_pass&gt;&quot;</span> <span class="string">--bind</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redisdata:/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql8</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=caching_sha2_password</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&lt;root_pass&gt;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&lt;your_db&gt;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&lt;your_user&gt;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">&lt;your_pass&gt;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_data:/var/lib/mysql</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:15</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">postgres15</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">database</span>       				<span class="comment"># è®¾ç½®æ•°æ®åº“åç§°</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">user</span>   					<span class="comment"># è®¾ç½®æ•°æ®åº“ç”¨æˆ·</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">PasswOrd</span>				<span class="comment"># è®¾ç½®æ•°æ®åº“å¯†ç </span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgres_data:/var/lib/postgresql/data</span> 	<span class="comment"># æ•°æ®æŒä¹…åŒ–å­˜å‚¨çš„è·¯å¾„</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span> 	<span class="comment"># å°†å®¹å™¨çš„ 5432 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 5432 ç«¯å£</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span> 	<span class="comment"># é»˜è®¤è´¦å·å¯†ç : admin/admin</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana-enterprise</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">GF_INSTALL_PLUGINS=grafana-clock-panel</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;3000:3000&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana-storage:/var/lib/grafana</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">esdata:</span></span><br><span class="line">  <span class="attr">kibanadata:</span></span><br><span class="line">  <span class="attr">redisdata:</span></span><br><span class="line">  <span class="attr">mysql_data:</span></span><br><span class="line">  <span class="attr">postgres_data:</span></span><br><span class="line">  <span class="attr">grafana-storage:</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å¼€å‘ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>docker-compose</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/12/03/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¸…é™¤æ—§çš„æ–‡ä»¶</span></span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆé™æ€æ–‡ä»¶</span></span><br><span class="line">hexo generate</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²GitPage</span></span><br><span class="line">hexo deploy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hello</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 ä¸‹å®‰è£… JDK</title>
    <url>/2023/09/01/setup-jdk/</url>
    <content><![CDATA[<h1 id="ä¸€ã€å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„-OpenJDK"><a href="#ä¸€ã€å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„-OpenJDK" class="headerlink" title="ä¸€ã€å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„ OpenJDK"></a>ä¸€ã€å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„ OpenJDK</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">[root@docker ~]<span class="comment"># java -version</span></span><br><span class="line">openjdk version <span class="string">&quot;1.8.0_222&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_222-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.222-b10, mixed mode) </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½</span></span><br><span class="line">rpm -qa | grep openjdk | xargs rpm -e --nodeps</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®è®¤</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="äºŒã€ä¸‹è½½è§£å‹"><a href="#äºŒã€ä¸‹è½½è§£å‹" class="headerlink" title="äºŒã€ä¸‹è½½è§£å‹"></a>äºŒã€ä¸‹è½½è§£å‹</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">wget https://repo.huaweicloud.com/java/jdk/8u202-b08/jdk-8u202-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar -zxvf ./jdk-8u202-linux-x64.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#ä¸‰ã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="ä¸‰ã€é…ç½®ç¯å¢ƒå˜é‡"></a>ä¸‰ã€é…ç½®ç¯å¢ƒå˜é‡</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Java Environment</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0_202</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre/lib/rt.jar:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib/dt.jar:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç¯å¢ƒå˜é‡æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€æµ‹è¯•"><a href="#å››ã€æµ‹è¯•" class="headerlink" title="å››ã€æµ‹è¯•"></a>å››ã€æµ‹è¯•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">&quot;1.8.0_202&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_202-b08)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å¼€å‘ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>jdk</tag>
        <tag>pyspark</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 éƒ¨ç½² OpenVPN</title>
    <url>/2023/10/29/setup-openvpn/</url>
    <content><![CDATA[<h2 id="0x01-ç¯å¢ƒå®‰è£…"><a href="#0x01-ç¯å¢ƒå®‰è£…" class="headerlink" title="0x01. ç¯å¢ƒå®‰è£…"></a>0x01. ç¯å¢ƒå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–° CentOS è½¯ä»¶åŒ…</span></span><br><span class="line">yum -y update</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… OpenVPN å’Œ EasyRSA</span></span><br><span class="line">yum -y install openvpn easy-rsa firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæœªèƒ½æˆåŠŸå®‰è£… OpenVPNï¼Œåˆ™å¯èƒ½éœ€è¦å…ˆå®‰è£…ä¸€ä¸‹ Epel åº“</span></span><br><span class="line">yum install epel-release -y</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="0x02-è¯ä¹¦ç”Ÿæˆ"><a href="#0x02-è¯ä¹¦ç”Ÿæˆ" class="headerlink" title="0x02. è¯ä¹¦ç”Ÿæˆ"></a>0x02. è¯ä¹¦ç”Ÿæˆ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆéœ€è¦åˆå§‹åŒ– PKI ï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ pki ç›®å½•</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa init-pki</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥æ˜¯ç”Ÿæˆ CA è¯ä¹¦ï¼Œå…¶ä¸­ nopass è¡¨ç¤ºä¸åŠ å¯†ç§é’¥ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿åé¢å¯¼å‡ºå…¬é’¥ä¸é¢å‘æœåŠ¡å™¨è¯ä¹¦</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa build-ca nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¥æ˜¯ç”Ÿæˆäº¤äº’å¯†é’¥</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa gen-dh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹ç”ŸæˆæœåŠ¡ç«¯å¯†é’¥</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa build-server-full server nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥ï¼Œå¦‚æœæœªå¼€å¯åŒè¯ä¹¦å…è®¸å¤šäººç™»é™†ï¼Œåˆ™éœ€è¦å¤šæ¬¡æ‰§è¡Œç”Ÿæˆå¯¹åº”çš„å®¢æˆ·ç«¯å¯†é’¥</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa build-client-full client nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åæ˜¯ç”Ÿæˆè¯ä¹¦äº¤äº’åˆ—è¡¨ï¼Œå¦‚æœä¸éœ€è¦ crl-verify åˆ™å¯ä»¥è·³è¿‡</span></span><br><span class="line">/usr/share/easy-rsa/3/easyrsa gen-crl</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶å®åˆ°è¿™ä¸€æ­¥éœ€è¦çš„è¯ä¹¦éƒ½ä»¥åŠç”Ÿæˆå¥½äº†ï¼Œå¦‚æœä½ å¼€å¯äº† tls-auth åˆ™è¿˜éœ€è¦ç”Ÿæˆå…±äº«å¯†é’¥</span></span><br><span class="line">openvpn --genkey --secret pki/ta.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸Šé¢æ‰€æœ‰è¯ä¹¦éƒ½ç”Ÿæˆå®Œæ¯•ä¹‹å</span></span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•å­˜æ”¾æ‰€æœ‰ç›¸å…³è¯ä¹¦æ–‡ä»¶ï¼Œæ–¹ä¾¿åæœŸç®¡ç†ï¼ˆå¤‡ä»½ä¸æ¢å¤ï¼‰</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯é…ç½®æ‰€éœ€è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> -p openvpn/server</span><br><span class="line"><span class="built_in">cp</span> pki/ca.crt openvpn/server/ca.crt</span><br><span class="line"><span class="built_in">cp</span> pki/dh.pem openvpn/server/dh.pem</span><br><span class="line"><span class="built_in">cp</span> pki/issued/server.crt openvpn/server/server.crt</span><br><span class="line"><span class="built_in">cp</span> pki/private/server.key openvpn/server/server.key</span><br><span class="line"><span class="built_in">cp</span> pki/ta.key openvpn/server/ta.key</span><br><span class="line"><span class="built_in">cp</span> pki/crl.pem openvpn/server/crl.pem</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯é…ç½®æ‰€éœ€è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> -p openvpn/client</span><br><span class="line"><span class="built_in">cp</span> pki/ca.crt openvpn/client/ca.crt</span><br><span class="line"><span class="built_in">cp</span> pki/issued/client.crt openvpn/client/client.crt</span><br><span class="line"><span class="built_in">cp</span> pki/private/client.key openvpn/client/client.key</span><br><span class="line"><span class="built_in">cp</span> pki/ta.key openvpn/client/ta.key</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x03-æœåŠ¡ç«¯é…ç½®"><a href="#0x03-æœåŠ¡ç«¯é…ç½®" class="headerlink" title="0x03. æœåŠ¡ç«¯é…ç½®"></a>0x03. æœåŠ¡ç«¯é…ç½®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶å®˜æ–¹æœåŠ¡ç«¯é…ç½®æ ·ä¾‹</span></span><br><span class="line"><span class="built_in">cp</span> /usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf openvpn/server/server.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment"># ä»¥ä¸‹ä¸ºä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SSL/TLS root certificate (ca), certificate</span></span><br><span class="line"><span class="comment"># (cert), and private key (key).  Each client</span></span><br><span class="line"><span class="comment"># and the server must have their own cert and</span></span><br><span class="line"><span class="comment"># key file.  The server and all clients will</span></span><br><span class="line"><span class="comment"># use the same ca file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the &quot;easy-rsa&quot; directory for a series</span></span><br><span class="line"><span class="comment"># of scripts for generating RSA certificates</span></span><br><span class="line"><span class="comment"># and private keys.  Remember to use</span></span><br><span class="line"><span class="comment"># a unique Common Name for the server</span></span><br><span class="line"><span class="comment"># and each of the client certificates.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Any X509 key management system can be used.</span></span><br><span class="line"><span class="comment"># OpenVPN can also use a PKCS #12 formatted key file</span></span><br><span class="line"><span class="comment"># (see &quot;pkcs12&quot; directive in man page).</span></span><br><span class="line">ca ca.crt</span><br><span class="line">cert server.crt</span><br><span class="line">key server.key  <span class="comment"># This file should be kept secret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Diffie hellman parameters.</span></span><br><span class="line"><span class="comment"># Generate your own with:</span></span><br><span class="line"><span class="comment">#   openssl dhparam -out dh2048.pem 2048</span></span><br><span class="line">dh dh.pem </span><br><span class="line"><span class="comment"># ä»¥ä¸Šé…ç½®å†…å®¹ä¿®æ”¹ä¸ºè¯ä¹¦ç”Ÿæˆæ‰€å¯¹åº”çš„æ–‡ä»¶ååŠè·¯å¾„ï¼ŒæœåŠ¡ç«¯è¯†åˆ«çš„ç›¸å¯¹è·¯å¾„ä¸º `/etc/openvpn`</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Push routes to the client to allow it</span></span><br><span class="line"><span class="comment"># to reach other private subnets behind</span></span><br><span class="line"><span class="comment"># the server.  Remember that these</span></span><br><span class="line"><span class="comment"># private subnets will also need</span></span><br><span class="line"><span class="comment"># to know to route the OpenVPN client</span></span><br><span class="line"><span class="comment"># address pool (10.8.0.0/255.255.255.0)</span></span><br><span class="line"><span class="comment"># back to the OpenVPN server.</span></span><br><span class="line">push <span class="string">&quot;route 172.16.1.0 255.255.255.0&quot;</span></span><br><span class="line">push <span class="string">&quot;route 192.168.1.0 255.255.255.0&quot;</span></span><br><span class="line"><span class="comment"># æ¨é€è·¯ç”±ä¿¡æ¯ç»™å®¢æˆ·ç«¯ä»¥æ‰¾åˆ° VPN èƒŒåçš„å­ç½‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># This config item must be copied to</span></span><br><span class="line"><span class="comment"># the client config file as well.</span></span><br><span class="line"><span class="comment"># Note that v2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-GCM <span class="comment"># åŸï¼šAES-256-CBC</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸ºå®‰å…¨æ€§æ›´é«˜çš„åŠ å¯†æ–¹å¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åè¿½åŠ ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">crl-verify crl.pem</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x04-å®¢æˆ·ç«¯é…ç½®"><a href="#0x04-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="0x04. å®¢æˆ·ç«¯é…ç½®"></a>0x04. å®¢æˆ·ç«¯é…ç½®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤æ‚å®˜æ–¹å®¢æˆ·ç«¯é…ç½®æ ·ä¾‹</span></span><br><span class="line"><span class="built_in">cp</span> /usr/share/doc/openvpn-2.4.12/sample/sample-config-files/client.conf openvpn/client/client.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment"># ä»¥ä¸‹ä¸ºä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment"># The hostname/IP and port of the server.</span></span><br><span class="line"><span class="comment"># You can have multiple remote entries</span></span><br><span class="line"><span class="comment"># to load balance between the servers.</span></span><br><span class="line">remote my-server-1 1194</span><br><span class="line">;remote my-server-2 1194</span><br><span class="line"><span class="comment"># ä¿®æ”¹æœåŠ¡å™¨ç›‘å¬åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SSL/TLS parms.</span></span><br><span class="line"><span class="comment"># See the server config file for more</span></span><br><span class="line"><span class="comment"># description.  It&#x27;s best to use</span></span><br><span class="line"><span class="comment"># a separate .crt/.key file pair</span></span><br><span class="line"><span class="comment"># for each client.  A single ca</span></span><br><span class="line"><span class="comment"># file can be used for all clients.</span></span><br><span class="line">ca ca.crt</span><br><span class="line">cert client.crt</span><br><span class="line">key client.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># If a tls-auth key is used on the server</span></span><br><span class="line"><span class="comment"># then every client must also have the key.</span></span><br><span class="line">tls-auth ta.key 1</span><br><span class="line"><span class="comment"># ä»¥ä¸Šé…ç½®å†…å®¹ä¿®æ”¹ä¸ºæ–‡ä»¶æ‰€å¯¹åº”è·¯å¾„ï¼Œè¯ä¹¦æ–‡ä»¶ä¸é…ç½®æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹å³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># If the cipher option is used on the server</span></span><br><span class="line"><span class="comment"># then you must also specify it here.</span></span><br><span class="line"><span class="comment"># Note that v2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-GCM</span><br><span class="line"><span class="comment"># ä¿®æ”¹åŠ å¯†æ–¹å¼</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x05-å¯åŠ¨æœåŠ¡ç«¯å¹¶è®©å…¶å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#0x05-å¯åŠ¨æœåŠ¡ç«¯å¹¶è®©å…¶å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="0x05. å¯åŠ¨æœåŠ¡ç«¯å¹¶è®©å…¶å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>0x05. å¯åŠ¨æœåŠ¡ç«¯å¹¶è®©å…¶å¼€æœºè‡ªåŠ¨å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start openvpn@server</span><br><span class="line">systemctl <span class="built_in">enable</span> openvpn@server</span><br></pre></td></tr></table></figure>

<h2 id="0x06-é…ç½®é˜²ç«å¢™ä¸æµé‡è½¬å‘"><a href="#0x06-é…ç½®é˜²ç«å¢™ä¸æµé‡è½¬å‘" class="headerlink" title="0x06. é…ç½®é˜²ç«å¢™ä¸æµé‡è½¬å‘"></a>0x06. é…ç½®é˜²ç«å¢™ä¸æµé‡è½¬å‘</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™ä¸æµé‡è½¬å‘</span></span><br><span class="line">firewall-cmd --permanent --add-service openvpn</span><br><span class="line">firewall-cmd --permanent --add-masquerade</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å¼€å¯æµé‡è½¬å‘</span></span><br><span class="line">sysctl -a | grep net.ipv4.ip_forward</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®ä¿net.ipv4.ip_forward ç­‰äº 1ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h2 id="0x07-åˆå¹¶è¯ä¹¦åˆ°é…ç½®æ–‡ä»¶ä¸­"><a href="#0x07-åˆå¹¶è¯ä¹¦åˆ°é…ç½®æ–‡ä»¶ä¸­" class="headerlink" title="0x07. åˆå¹¶è¯ä¹¦åˆ°é…ç½®æ–‡ä»¶ä¸­"></a>0x07. åˆå¹¶è¯ä¹¦åˆ°é…ç½®æ–‡ä»¶ä¸­</h2><p>ç¼–è¾‘client.ovpnå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim client.ovpn</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æˆ–è€…æ³¨é‡Šä»¥ä¸‹å‡ è¡Œå†…å®¹ï¼š</span></span><br><span class="line">ca ca.crtã€€ã€€   æ”¹ä¸ºï¼š<span class="comment">#ca ca.crt</span></span><br><span class="line">cert client.crtã€€ã€€ æ”¹ä¸ºï¼š<span class="comment">#cert client.crt</span></span><br><span class="line">key client.keyã€€ã€€ æ”¹ä¸ºï¼š<span class="comment">#key client.key</span></span><br><span class="line">tls-auth ta.key 1ã€€ã€€ æ”¹ä¸ºï¼š<span class="comment">#tls-auth ta.key 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æœ€åé¢æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class="line">&lt;ca&gt;</span><br><span class="line"><span class="comment"># ca.crt æ–‡ä»¶å†…å®¹</span></span><br><span class="line">&lt;/ca&gt;</span><br><span class="line">&lt;cert&gt;</span><br><span class="line"><span class="comment"># client.crt æ–‡ä»¶å†…å®¹</span></span><br><span class="line">&lt;/cert&gt;</span><br><span class="line">&lt;key&gt;</span><br><span class="line"><span class="comment"># client.key æ–‡ä»¶å†…å®¹</span></span><br><span class="line">&lt;/key&gt;</span><br><span class="line">key-direction 1</span><br><span class="line">&lt;tls-auth&gt;</span><br><span class="line"><span class="comment"># ta.key æ–‡ä»¶å†…å®¹</span></span><br><span class="line">&lt;/tls-auth&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶å„æ–‡ä»¶é‡Œçš„å†…å®¹åˆ°ç›¸åº”çš„ä½ç½®å³å¯ï¼ä¿å­˜é€€å‡ºï¼ï¼</span></span><br></pre></td></tr></table></figure>

<h2 id="0x08-æ•…éšœä¿®å¤"><a href="#0x08-æ•…éšœä¿®å¤" class="headerlink" title="0x08. æ•…éšœä¿®å¤"></a>0x08. æ•…éšœä¿®å¤</h2><h3 id="TLSå¯†é’¥åå•†åœ¨60ç§’å†…å¤±è´¥"><a href="#TLSå¯†é’¥åå•†åœ¨60ç§’å†…å¤±è´¥" class="headerlink" title="TLSå¯†é’¥åå•†åœ¨60ç§’å†…å¤±è´¥"></a>TLSå¯†é’¥åå•†åœ¨60ç§’å†…å¤±è´¥</h3><blockquote>
<p>TLSé”™è¯¯ï¼šTLSå¯†é’¥åå•†åœ¨60ç§’å†…å¤±è´¥ï¼ˆæ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ï¼‰</p>
</blockquote>
<p>è®¾ç½®OpenVPNæ—¶æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€æ˜¯ï¼Œè¿æ¥ä¸¤ç«¯çš„ä¸¤ä¸ªOpenVPNå®ˆæŠ¤ç¨‹åºéƒ½æ— æ³•å½¼æ­¤å»ºç«‹TCPæˆ–UDPè¿æ¥ã€‚</p>
<p>è¿™å‡ ä¹æ˜¯ç”±äºä»¥ä¸‹åŸå› é€ æˆçš„ï¼š</p>
<ul>
<li><p>æœåŠ¡å™¨ç½‘ç»œä¸Šçš„å¤–å›´é˜²ç«å¢™æ­£åœ¨è¿‡æ»¤ä¼ å…¥çš„OpenVPNæ•°æ®åŒ…ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenVPNä½¿ç”¨UDPæˆ–TCPç«¯å£å·1194ï¼‰ã€‚</p>
</li>
<li><p>åœ¨OpenVPNæœåŠ¡å™¨è®¡ç®—æœºä¸Šè¿è¡Œçš„è½¯ä»¶é˜²ç«å¢™æœ¬èº«æ­£åœ¨è¿‡æ»¤ç«¯å£1194ä¸Šçš„ä¼ å…¥è¿æ¥ã€‚è¯·æ³¨æ„ï¼Œé™¤éå¦æœ‰é…ç½®ï¼Œå¦åˆ™è®¸å¤šæ“ä½œç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹ä¼šé˜»æ­¢ä¼ å…¥è¿æ¥ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨ç½‘ç»œä¸Šçš„NATç½‘å…³æ²¡æœ‰TCP &#x2F; UDP 1194åˆ°OpenVPNæœåŠ¡å™¨è®¡ç®—æœºå†…éƒ¨åœ°å€çš„ç«¯å£è½¬å‘è§„åˆ™ã€‚<br>OpenVPNå®¢æˆ·ç«¯é…ç½®åœ¨å…¶é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€ã€‚å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­çš„remoteæŒ‡ä»¤å¿…é¡»æŒ‡å‘æœåŠ¡å™¨æœ¬èº«æˆ–æœåŠ¡å™¨ç½‘ç»œç½‘å…³çš„å…¬å…±IPåœ°å€ã€‚</p>
</li>
<li><p>å¦ä¸€ä¸ªå¯èƒ½çš„åŸå› æ˜¯Windowsé˜²ç«å¢™é˜»æ­¢äº†å¯¹openvpn.exeäºŒè¿›åˆ¶æ–‡ä»¶çš„è®¿é—®ã€‚æ‚¨å¯èƒ½éœ€è¦å°†å…¶åˆ—å…¥ç™½åå•ï¼ˆæ·»åŠ åˆ°â€œä¾‹å¤–â€åˆ—è¡¨ä¸­ï¼‰ï¼ŒOpenVPNæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
</li>
</ul>
<p>åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œä»»ä½•è¿™äº›ä¹Ÿå¾ˆå¯èƒ½å¯¼è‡´ç›¸åŒçš„é—®é¢˜ã€‚å› æ­¤ï¼Œåªéœ€é€ä¸€æµè§ˆã€‚</p>
<h3 id="Failed-to-start-OpenVPN-Robust"><a href="#Failed-to-start-OpenVPN-Robust" class="headerlink" title="Failed to start OpenVPN Robust"></a>Failed to start OpenVPN Robust</h3><p>Failed to start OpenVPN Robust And Highly Flexible Tunneling Application</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™æ¬¡å‡ºç°è¿™ä¸ªæ•…éšœçš„åŸå› æ˜¯SELinuxï¼Œå› ä¸ºä»Windowsç³»ç»Ÿä¸Šä¼ é…ç½®æ–‡ä»¶åˆ°Linuxç³»ç»Ÿï¼Œé€ æˆselinuxçš„æƒé™è®¾ç½®æœ‰é—®é¢˜</span></span><br></pre></td></tr></table></figure>

<h2 id="0x09-å‚è€ƒæ–‡ç« "><a href="#0x09-å‚è€ƒæ–‡ç« " class="headerlink" title="0x09. å‚è€ƒæ–‡ç« "></a>0x09. å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://cloud.tencent.com/developer/article/1871073">Centos7å®‰è£…ä¸é…ç½®OpenVPNæœåŠ¡å™¨ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></li>
<li><a href="https://chanjarster.github.io/post/network/ip-forwarding-masq-nat/">IP Forwarding, Masquerading å’Œ NAT</a></li>
</ul>
]]></content>
      <categories>
        <category>è‡ªå»ºæœåŠ¡</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>openvpn</tag>
        <tag>security</tag>
        <tag>self-hosted</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 ä¸‹éƒ¨ç½² PySpark å¼€å‘ç¯å¢ƒ</title>
    <url>/2023/09/02/setup-pyspark/</url>
    <content><![CDATA[<h1 id="ä¸€ã€ä¸‹è½½é¢„ç¼–è¯‘åŒ…"><a href="#ä¸€ã€ä¸‹è½½é¢„ç¼–è¯‘åŒ…" class="headerlink" title="ä¸€ã€ä¸‹è½½é¢„ç¼–è¯‘åŒ…"></a>ä¸€ã€ä¸‹è½½é¢„ç¼–è¯‘åŒ…</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½é¡µé¢</span></span><br><span class="line">https://spark.apache.org/downloads.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½åœ°å€</span></span><br><span class="line">https://dlcdn.apache.org/spark/spark-3.4.1/spark-3.4.1-bin-hadoop3.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark Standalone Mode</span></span><br><span class="line">https://spark.apache.org/docs/latest/spark-standalone.html</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="äºŒã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#äºŒã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="äºŒã€é…ç½®ç¯å¢ƒå˜é‡"></a>äºŒã€é…ç½®ç¯å¢ƒå˜é‡</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ spark çš„ sbin ç›®å½•ä¸‹çš„ spark-config.sh ä¸­æ·»åŠ JDKçš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0_202</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¿å…æŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment"># localhost:   JAVA_HOME is not set</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€å¼€æ”¾ç«¯å£"><a href="#ä¸‰ã€å¼€æ”¾ç«¯å£" class="headerlink" title="ä¸‰ã€å¼€æ”¾ç«¯å£"></a>ä¸‰ã€å¼€æ”¾ç«¯å£</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=4040/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=8081/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½è§„åˆ™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€å¯åŠ¨"><a href="#å››ã€å¯åŠ¨" class="headerlink" title="å››ã€å¯åŠ¨"></a>å››ã€å¯åŠ¨</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./start-all.sh</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€æµ‹è¯•"><a href="#äº”ã€æµ‹è¯•" class="headerlink" title="äº”ã€æµ‹è¯•"></a>äº”ã€æµ‹è¯•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ Spark çš„ bin ç›®å½•ä¸‹æ‰§è¡Œï¼š</span></span><br><span class="line">./run-example SparkPi 10 | grep <span class="string">&quot;Pi is roughly&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>pyspark</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 ä¸‹å®‰è£… Python3.8.5</title>
    <url>/2023/09/02/setup-python3-8-5/</url>
    <content><![CDATA[<h1 id="ä¸€ã€å‰ç½®æ¡ä»¶"><a href="#ä¸€ã€å‰ç½®æ¡ä»¶" class="headerlink" title="ä¸€ã€å‰ç½®æ¡ä»¶"></a>ä¸€ã€å‰ç½®æ¡ä»¶</h1><h2 id="1ï¼‰å®‰è£…ä¾èµ–"><a href="#1ï¼‰å®‰è£…ä¾èµ–" class="headerlink" title="1ï¼‰å®‰è£…ä¾èµ–"></a>1ï¼‰å®‰è£…ä¾èµ–</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install libffi-devel zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make</span><br></pre></td></tr></table></figure>

<h2 id="2ï¼‰æ›´æ–°-openssl"><a href="#2ï¼‰æ›´æ–°-openssl" class="headerlink" title="2ï¼‰æ›´æ–° openssl"></a>2ï¼‰æ›´æ–° openssl</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget --no-check-certificate   https://www.openssl.org/source/openssl-1.1.1t.tar.gz</span><br><span class="line">tar -zxvf openssl-1.1.1t.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1t/</span><br><span class="line">./config --prefix=/usr/local/my_openssl</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> /usr/bin/openssl /usr/bin/oldopenssl</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/my_openssl/bin/openssl /usr/bin/openssl</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/my_openssl/lib/libssl.so.1.1 /usr/lib64/</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/my_openssl/lib/libcrypto.so.1.1  /usr/lib64/</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="äºŒã€ä¸‹è½½è§£å‹"><a href="#äºŒã€ä¸‹è½½è§£å‹" class="headerlink" title="äºŒã€ä¸‹è½½è§£å‹"></a>äºŒã€ä¸‹è½½è§£å‹</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://mirrors.huaweicloud.com/python/3.8.5/Python-3.8.5.tgz</span><br><span class="line"></span><br><span class="line">tar -zxvf Python-3.8.5.tgz</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€ç¼–è¯‘å®‰è£…"><a href="#ä¸‰ã€ç¼–è¯‘å®‰è£…" class="headerlink" title="ä¸‰ã€ç¼–è¯‘å®‰è£…"></a>ä¸‰ã€ç¼–è¯‘å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> Python-3.8.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># é“¾æ¥åˆ°æ–°ç‰ˆæœ¬OpenSSL</span></span><br><span class="line">./configure --with-openssl=/usr/local/my_openssl  --prefix=/usr/local/python3</span><br><span class="line"></span><br><span class="line">make clean &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€é…ç½®ç¯å¢ƒå˜é‡å¹¶åˆ›å»ºè½¯è¿æ¥"><a href="#å››ã€é…ç½®ç¯å¢ƒå˜é‡å¹¶åˆ›å»ºè½¯è¿æ¥" class="headerlink" title="å››ã€é…ç½®ç¯å¢ƒå˜é‡å¹¶åˆ›å»ºè½¯è¿æ¥"></a>å››ã€é…ç½®ç¯å¢ƒå˜é‡å¹¶åˆ›å»ºè½¯è¿æ¥</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PYTHON_HOME=/usr/local/python3</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PYTHON_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/python3.8 /usr/bin/python3</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/pip3.8 /usr/bin/pip3</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€é…ç½®æ¸…åæº"><a href="#äº”ã€é…ç½®æ¸…åæº" class="headerlink" title="äº”ã€é…ç½®æ¸…åæº"></a>äº”ã€é…ç½®æ¸…åæº</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip3 config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<h1 id="å…­ã€æµ‹è¯•"><a href="#å…­ã€æµ‹è¯•" class="headerlink" title="å…­ã€æµ‹è¯•"></a>å…­ã€æµ‹è¯•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ python ç‰ˆæœ¬</span></span><br><span class="line">python3 -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ pip ç‰ˆæœ¬</span></span><br><span class="line">pip3 -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ python ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PYTHON_HOME</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>pyspark</tag>
        <tag>python3</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 ä¸‹å®‰è£… Jupyter</title>
    <url>/2023/09/02/setup-jupyter/</url>
    <content><![CDATA[<h1 id="JupyterLab"><a href="#JupyterLab" class="headerlink" title="JupyterLab"></a>JupyterLab</h1><p>Install JupyterLab with pip:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip3 install jupyterlab</span><br></pre></td></tr></table></figure>

<p>Once installed, launch JupyterLab with:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jupyter lab</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h1><p>Install the classic Jupyter Notebook with:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install notebook</span><br></pre></td></tr></table></figure>

<p>To run the notebook:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>

<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. generate config</span></span><br><span class="line">jupyter lab --generate-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. change settings</span></span><br><span class="line">c.ServerApp.ip = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">c.ServerApp.open_browser = False</span><br><span class="line">c.ServerApp.allow_remote_access = True</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. open port</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8888/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¼€å‘ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>pyspark</tag>
        <tag>jupyterlab</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸŸåç¼“å­˜ä¾¦æµ‹æŠ€æœ¯</title>
    <url>/2023/06/15/%E5%9F%9F%E5%90%8D%E7%BC%93%E5%AD%98%E4%BE%A6%E6%B5%8B%E6%8A%80%E6%9C%AF/</url>
    <content><![CDATA[<h1 id="æŠ€æœ¯è¯´æ˜"><a href="#æŠ€æœ¯è¯´æ˜" class="headerlink" title="æŠ€æœ¯è¯´æ˜"></a>æŠ€æœ¯è¯´æ˜</h1><p>åŸŸåç¼“å­˜æ¢æµ‹æŠ€æœ¯æ˜¯ä¸€ç§ç”¨äºè·å–ç›®æ ‡ç³»ç»Ÿ DNS ç¼“å­˜ä¿¡æ¯çš„æŠ€æœ¯ã€‚é€šè¿‡å‘é€ç‰¹å®šçš„ DNS æŸ¥è¯¢è¯·æ±‚å¹¶è§‚å¯Ÿå“åº”æ—¶é—´å’Œå†…å®¹ï¼Œå¯ä»¥æ¨æ–­å‡ºç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ç‰¹å®šåŸŸåçš„ DNS ç¼“å­˜è®°å½•ã€‚</p>
<span id="more"></span>

<p>ä¾‹å¦‚ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥æäº¤æŸå®‰å…¨è½¯ä»¶æ›´æ–°æ‰€ä½¿ç”¨çš„åŸŸåï¼Œå¦‚æœæœ‰è®°å½•ï¼Œè¯´æ˜è¯¥ç½‘ç»œä½¿ç”¨è¯¥ç§å®‰å…¨è½¯ä»¶ã€‚</p>
<h1 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dns.message</span><br><span class="line"><span class="keyword">import</span> dns.rdatatype</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DNSCacheSnooping</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dns_server = <span class="string">&#x27;8.8.8.8&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_dns_server</span>(<span class="params">self, nameserver=<span class="string">&#x27;8.8.8.8&#x27;</span></span>):</span><br><span class="line">        self.dns_server = nameserver</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detect</span>(<span class="params">self, domain</span>):</span><br><span class="line">        <span class="comment"># åˆ›å»º UDP å¥—æ¥å­—</span></span><br><span class="line">        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        sock.settimeout(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„é€  DNS è¯·æ±‚æ•°æ®åŒ…</span></span><br><span class="line">        query = dns.message.make_query(domain, dns.rdatatype.A, dns.rdataclass.IN)</span><br><span class="line">        query.flags &amp;= ~dns.flags.RD</span><br><span class="line">        <span class="comment"># query.flags |= dns.flags.RD</span></span><br><span class="line"></span><br><span class="line">        sock.sendto(query.to_wire(), (self.dns_server, <span class="number">53</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ¥æ”¶ DNS å“åº”æ•°æ®åŒ…</span></span><br><span class="line">            data, _ = sock.recvfrom(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è§£æ DNS å“åº”æ•°æ®åŒ…</span></span><br><span class="line">            response = dns.message.from_wire(data)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è·å–è§£æç»“æœ</span></span><br><span class="line">            answers = response.answer</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(answers) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;No Cache for [<span class="subst">&#123;domain&#125;</span>] in [<span class="subst">&#123;self.dns_server&#125;</span>]&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> ans <span class="keyword">in</span> answers:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Find Cache: [<span class="subst">&#123;ans&#125;</span>] in [<span class="subst">&#123;self.dns_server&#125;</span>]&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;DNS query timeout&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># å…³é—­å¥—æ¥å­—</span></span><br><span class="line">            sock.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;A simple command-line tool&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-f&#x27;</span>, <span class="string">&#x27;--domain-file&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;domains in file&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--domain&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;single domain&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--dns-server&#x27;</span>, default=<span class="string">&#x27;8.8.8.8&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;A dns server&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    detector = DNSCacheSnooping()</span><br><span class="line">    <span class="keyword">if</span> args.dns_server:</span><br><span class="line">        detector.set_dns_server(args.dns_server)</span><br><span class="line">    <span class="keyword">if</span> args.domain:</span><br><span class="line">        detector.detect(domain=args.domain)</span><br><span class="line">    <span class="keyword">if</span> args.domain_file:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(args.domain_file):</span><br><span class="line">            args.domain_file = os.path.join(os.getcwd(), args.domain_file)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(args.domain_file) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> domain <span class="keyword">in</span> <span class="built_in">list</span>(f):</span><br><span class="line">                <span class="keyword">if</span> domain.strip() != <span class="string">&quot;&quot;</span>:</span><br><span class="line">                    detector.detect(domain=domain.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="å•åŸŸåæµ‹è¯•"><a href="#å•åŸŸåæµ‹è¯•" class="headerlink" title="å•åŸŸåæµ‹è¯•"></a>å•åŸŸåæµ‹è¯•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(venv) âœ  info-tools git:(main) âœ— python test_DNS_Cache_Snooping.py -d example.com -s 114.114.114.114</span><br><span class="line">DNS query <span class="built_in">timeout</span></span><br></pre></td></tr></table></figure>



<h1 id="å¤šåŸŸåæ–‡ä»¶æµ‹è¯•"><a href="#å¤šåŸŸåæ–‡ä»¶æµ‹è¯•" class="headerlink" title="å¤šåŸŸåæ–‡ä»¶æµ‹è¯•"></a>å¤šåŸŸåæ–‡ä»¶æµ‹è¯•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># domains.txt</span></span><br><span class="line"><span class="comment"># æ¯è¡Œä¸€ä¸ªåŸŸå</span></span><br><span class="line">example.com</span><br><span class="line">baidu.com</span><br><span class="line">google.com</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(venv) âœ  info-tools git:(main) âœ— python test_DNS_Cache_Snooping.py -f domains.txt -s 114.114.114.114</span><br><span class="line">No Cache <span class="keyword">for</span> [example.com] <span class="keyword">in</span> [114.114.114.114]</span><br><span class="line">DNS query <span class="built_in">timeout</span></span><br><span class="line">DNS query <span class="built_in">timeout</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ä¿¡æ¯æ”¶é›†</category>
      </categories>
      <tags>
        <tag>DNS</tag>
        <tag>domain</tag>
      </tags>
  </entry>
</search>
